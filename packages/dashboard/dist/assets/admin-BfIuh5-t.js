import{r as u,a as U,j as e,g as Ot,c as Ft}from"./index-Bd1r4d6-.js";import{d as Xe,r as We,i as je,l as Ht,I as $e,E as qt,h as zt,e as Jt}from"./EntityCard-CfYf4tip.js";function Kt({sessionId:n,modules:r,onAssignEntity:o,onClose:i}){const[t,s]=u.useState([]),[a,l]=u.useState([]),[c,m]=u.useState([]),[b,N]=u.useState(!0),[g,f]=u.useState(""),[h,S]=u.useState(null),[D,k]=u.useState(!1),T=u.useMemo(()=>{const d=new Map;return r.forEach(M=>M.entities.forEach(y=>d.set(y,M.id))),d},[r]),P=u.useCallback(async(d=!1)=>{d?k(!0):N(!0);try{const w=await U(d?"/api/discovery/refresh":"/api/discovery/entities",d?{method:"POST",sessionId:n}:{sessionId:n});l(w.entities),s(w.entities),m(w.domains.map(x=>({domain:x.domain,label:x.label,count:x.entities.length})))}catch{}finally{N(!1),k(!1)}},[n]);return u.useEffect(()=>{P()},[P]),u.useEffect(()=>{let d=a;if(h&&(d=d.filter(M=>M.domain===h)),g){const M=g.toLowerCase();d=d.filter(y=>{var w;return y.entity_id.toLowerCase().includes(M)||y.name.toLowerCase().includes(M)||(((w=y.area)==null?void 0:w.toLowerCase().includes(M))??!1)})}s(d)},[a,g,h]),e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal",style:{maxWidth:"700px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Discover Entities (",a.length," total)"]}),e.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),e.jsxs("div",{className:"discovery-search",children:[e.jsx("input",{type:"text",placeholder:"Search entities...",value:g,onChange:d=>f(d.target.value),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!0),disabled:D,children:D?"Refreshing...":"üîÑ Refresh"})]}),e.jsxs("div",{className:"domain-filter",children:[e.jsxs("button",{type:"button",className:`domain-chip ${h===null?"active":""}`,onClick:()=>S(null),children:["All (",a.length,")"]}),c.length===0&&!b&&e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)",alignSelf:"center"},children:"No entity types found"}),c.map(d=>e.jsxs("button",{type:"button",className:`domain-chip ${h===d.domain?"active":""}`,onClick:()=>S(h===d.domain?null:d.domain),children:[Xe(d.domain)," ",d.label," (",d.count,")"]},d.domain))]}),b?e.jsx("p",{className:"note",children:"Loading entities..."}):e.jsxs("ul",{className:"discovery-entity-list",children:[t.map(d=>{const M=T.get(d.entity_id),y=M!==void 0;return e.jsxs("li",{className:`discovery-entity-item ${y?"on-dashboard":""}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"discovery-entity-name",children:[Xe(d.domain)," ",d.name]}),e.jsx("div",{className:"discovery-entity-id",children:d.entity_id})]}),e.jsx("span",{className:"discovery-entity-state",children:d.state}),e.jsxs("select",{className:"discovery-area-select",value:M??"",onChange:w=>{const x=w.target.value;o(d.entity_id,x===""?null:Number(x))},children:[e.jsx("option",{value:"",children:"‚Äî None ‚Äî"}),r.map(w=>e.jsxs("option",{value:w.id,children:[w.icon," ",w.name]},w.id))]})]},d.entity_id)}),t.length===0&&e.jsx("p",{className:"note",children:"No entities found matching your criteria."})]})]})})}const et=[{label:"Home",emojis:["üè†","üè°","üè¢","üèó","üèò","üè∞","üõè","üõã","üö™","ü™ü","üèï","‚õ∫","üß±"]},{label:"Rooms",emojis:["üõÅ","üöø","üöΩ","ü™•","üç≥","üçΩ","üßë‚Äçüç≥","üì∫","üéÆ","üíª","üñ•","üìö","üéµ","üé∏","üéπ"]},{label:"Lighting",emojis:["üí°","üî¶","üïØ","üåü","‚ú®","‚≠ê","üåô","‚òÄÔ∏è","üîÜ","üîÖ","ü™î"]},{label:"Climate",emojis:["üå°","‚ùÑÔ∏è","üî•","üí®","üåÄ","‚òÅÔ∏è","üå§","üåß","üåä","üíß","üßä"]},{label:"Security",emojis:["üîí","üîì","üîë","üõ°","üìπ","üì∑","üö®","üîî","üö´","‚ö†Ô∏è","üëÅ"]},{label:"Outdoor",emojis:["üå≥","üå≤","üåø","üå∫","üåª","üå¥","üèä","üÖøÔ∏è","üöó","üèã","üßπ","üóë"]},{label:"Appliances",emojis:["üß∫","üëï","ü´ß","üßä","üçï","‚òï","üßÉ","ü•§","üßΩ","ü™£","üîå","üîã","‚ö°"]},{label:"General",emojis:["üì¶","üéØ","üé®","üß©","üõ†","‚öôÔ∏è","üìä","üìà","üóÇ","üìã","‚úÖ","‚ùå","‚ûï","üîÑ"]}];function tt({value:n,onChange:r}){const[o,i]=u.useState(!1),[t,s]=u.useState(""),a=u.useRef(null),l=u.useRef(null),[c,m]=u.useState({top:0,left:0});u.useEffect(()=>{if(o&&a.current){const g=a.current.getBoundingClientRect();m({top:g.bottom+6,left:Math.max(8,g.left-100)})}},[o]),u.useEffect(()=>{if(!o)return;const g=f=>{l.current&&!l.current.contains(f.target)&&a.current&&!a.current.contains(f.target)&&i(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[o]);const b=et.flatMap(g=>g.emojis),N=t.trim()?b.filter(()=>!0):null;return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:a,type:"button",className:"emoji-picker-trigger",onClick:()=>i(!o),title:"Pick icon",children:n||"üè†"}),o&&We.createPortal(e.jsx("div",{ref:l,className:"emoji-picker-panel",style:{top:c.top,left:c.left},children:e.jsx("div",{className:"emoji-picker-grid",children:(N??et.flatMap(g=>g.emojis)).map((g,f)=>e.jsx("button",{type:"button",className:`emoji-picker-item${g===n?" selected":""}`,onClick:()=>{r(g),i(!1)},children:g},`${g}-${f}`))})}),document.body)]})}function Vt({sessionId:n,modules:r,onModulesChange:o,onClose:i}){const[t,s]=u.useState(""),[a,l]=u.useState("üè†"),[c,m]=u.useState(null),[b,N]=u.useState(""),[g,f]=u.useState(""),h=u.useCallback(async()=>{const d=await U("/api/ui/modules",{sessionId:n});o(d.modules)},[n,o]),S=async()=>{t.trim()&&(await U("/api/ui/modules",{method:"POST",sessionId:n,body:JSON.stringify({name:t.trim(),icon:a})}),s(""),l("üè†"),h())},D=async d=>{await U(`/api/ui/modules/${d}`,{method:"PUT",sessionId:n,body:JSON.stringify({name:b,icon:g})}),m(null),h()},k=async d=>{confirm("Delete this area and remove all entity assignments?")&&(await U(`/api/ui/modules/${d}`,{method:"DELETE",sessionId:n}),h())},T=async d=>{await U(`/api/ui/modules/${d.id}`,{method:"PUT",sessionId:n,body:JSON.stringify({visible:!d.visible})}),h()},P=async(d,M)=>{const y=r.findIndex(v=>v.id===d);if(y<0)return;const w=[...r.map(v=>v.id)],x=M==="up"?y-1:y+1;x<0||x>=w.length||([w[y],w[x]]=[w[x],w[y]],await U("/api/ui/modules/reorder",{method:"POST",sessionId:n,body:JSON.stringify({moduleIds:w})}),h())};return e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal",style:{maxWidth:"550px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Manage Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center"},children:[e.jsx(tt,{value:a,onChange:l}),e.jsx("input",{style:{flex:1},value:t,onChange:d=>s(d.target.value),placeholder:"Area name...",onKeyDown:d=>d.key==="Enter"&&S()}),e.jsx("button",{type:"button",className:"action-button",onClick:S,children:"Add"})]}),e.jsxs("ul",{className:"hidden-list",children:[r.map((d,M)=>e.jsx("li",{children:c===d.id?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:1,alignItems:"center"},children:[e.jsx(tt,{value:g,onChange:f}),e.jsx("input",{style:{flex:1},value:b,onChange:y=>N(y.target.value),onKeyDown:y=>y.key==="Enter"&&D(d.id),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>D(d.id),children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>m(null),children:"‚úï"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"hidden-name",children:[d.icon," ",d.name]}),e.jsxs("div",{className:"hidden-id",children:[d.entities.length," entities ¬∑ ",d.visible?"visible":"hidden"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(d.id,"up"),disabled:M===0,children:"‚Üë"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(d.id,"down"),disabled:M===r.length-1,children:"‚Üì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>T(d),children:d.visible?"üëÅ":"üëÅ‚Äçüó®"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{m(d.id),N(d.name),f(d.icon)},children:"‚úèÔ∏è"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(d.id),children:"üóë"})]})]})},d.id)),r.length===0&&e.jsx("p",{className:"note",children:"No areas yet. Create one above to organize your entities."})]})]})})}function Lt({sessionId:n,onClose:r,inline:o,onSaved:i}){const[t,s]=u.useState(""),[a,l]=u.useState("‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"),[c,m]=u.useState(""),[b,N]=u.useState(!1),[g,f]=u.useState(null),[h,S]=u.useState("INFO"),[D,k]=u.useState(""),[T,P]=u.useState(!1),[d,M]=u.useState(!1),[y,w]=u.useState(!1),[x,v]=u.useState([]),[L,C]=u.useState(null),[R,E]=u.useState(null),[A,z]=u.useState(!1),[B,G]=u.useState([]),[X,se]=u.useState(""),[$,Q]=u.useState(!1),[oe,ee]=u.useState(!1),[W,Y]=u.useState(!1),[te,K]=u.useState(!1);y||U("/api/admin/config",{sessionId:n}).then(j=>{j.success&&(s(j.config.HA_URL||""),l(j.config.HA_TOKEN||""),m(j.config.PORT||"3000"),S(j.config.LOG_LEVEL||"INFO"),k(j.config.ALLOWED_ENTITIES||""),v(j.missing||[]),N(j.portLocked??!1),f(j.portLockedBy??null)),w(!0)}).catch(()=>w(!0)),oe||U("/api/guest/settings",{sessionId:n}).then(j=>{z(j.pinEnabled),G(j.pins),ee(!0)}).catch(()=>ee(!0));const q=j=>x.includes(j),V=async()=>{M(!0),C(null);try{const _=await U("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:t,haToken:(a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?"":a)||void 0})});_.success?C({type:"success",message:"Connection successful!"}):C({type:"error",message:_.error||"Connection failed"})}catch(j){C({type:"error",message:j instanceof Error?j.message:"Test failed"})}finally{M(!1)}},ne=async()=>{P(!0),C(null),E(null);try{return await U("/api/admin/config",{method:"POST",sessionId:n,body:JSON.stringify({haUrl:t,haToken:a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?void 0:a,port:c,logLevel:h,allowedEntities:D})}),v(j=>j.filter(p=>p==="HA_URL"&&!t.trim()||p==="HA_TOKEN"&&!a.trim())),i==null||i(),!0}catch(j){const p=j instanceof Error?j.message:"Failed to save";return C({type:"error",message:p}),E({type:"error",message:p}),!1}finally{P(!1)}},pe=async()=>{if(!t.trim()){C({type:"error",message:"Home Assistant URL is required"});return}if(!a.trim()||a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&q("HA_TOKEN")){C({type:"error",message:"Access token is required. Please enter your HA long-lived token."});return}await ne()&&C({type:"success",message:"Settings saved!"})},ye=async()=>{const j=await ne();E(j?{type:"success",message:"Advanced settings saved."}:R)},ce=async(j,p)=>{Y(!0);try{const _=await U("/api/guest/settings",{method:"POST",sessionId:n,body:JSON.stringify({pinEnabled:j,pins:p})});z(_.pinEnabled),G(_.pins)}catch{}finally{Y(!1)}},Ne=()=>{const j=!A;z(j),ce(j,B)},fe=()=>{const j=X.trim();if(!j||B.some(_=>_.pin===j))return;const p=[...B,{pin:j,permanent:$}];G(p),se(""),Q(!1),ce(A,p)},ie=j=>{const p=B.filter(_=>_.pin!==j);G(p),ce(A,p)},de=j=>{const p=B.map(_=>_.pin===j?{..._,permanent:!_.permanent}:_);G(p),ce(A,p)},be=x.length>0,xe=async()=>{if(!confirm("Save settings and restart the server? This will briefly disconnect all clients."))return;if(K(!0),E(null),!await ne()){E({type:"error",message:"Could not save settings ‚Äî restart cancelled."}),K(!1);return}try{await U("/api/admin/restart",{method:"POST",sessionId:n}),E({type:"success",message:"Settings saved. Server restarting‚Ä¶ page will reload in 5 seconds."}),setTimeout(()=>window.location.reload(),5e3)}catch{E({type:"error",message:"Failed to restart server"}),K(!1)}},we=e.jsxs("div",{className:o?"":"modal settings-modal",onClick:j=>j.stopPropagation(),children:[!o&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Settings"}),e.jsx("button",{type:"button",className:"action-button",onClick:r,children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üîí Guest PIN Access"}),e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:Ne,disabled:W}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest dashboard"}),e.jsx("span",{className:"pin-toggle-hint",children:A?"Enabled":"Disabled"})]}),A&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{fontSize:"0.85rem",color:"#8a9bc0",display:"block",marginBottom:"0.5rem"},children:["Allowed PINs (",B.length,")"]}),B.length>0&&e.jsx("ul",{className:"pin-list",children:B.map(j=>e.jsxs("li",{children:[e.jsx("span",{children:j.pin}),e.jsx("button",{type:"button",className:`pin-badge ${j.permanent?"permanent":"expiring"}`,onClick:()=>de(j.pin),title:j.permanent?"Click to make expiring (7 days)":"Click to make permanent",disabled:W,children:j.permanent?"permanent":"7-day"}),e.jsx("button",{type:"button",onClick:()=>ie(j.pin),title:"Remove PIN",disabled:W,children:"‚úï"})]},j.pin))}),e.jsxs("div",{className:"pin-add-row",children:[e.jsx("input",{value:X,onChange:j=>se(j.target.value),onKeyDown:j=>{j.key==="Enter"&&fe()},placeholder:"Enter new PIN",disabled:W}),e.jsxs("label",{className:"pin-permanent-toggle",title:"Permanent PINs never expire",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:j=>Q(j.target.checked),disabled:W}),e.jsx("span",{children:"Permanent"})]}),e.jsx("button",{type:"button",onClick:fe,disabled:W||!X.trim(),children:"Add"})]}),A&&B.length===0&&e.jsx("p",{className:"note error",style:{marginTop:"0.5rem",fontSize:"0.85rem"},children:"‚ö† PIN is enabled but no PINs are set. Guests won't be able to access the dashboard."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üåê Server Connection"}),be&&e.jsx("p",{className:"note error",style:{marginBottom:"0.75rem"},children:"Required settings are missing. Please fill in the highlighted fields."}),e.jsxs("div",{className:`form-field${q("HA_URL")?" field-missing":""}`,children:[e.jsxs("label",{children:["Home Assistant URL",q("HA_URL")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:t,onChange:j=>s(j.target.value),placeholder:"http://homeassistant.local:8123"}),q("HA_URL")&&e.jsx("span",{className:"field-hint",children:"Enter your Home Assistant URL (e.g. http://192.168.1.x:8123)"})]}),e.jsxs("div",{className:`form-field${q("HA_TOKEN")?" field-missing":""}`,children:[e.jsxs("label",{children:["Long-Lived Access Token",q("HA_TOKEN")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:a,onChange:j=>l(j.target.value),type:"password",placeholder:q("HA_TOKEN")?"Paste your HA token here":""}),q("HA_TOKEN")&&e.jsx("span",{className:"field-hint",children:"Create a token in HA ‚Üí Profile ‚Üí Long-Lived Access Tokens ‚Üí Create Token"})]}),L&&e.jsx("p",{className:`note ${L.type}`,children:L.message}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:V,disabled:d||!t,children:d?"Testing...":"Test Connection"}),e.jsx("button",{type:"button",className:"action-button",onClick:pe,disabled:T,children:T?"Saving...":be?"Save & Configure":"Save Settings"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"‚ö° Advanced"}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Server Port"}),e.jsx("input",{value:c,onChange:j=>m(j.target.value),placeholder:"3000",type:"number",min:"1",max:"65535",disabled:b,style:b?{opacity:.5,cursor:"not-allowed"}:void 0}),b?e.jsxs("span",{className:"field-hint",style:{color:"#f0a040"},children:["‚ö†Ô∏è Port is controlled by the ",e.jsx("strong",{children:g})," and cannot be changed here. Update it in your environment config and restart."]}):e.jsx("span",{className:"field-hint",children:"Restart required for port changes to take effect."})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Log Level"}),e.jsxs("select",{value:h,onChange:j=>S(j.target.value),children:[e.jsx("option",{value:"DEBUG",children:"DEBUG"}),e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"WARNING",children:"WARNING"}),e.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:["Allowed Entities ",e.jsx("span",{style:{fontWeight:400,opacity:.7},children:"(optional, comma-separated)"})]}),e.jsx("input",{value:D,onChange:j=>k(j.target.value),placeholder:"light.living_room, switch.bedroom (leave empty for all)"}),e.jsx("span",{className:"field-hint",children:"Limit which entities are exposed. Leave empty to allow all."})]}),R&&e.jsx("p",{className:`note ${R.type}`,children:R.message}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginTop:"0.75rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:ye,disabled:T||te,children:T?"Saving...":"Save Advanced"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:xe,disabled:te||T,children:te?"Restarting...":"üîÑ Save & Restart"})]}),e.jsx("span",{className:"field-hint",style:{marginTop:"0.4rem",display:"block"},children:'"Save & Restart" saves all settings then restarts the server. Required for port changes.'})]})]})]});return o?we:e.jsx("div",{className:"modal-overlay",onClick:r,children:we})}function nt(n,r){const o=n.replace("mdi:",""),i=encodeURIComponent(r);return`https://api.iconify.design/mdi/${o}.svg?color=${i}&height=24`}const Bt=[{label:"Lighting",color:"#ffd54f",icons:["mdi:lightbulb","mdi:lightbulb-outline","mdi:lightbulb-group","mdi:lightbulb-on","mdi:lamp","mdi:floor-lamp","mdi:desk-lamp","mdi:ceiling-light","mdi:led-strip","mdi:led-strip-variant","mdi:track-light","mdi:wall-sconce","mdi:wall-sconce-round","mdi:vanity-light","mdi:chandelier","mdi:outdoor-lamp","mdi:lava-lamp","mdi:string-lights","mdi:light-switch","mdi:brightness-5"]},{label:"Climate",color:"#4fc3f7",icons:["mdi:thermometer","mdi:thermometer-half","mdi:thermometer-high","mdi:thermometer-low","mdi:air-conditioner","mdi:hvac","mdi:fan","mdi:fan-off","mdi:snowflake","mdi:fire","mdi:water-percent","mdi:weather-windy","mdi:heat-wave","mdi:coolant-temperature","mdi:radiator","mdi:air-humidifier","mdi:air-purifier","mdi:air-filter","mdi:thermostat","mdi:thermostat-box"]},{label:"Security",color:"#ef5350",icons:["mdi:lock","mdi:lock-open","mdi:lock-smart","mdi:shield-home","mdi:shield-lock","mdi:alarm-light","mdi:bell-ring","mdi:bell","mdi:cctv","mdi:video-surveillance","mdi:camera","mdi:camera-iris","mdi:motion-sensor","mdi:door-sensor","mdi:window-sensor","mdi:smoke-detector","mdi:fire-alert","mdi:siren","mdi:shield-check","mdi:security"]},{label:"Doors & Windows",color:"#ab47bc",icons:["mdi:door","mdi:door-open","mdi:door-closed","mdi:door-closed-lock","mdi:window-closed","mdi:window-open","mdi:window-shutter","mdi:window-shutter-open","mdi:blinds","mdi:blinds-open","mdi:curtains","mdi:curtains-closed","mdi:garage","mdi:garage-open","mdi:gate","mdi:gate-open","mdi:roller-shade","mdi:roller-shade-closed","mdi:awning","mdi:awning-outline"]},{label:"Rooms",color:"#66bb6a",icons:["mdi:sofa","mdi:bed","mdi:bed-double","mdi:bunk-bed","mdi:bathtub","mdi:shower","mdi:toilet","mdi:sink","mdi:television","mdi:desk","mdi:table-furniture","mdi:wardrobe","mdi:bookshelf","mdi:chair-rolling","mdi:stairs","mdi:elevator","mdi:room-service","mdi:baby-carriage","mdi:toy-brick","mdi:cradle"]},{label:"Kitchen",color:"#ff7043",icons:["mdi:fridge","mdi:fridge-outline","mdi:stove","mdi:microwave","mdi:dishwasher","mdi:coffee-maker","mdi:toaster-oven","mdi:blender","mdi:food-fork-drink","mdi:pot-steam","mdi:silverware-fork-knife","mdi:glass-wine","mdi:beer","mdi:water-pump","mdi:faucet","mdi:countertop","mdi:kettle","mdi:grill","mdi:ice-cream","mdi:food-apple"]},{label:"Media",color:"#7e57c2",icons:["mdi:speaker","mdi:speaker-wireless","mdi:cast","mdi:cast-audio","mdi:play-circle","mdi:pause-circle","mdi:skip-next","mdi:skip-previous","mdi:volume-high","mdi:volume-medium","mdi:volume-low","mdi:volume-off","mdi:headphones","mdi:microphone","mdi:music","mdi:music-note","mdi:radio","mdi:gamepad-variant","mdi:monitor","mdi:projector"]},{label:"Power & Energy",color:"#ffa726",icons:["mdi:power-plug","mdi:power-plug-off","mdi:power-socket","mdi:flash","mdi:flash-off","mdi:battery","mdi:battery-charging","mdi:battery-50","mdi:battery-alert","mdi:solar-power","mdi:solar-panel","mdi:wind-turbine","mdi:ev-station","mdi:meter-electric","mdi:transmission-tower","mdi:power-cycle","mdi:lightning-bolt","mdi:electric-switch","mdi:surge-protector","mdi:battery-heart"]},{label:"Sensors",color:"#26c6da",icons:["mdi:eye","mdi:motion-sensor","mdi:run","mdi:walk","mdi:water-alert","mdi:leak","mdi:gauge","mdi:speedometer","mdi:scale-bathroom","mdi:pulse","mdi:heart-pulse","mdi:signal","mdi:signal-cellular-3","mdi:wifi","mdi:bluetooth","mdi:nfc","mdi:chip","mdi:counter","mdi:timer-sand","mdi:clock-outline"]},{label:"Weather",color:"#42a5f5",icons:["mdi:weather-sunny","mdi:weather-night","mdi:weather-cloudy","mdi:weather-partly-cloudy","mdi:weather-rainy","mdi:weather-pouring","mdi:weather-snowy","mdi:weather-snowy-heavy","mdi:weather-lightning","mdi:weather-fog","mdi:weather-windy-variant","mdi:weather-hail","mdi:umbrella","mdi:sunglasses","mdi:moon-waning-crescent","mdi:sun-compass","mdi:thermometer-lines","mdi:waves","mdi:weather-tornado","mdi:weather-hurricane"]},{label:"Outdoor & Garden",color:"#8bc34a",icons:["mdi:tree","mdi:flower","mdi:flower-tulip","mdi:leaf","mdi:sprout","mdi:grass","mdi:mushroom","mdi:cactus","mdi:water","mdi:watering-can","mdi:sprinkler","mdi:sprinkler-variant","mdi:lawn-mower","mdi:shovel","mdi:rake","mdi:grill-outline","mdi:pool","mdi:hot-tub","mdi:fence","mdi:patio-heater"]},{label:"Appliances",color:"#78909c",icons:["mdi:washing-machine","mdi:tumble-dryer","mdi:iron","mdi:vacuum","mdi:vacuum-outline","mdi:robot-vacuum","mdi:water-boiler","mdi:water-heater","mdi:hair-dryer","mdi:printer-3d","mdi:printer","mdi:router-wireless","mdi:access-point","mdi:nas","mdi:server","mdi:cellphone","mdi:laptop","mdi:tablet","mdi:watch","mdi:keyboard"]},{label:"Transport",color:"#5c6bc0",icons:["mdi:car","mdi:car-electric","mdi:car-connected","mdi:car-door","mdi:garage-variant","mdi:bicycle","mdi:motorbike","mdi:scooter","mdi:bus","mdi:train","mdi:airplane","mdi:boat","mdi:parking","mdi:gas-station","mdi:ev-plug-type2","mdi:map-marker","mdi:compass","mdi:navigation","mdi:road","mdi:traffic-light"]},{label:"People & Home",color:"#ec407a",icons:["mdi:home","mdi:home-outline","mdi:home-variant","mdi:home-assistant","mdi:account","mdi:account-group","mdi:account-child","mdi:dog","mdi:cat","mdi:paw","mdi:baby-face-outline","mdi:human-male-female","mdi:human-greeting","mdi:hand-wave","mdi:phone","mdi:email","mdi:calendar","mdi:bell-alert","mdi:heart","mdi:star"]},{label:"Automation & System",color:"#78909c",icons:["mdi:cog","mdi:cog-outline","mdi:wrench","mdi:tools","mdi:auto-fix","mdi:robot","mdi:script-text","mdi:code-tags","mdi:webhook","mdi:api","mdi:cloud","mdi:database","mdi:update","mdi:reload","mdi:sync","mdi:timer","mdi:toggle-switch","mdi:numeric","mdi:form-select","mdi:palette","mdi:format-paint"]}],it=Bt.flatMap(n=>n.icons.map(r=>({icon:r,color:n.color,category:n.label})));function Gt({value:n,onChange:r}){const[o,i]=u.useState(!1),[t,s]=u.useState(""),[a,l]=u.useState(null),c=u.useRef(null),m=u.useRef(null),[b,N]=u.useState({top:0,left:0});u.useEffect(()=>{if(o&&c.current){const h=c.current.getBoundingClientRect(),S=360,D=420;let k=h.bottom+6,T=h.left;T+S>window.innerWidth-8&&(T=window.innerWidth-S-8),k+D>window.innerHeight-8&&(k=h.top-D-6),N({top:Math.max(8,k),left:Math.max(8,T)})}},[o]),u.useEffect(()=>{if(!o)return;const h=S=>{m.current&&!m.current.contains(S.target)&&c.current&&!c.current.contains(S.target)&&i(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[o]),u.useEffect(()=>{if(!o)return;const h=S=>{S.key==="Escape"&&i(!1)};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[o]);const g=u.useMemo(()=>{const h=t.trim().toLowerCase();return!h&&!a?it:it.filter(S=>a&&S.category!==a?!1:h?S.icon.replace("mdi:","").replace(/-/g," ").includes(h)||S.category.toLowerCase().includes(h):!0)},[t,a]),f=n||"mdi:lightbulb";return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:c,type:"button",className:"icon-picker-trigger",onClick:()=>i(!o),title:"Pick icon",children:e.jsx("img",{src:nt(f,"#7da2ff"),width:22,height:22,alt:"",style:{display:"block"}})}),o&&We.createPortal(e.jsxs("div",{ref:m,className:"icon-picker-panel",style:{top:b.top,left:b.left},children:[e.jsx("div",{className:"icon-picker-search",children:e.jsx("input",{type:"text",placeholder:"Search icons...",value:t,onChange:h=>s(h.target.value),autoFocus:!0})}),e.jsxs("div",{className:"icon-picker-categories",children:[e.jsx("button",{type:"button",className:`icon-cat-tab${a?"":" active"}`,onClick:()=>l(null),style:{"--cat-color":"#aaa"},children:"All"}),Bt.map(h=>e.jsx("button",{type:"button",className:`icon-cat-tab${a===h.label?" active":""}`,onClick:()=>l(a===h.label?null:h.label),style:{"--cat-color":h.color},title:h.label,children:h.label},h.label))]}),e.jsxs("div",{className:"icon-picker-grid",children:[g.map((h,S)=>e.jsx("button",{type:"button",className:`icon-picker-item${h.icon===n?" selected":""}`,onClick:()=>{r(h.icon),i(!1)},title:h.icon.replace("mdi:","").replace(/-/g," "),children:e.jsx("img",{src:nt(h.icon,h.color),width:24,height:24,alt:h.icon.replace("mdi:",""),loading:"lazy",style:{display:"block"}})},`${h.icon}-${S}`)),g.length===0&&e.jsxs("p",{className:"icon-picker-empty",children:['No icons match "',t,'"']})]})]}),document.body)]})}function Wt({entityId:n,friendlyName:r,sessionId:o,anchorRect:i,onClose:t,onSave:s,onHide:a}){const[l,c]=u.useState(""),[m,b]=u.useState(""),[N,g]=u.useState(!0),[f,h]=u.useState(!1),[S,D]=u.useState(!1),[k,T]=u.useState(!0),[P,d]=u.useState(!0),[M,y]=u.useState(!0),[w,x]=u.useState(!1),[,v]=u.useState(0);u.useEffect(()=>{const B=["mdi:cog","mdi:eye-off"];m&&!je(m)&&B.push(m),Ht(B,()=>v(G=>G+1))},[m]),u.useEffect(()=>{(async()=>{try{const B=await U(`/api/ui/entity-props/${encodeURIComponent(n)}`,{sessionId:o});c(B.props.custom_name||""),b(B.props.custom_icon||""),g(B.props.show_last_updated!==!1),h(B.props.hide_state===!0),D(B.props.hide_updated===!0),T(B.props.hide_attributes===!0),d(B.props.hide_logbook===!0)}catch{}finally{y(!1)}})()},[n,o]);const L=u.useCallback(async()=>{x(!0);try{await U(`/api/ui/entity-props/${encodeURIComponent(n)}`,{method:"POST",sessionId:o,body:JSON.stringify({custom_name:l.trim()||null,custom_icon:m||null,show_last_updated:N,hide_state:f,hide_updated:S,hide_attributes:k,hide_logbook:P})}),s(),t()}catch(B){console.error("Save entity props failed:",B)}finally{x(!1)}},[n,o,l,m,N,f,S,k,P,s,t]),C=u.useCallback(async()=>{try{await U(`/api/ui/entity-props/${encodeURIComponent(n)}`,{method:"DELETE",sessionId:o}),c(""),b(""),g(!0),h(!1),D(!1),T(!0),d(!0),s(),t()}catch(B){console.error("Reset entity props failed:",B)}},[n,o,s,t]),R=340,E=440;let A=i.bottom+8,z=i.left-R/2+i.width/2;return z+R>window.innerWidth-8&&(z=window.innerWidth-R-8),z<8&&(z=8),A+E>window.innerHeight-8&&(A=i.top-E-8),We.createPortal(e.jsx("div",{className:"entity-prop-overlay",onClick:t,children:e.jsx("div",{className:"entity-prop-editor",style:{top:A,left:z,width:R},onClick:B=>B.stopPropagation(),children:M?e.jsx("p",{className:"note",style:{textAlign:"center",padding:"1rem"},children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entity-prop-header",children:[je("mdi:cog")?e.jsx($e,{icon:"mdi:cog",width:16,height:16}):e.jsx("span",{children:"‚öô"}),e.jsx("span",{className:"entity-prop-title",children:r}),e.jsx("button",{type:"button",className:"entity-prop-close",onClick:t,children:"√ó"})]}),e.jsxs("div",{className:"entity-prop-body",children:[e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Icon"}),e.jsxs("div",{className:"entity-prop-icon-row",children:[e.jsx(Gt,{value:m,onChange:b}),m&&e.jsx("span",{className:"entity-prop-icon-name",children:m.replace("mdi:","")}),m&&e.jsx("button",{type:"button",className:"entity-prop-clear-btn",onClick:()=>b(""),title:"Clear icon override",children:"√ó"})]})]}),e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",value:l,onChange:B=>c(B.target.value),placeholder:r,className:"entity-prop-input"})]}),e.jsx("div",{className:"entity-prop-section-label",children:"Card Display"}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`slu-${n}`,children:"Show last updated"}),e.jsx("input",{id:`slu-${n}`,type:"checkbox",checked:N,onChange:B=>g(B.target.checked)})]}),e.jsx("div",{className:"entity-prop-section-label",children:"Detail Dialog"}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hs-${n}`,children:"Hide state"}),e.jsx("input",{id:`hs-${n}`,type:"checkbox",checked:f,onChange:B=>h(B.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hu-${n}`,children:"Hide last updated"}),e.jsx("input",{id:`hu-${n}`,type:"checkbox",checked:S,onChange:B=>D(B.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`ha-${n}`,children:"Hide attributes"}),e.jsx("input",{id:`ha-${n}`,type:"checkbox",checked:k,onChange:B=>T(B.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hl-${n}`,children:"Hide logbook"}),e.jsx("input",{id:`hl-${n}`,type:"checkbox",checked:P,onChange:B=>d(B.target.checked)})]})]}),e.jsxs("div",{className:"entity-prop-actions",children:[e.jsxs("button",{type:"button",className:"entity-prop-hide-btn",onClick:()=>{a(),t()},title:"Hide this entity",children:[je("mdi:eye-off")?e.jsx($e,{icon:"mdi:eye-off",width:14,height:14}):e.jsx("span",{children:"üëÅ"})," Hide"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{type:"button",className:"entity-prop-reset-btn",onClick:C,children:"Reset"}),e.jsx("button",{type:"button",className:"entity-prop-save-btn",onClick:L,disabled:w,children:w?"...":"Save"})]})]})})}),document.body)}var me={},Se,st;function Qt(){return st||(st=1,Se=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),Se}var Ee={},re={},rt;function ae(){if(rt)return re;rt=1;let n;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return re.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},re.getSymbolTotalCodewords=function(i){return r[i]},re.getBCHDigit=function(o){let i=0;for(;o!==0;)i++,o>>>=1;return i},re.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');n=i},re.isKanjiModeEnabled=function(){return typeof n<"u"},re.toSJIS=function(i){return n(i)},re}var ke={},ot;function Qe(){return ot||(ot=1,(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function r(o){if(typeof o!="string")throw new Error("Param is not a string");switch(o.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+o)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,t){if(n.isValid(i))return i;try{return r(i)}catch{return t}}})(ke)),ke}var Ae,at;function Yt(){if(at)return Ae;at=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(r){const o=Math.floor(r/8);return(this.buffer[o]>>>7-r%8&1)===1},put:function(r,o){for(let i=0;i<o;i++)this.putBit((r>>>o-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const o=Math.floor(this.length/8);this.buffer.length<=o&&this.buffer.push(0),r&&(this.buffer[o]|=128>>>this.length%8),this.length++}},Ae=n,Ae}var Pe,lt;function Zt(){if(lt)return Pe;lt=1;function n(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}return n.prototype.set=function(r,o,i,t){const s=r*this.size+o;this.data[s]=i,t&&(this.reservedBit[s]=!0)},n.prototype.get=function(r,o){return this.data[r*this.size+o]},n.prototype.xor=function(r,o,i){this.data[r*this.size+o]^=i},n.prototype.isReserved=function(r,o){return this.reservedBit[r*this.size+o]},Pe=n,Pe}var Re={},ct;function Xt(){return ct||(ct=1,(function(n){const r=ae().getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const t=Math.floor(i/7)+2,s=r(i),a=s===145?26:Math.ceil((s-13)/(2*t-2))*2,l=[s-7];for(let c=1;c<t-1;c++)l[c]=l[c-1]-a;return l.push(6),l.reverse()},n.getPositions=function(i){const t=[],s=n.getRowColCoords(i),a=s.length;for(let l=0;l<a;l++)for(let c=0;c<a;c++)l===0&&c===0||l===0&&c===a-1||l===a-1&&c===0||t.push([s[l],s[c]]);return t}})(Re)),Re}var Te={},dt;function $t(){if(dt)return Te;dt=1;const n=ae().getSymbolSize,r=7;return Te.getPositions=function(i){const t=n(i);return[[0,0],[t-r,0],[0,t-r]]},Te}var Le={},ut;function en(){return ut||(ut=1,(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const r={N1:3,N2:3,N3:40,N4:10};n.isValid=function(t){return t!=null&&t!==""&&!isNaN(t)&&t>=0&&t<=7},n.from=function(t){return n.isValid(t)?parseInt(t,10):void 0},n.getPenaltyN1=function(t){const s=t.size;let a=0,l=0,c=0,m=null,b=null;for(let N=0;N<s;N++){l=c=0,m=b=null;for(let g=0;g<s;g++){let f=t.get(N,g);f===m?l++:(l>=5&&(a+=r.N1+(l-5)),m=f,l=1),f=t.get(g,N),f===b?c++:(c>=5&&(a+=r.N1+(c-5)),b=f,c=1)}l>=5&&(a+=r.N1+(l-5)),c>=5&&(a+=r.N1+(c-5))}return a},n.getPenaltyN2=function(t){const s=t.size;let a=0;for(let l=0;l<s-1;l++)for(let c=0;c<s-1;c++){const m=t.get(l,c)+t.get(l,c+1)+t.get(l+1,c)+t.get(l+1,c+1);(m===4||m===0)&&a++}return a*r.N2},n.getPenaltyN3=function(t){const s=t.size;let a=0,l=0,c=0;for(let m=0;m<s;m++){l=c=0;for(let b=0;b<s;b++)l=l<<1&2047|t.get(m,b),b>=10&&(l===1488||l===93)&&a++,c=c<<1&2047|t.get(b,m),b>=10&&(c===1488||c===93)&&a++}return a*r.N3},n.getPenaltyN4=function(t){let s=0;const a=t.data.length;for(let c=0;c<a;c++)s+=t.data[c];return Math.abs(Math.ceil(s*100/a/5)-10)*r.N4};function o(i,t,s){switch(i){case n.Patterns.PATTERN000:return(t+s)%2===0;case n.Patterns.PATTERN001:return t%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(t+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(t/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return t*s%2+t*s%3===0;case n.Patterns.PATTERN110:return(t*s%2+t*s%3)%2===0;case n.Patterns.PATTERN111:return(t*s%3+(t+s)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(t,s){const a=s.size;for(let l=0;l<a;l++)for(let c=0;c<a;c++)s.isReserved(c,l)||s.xor(c,l,o(t,c,l))},n.getBestMask=function(t,s){const a=Object.keys(n.Patterns).length;let l=0,c=1/0;for(let m=0;m<a;m++){s(m),n.applyMask(m,t);const b=n.getPenaltyN1(t)+n.getPenaltyN2(t)+n.getPenaltyN3(t)+n.getPenaltyN4(t);n.applyMask(m,t),b<c&&(c=b,l=m)}return l}})(Le)),Le}var ve={},ht;function Mt(){if(ht)return ve;ht=1;const n=Qe(),r=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],o=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ve.getBlocksCount=function(t,s){switch(s){case n.L:return r[(t-1)*4+0];case n.M:return r[(t-1)*4+1];case n.Q:return r[(t-1)*4+2];case n.H:return r[(t-1)*4+3];default:return}},ve.getTotalCodewordsCount=function(t,s){switch(s){case n.L:return o[(t-1)*4+0];case n.M:return o[(t-1)*4+1];case n.Q:return o[(t-1)*4+2];case n.H:return o[(t-1)*4+3];default:return}},ve}var Be={},ge={},mt;function tn(){if(mt)return ge;mt=1;const n=new Uint8Array(512),r=new Uint8Array(256);return(function(){let i=1;for(let t=0;t<255;t++)n[t]=i,r[i]=t,i<<=1,i&256&&(i^=285);for(let t=255;t<512;t++)n[t]=n[t-255]})(),ge.log=function(i){if(i<1)throw new Error("log("+i+")");return r[i]},ge.exp=function(i){return n[i]},ge.mul=function(i,t){return i===0||t===0?0:n[r[i]+r[t]]},ge}var ft;function nn(){return ft||(ft=1,(function(n){const r=tn();n.mul=function(i,t){const s=new Uint8Array(i.length+t.length-1);for(let a=0;a<i.length;a++)for(let l=0;l<t.length;l++)s[a+l]^=r.mul(i[a],t[l]);return s},n.mod=function(i,t){let s=new Uint8Array(i);for(;s.length-t.length>=0;){const a=s[0];for(let c=0;c<t.length;c++)s[c]^=r.mul(t[c],a);let l=0;for(;l<s.length&&s[l]===0;)l++;s=s.slice(l)}return s},n.generateECPolynomial=function(i){let t=new Uint8Array([1]);for(let s=0;s<i;s++)t=n.mul(t,new Uint8Array([1,r.exp(s)]));return t}})(Be)),Be}var Me,gt;function sn(){if(gt)return Me;gt=1;const n=nn();function r(o){this.genPoly=void 0,this.degree=o,this.degree&&this.initialize(this.degree)}return r.prototype.initialize=function(i){this.degree=i,this.genPoly=n.generateECPolynomial(this.degree)},r.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(i.length+this.degree);t.set(i);const s=n.mod(t,this.genPoly),a=this.degree-s.length;if(a>0){const l=new Uint8Array(this.degree);return l.set(s,a),l}return s},Me=r,Me}var _e={},De={},Ie={},pt;function _t(){return pt||(pt=1,Ie.isValid=function(r){return!isNaN(r)&&r>=1&&r<=40}),Ie}var Z={},yt;function Dt(){if(yt)return Z;yt=1;const n="[0-9]+",r="[A-Z $%*+\\-./:]+";let o="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";o=o.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+o+`)(?:.|[\r
]))+`;Z.KANJI=new RegExp(o,"g"),Z.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Z.BYTE=new RegExp(i,"g"),Z.NUMERIC=new RegExp(n,"g"),Z.ALPHANUMERIC=new RegExp(r,"g");const t=new RegExp("^"+o+"$"),s=new RegExp("^"+n+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Z.testKanji=function(c){return t.test(c)},Z.testNumeric=function(c){return s.test(c)},Z.testAlphanumeric=function(c){return a.test(c)},Z}var bt;function le(){return bt||(bt=1,(function(n){const r=_t(),o=Dt();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,a){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!r.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?s.ccBits[0]:a<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return o.testNumeric(s)?n.NUMERIC:o.testAlphanumeric(s)?n.ALPHANUMERIC:o.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function i(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+t)}}n.from=function(s,a){if(n.isValid(s))return s;try{return i(s)}catch{return a}}})(De)),De}var wt;function rn(){return wt||(wt=1,(function(n){const r=ae(),o=Mt(),i=Qe(),t=le(),s=_t(),a=7973,l=r.getBCHDigit(a);function c(g,f,h){for(let S=1;S<=40;S++)if(f<=n.getCapacity(S,h,g))return S}function m(g,f){return t.getCharCountIndicator(g,f)+4}function b(g,f){let h=0;return g.forEach(function(S){const D=m(S.mode,f);h+=D+S.getBitsLength()}),h}function N(g,f){for(let h=1;h<=40;h++)if(b(g,h)<=n.getCapacity(h,f,t.MIXED))return h}n.from=function(f,h){return s.isValid(f)?parseInt(f,10):h},n.getCapacity=function(f,h,S){if(!s.isValid(f))throw new Error("Invalid QR Code version");typeof S>"u"&&(S=t.BYTE);const D=r.getSymbolTotalCodewords(f),k=o.getTotalCodewordsCount(f,h),T=(D-k)*8;if(S===t.MIXED)return T;const P=T-m(S,f);switch(S){case t.NUMERIC:return Math.floor(P/10*3);case t.ALPHANUMERIC:return Math.floor(P/11*2);case t.KANJI:return Math.floor(P/13);case t.BYTE:default:return Math.floor(P/8)}},n.getBestVersionForData=function(f,h){let S;const D=i.from(h,i.M);if(Array.isArray(f)){if(f.length>1)return N(f,D);if(f.length===0)return 1;S=f[0]}else S=f;return c(S.mode,S.getLength(),D)},n.getEncodedBits=function(f){if(!s.isValid(f)||f<7)throw new Error("Invalid QR Code version");let h=f<<12;for(;r.getBCHDigit(h)-l>=0;)h^=a<<r.getBCHDigit(h)-l;return f<<12|h}})(_e)),_e}var Ue={},vt;function on(){if(vt)return Ue;vt=1;const n=ae(),r=1335,o=21522,i=n.getBCHDigit(r);return Ue.getEncodedBits=function(s,a){const l=s.bit<<3|a;let c=l<<10;for(;n.getBCHDigit(c)-i>=0;)c^=r<<n.getBCHDigit(c)-i;return(l<<10|c)^o},Ue}var Oe={},Fe,Nt;function an(){if(Nt)return Fe;Nt=1;const n=le();function r(o){this.mode=n.NUMERIC,this.data=o.toString()}return r.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(i){let t,s,a;for(t=0;t+3<=this.data.length;t+=3)s=this.data.substr(t,3),a=parseInt(s,10),i.put(a,10);const l=this.data.length-t;l>0&&(s=this.data.substr(t),a=parseInt(s,10),i.put(a,l*3+1))},Fe=r,Fe}var He,xt;function ln(){if(xt)return He;xt=1;const n=le(),r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function o(i){this.mode=n.ALPHANUMERIC,this.data=i}return o.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(t){let s;for(s=0;s+2<=this.data.length;s+=2){let a=r.indexOf(this.data[s])*45;a+=r.indexOf(this.data[s+1]),t.put(a,11)}this.data.length%2&&t.put(r.indexOf(this.data[s]),6)},He=o,He}var qe,Ct;function cn(){if(Ct)return qe;Ct=1;const n=le();function r(o){this.mode=n.BYTE,typeof o=="string"?this.data=new TextEncoder().encode(o):this.data=new Uint8Array(o)}return r.getBitsLength=function(i){return i*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(o){for(let i=0,t=this.data.length;i<t;i++)o.put(this.data[i],8)},qe=r,qe}var ze,jt;function dn(){if(jt)return ze;jt=1;const n=le(),r=ae();function o(i){this.mode=n.KANJI,this.data=i}return o.getBitsLength=function(t){return t*13},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(i){let t;for(t=0;t<this.data.length;t++){let s=r.toSJIS(this.data[t]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),i.put(s,13)}},ze=o,ze}var Je={exports:{}},St;function un(){return St||(St=1,(function(n){var r={single_source_shortest_paths:function(o,i,t){var s={},a={};a[i]=0;var l=r.PriorityQueue.make();l.push(i,0);for(var c,m,b,N,g,f,h,S,D;!l.empty();){c=l.pop(),m=c.value,N=c.cost,g=o[m]||{};for(b in g)g.hasOwnProperty(b)&&(f=g[b],h=N+f,S=a[b],D=typeof a[b]>"u",(D||S>h)&&(a[b]=h,l.push(b,h),s[b]=m))}if(typeof t<"u"&&typeof a[t]>"u"){var k=["Could not find a path from ",i," to ",t,"."].join("");throw new Error(k)}return s},extract_shortest_path_from_predecessor_list:function(o,i){for(var t=[],s=i;s;)t.push(s),o[s],s=o[s];return t.reverse(),t},find_path:function(o,i,t){var s=r.single_source_shortest_paths(o,i,t);return r.extract_shortest_path_from_predecessor_list(s,t)},PriorityQueue:{make:function(o){var i=r.PriorityQueue,t={},s;o=o||{};for(s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t.queue=[],t.sorter=o.sorter||i.default_sorter,t},default_sorter:function(o,i){return o.cost-i.cost},push:function(o,i){var t={value:o,cost:i};this.queue.push(t),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=r})(Je)),Je.exports}var Et;function hn(){return Et||(Et=1,(function(n){const r=le(),o=an(),i=ln(),t=cn(),s=dn(),a=Dt(),l=ae(),c=un();function m(k){return unescape(encodeURIComponent(k)).length}function b(k,T,P){const d=[];let M;for(;(M=k.exec(P))!==null;)d.push({data:M[0],index:M.index,mode:T,length:M[0].length});return d}function N(k){const T=b(a.NUMERIC,r.NUMERIC,k),P=b(a.ALPHANUMERIC,r.ALPHANUMERIC,k);let d,M;return l.isKanjiModeEnabled()?(d=b(a.BYTE,r.BYTE,k),M=b(a.KANJI,r.KANJI,k)):(d=b(a.BYTE_KANJI,r.BYTE,k),M=[]),T.concat(P,d,M).sort(function(w,x){return w.index-x.index}).map(function(w){return{data:w.data,mode:w.mode,length:w.length}})}function g(k,T){switch(T){case r.NUMERIC:return o.getBitsLength(k);case r.ALPHANUMERIC:return i.getBitsLength(k);case r.KANJI:return s.getBitsLength(k);case r.BYTE:return t.getBitsLength(k)}}function f(k){return k.reduce(function(T,P){const d=T.length-1>=0?T[T.length-1]:null;return d&&d.mode===P.mode?(T[T.length-1].data+=P.data,T):(T.push(P),T)},[])}function h(k){const T=[];for(let P=0;P<k.length;P++){const d=k[P];switch(d.mode){case r.NUMERIC:T.push([d,{data:d.data,mode:r.ALPHANUMERIC,length:d.length},{data:d.data,mode:r.BYTE,length:d.length}]);break;case r.ALPHANUMERIC:T.push([d,{data:d.data,mode:r.BYTE,length:d.length}]);break;case r.KANJI:T.push([d,{data:d.data,mode:r.BYTE,length:m(d.data)}]);break;case r.BYTE:T.push([{data:d.data,mode:r.BYTE,length:m(d.data)}])}}return T}function S(k,T){const P={},d={start:{}};let M=["start"];for(let y=0;y<k.length;y++){const w=k[y],x=[];for(let v=0;v<w.length;v++){const L=w[v],C=""+y+v;x.push(C),P[C]={node:L,lastCount:0},d[C]={};for(let R=0;R<M.length;R++){const E=M[R];P[E]&&P[E].node.mode===L.mode?(d[E][C]=g(P[E].lastCount+L.length,L.mode)-g(P[E].lastCount,L.mode),P[E].lastCount+=L.length):(P[E]&&(P[E].lastCount=L.length),d[E][C]=g(L.length,L.mode)+4+r.getCharCountIndicator(L.mode,T))}}M=x}for(let y=0;y<M.length;y++)d[M[y]].end=0;return{map:d,table:P}}function D(k,T){let P;const d=r.getBestModeForData(k);if(P=r.from(T,d),P!==r.BYTE&&P.bit<d.bit)throw new Error('"'+k+'" cannot be encoded with mode '+r.toString(P)+`.
 Suggested mode is: `+r.toString(d));switch(P===r.KANJI&&!l.isKanjiModeEnabled()&&(P=r.BYTE),P){case r.NUMERIC:return new o(k);case r.ALPHANUMERIC:return new i(k);case r.KANJI:return new s(k);case r.BYTE:return new t(k)}}n.fromArray=function(T){return T.reduce(function(P,d){return typeof d=="string"?P.push(D(d,null)):d.data&&P.push(D(d.data,d.mode)),P},[])},n.fromString=function(T,P){const d=N(T,l.isKanjiModeEnabled()),M=h(d),y=S(M,P),w=c.find_path(y.map,"start","end"),x=[];for(let v=1;v<w.length-1;v++)x.push(y.table[w[v]].node);return n.fromArray(f(x))},n.rawSplit=function(T){return n.fromArray(N(T,l.isKanjiModeEnabled()))}})(Oe)),Oe}var kt;function mn(){if(kt)return Ee;kt=1;const n=ae(),r=Qe(),o=Yt(),i=Zt(),t=Xt(),s=$t(),a=en(),l=Mt(),c=sn(),m=rn(),b=on(),N=le(),g=hn();function f(y,w){const x=y.size,v=s.getPositions(w);for(let L=0;L<v.length;L++){const C=v[L][0],R=v[L][1];for(let E=-1;E<=7;E++)if(!(C+E<=-1||x<=C+E))for(let A=-1;A<=7;A++)R+A<=-1||x<=R+A||(E>=0&&E<=6&&(A===0||A===6)||A>=0&&A<=6&&(E===0||E===6)||E>=2&&E<=4&&A>=2&&A<=4?y.set(C+E,R+A,!0,!0):y.set(C+E,R+A,!1,!0))}}function h(y){const w=y.size;for(let x=8;x<w-8;x++){const v=x%2===0;y.set(x,6,v,!0),y.set(6,x,v,!0)}}function S(y,w){const x=t.getPositions(w);for(let v=0;v<x.length;v++){const L=x[v][0],C=x[v][1];for(let R=-2;R<=2;R++)for(let E=-2;E<=2;E++)R===-2||R===2||E===-2||E===2||R===0&&E===0?y.set(L+R,C+E,!0,!0):y.set(L+R,C+E,!1,!0)}}function D(y,w){const x=y.size,v=m.getEncodedBits(w);let L,C,R;for(let E=0;E<18;E++)L=Math.floor(E/3),C=E%3+x-8-3,R=(v>>E&1)===1,y.set(L,C,R,!0),y.set(C,L,R,!0)}function k(y,w,x){const v=y.size,L=b.getEncodedBits(w,x);let C,R;for(C=0;C<15;C++)R=(L>>C&1)===1,C<6?y.set(C,8,R,!0):C<8?y.set(C+1,8,R,!0):y.set(v-15+C,8,R,!0),C<8?y.set(8,v-C-1,R,!0):C<9?y.set(8,15-C-1+1,R,!0):y.set(8,15-C-1,R,!0);y.set(v-8,8,1,!0)}function T(y,w){const x=y.size;let v=-1,L=x-1,C=7,R=0;for(let E=x-1;E>0;E-=2)for(E===6&&E--;;){for(let A=0;A<2;A++)if(!y.isReserved(L,E-A)){let z=!1;R<w.length&&(z=(w[R]>>>C&1)===1),y.set(L,E-A,z),C--,C===-1&&(R++,C=7)}if(L+=v,L<0||x<=L){L-=v,v=-v;break}}}function P(y,w,x){const v=new o;x.forEach(function(A){v.put(A.mode.bit,4),v.put(A.getLength(),N.getCharCountIndicator(A.mode,y)),A.write(v)});const L=n.getSymbolTotalCodewords(y),C=l.getTotalCodewordsCount(y,w),R=(L-C)*8;for(v.getLengthInBits()+4<=R&&v.put(0,4);v.getLengthInBits()%8!==0;)v.putBit(0);const E=(R-v.getLengthInBits())/8;for(let A=0;A<E;A++)v.put(A%2?17:236,8);return d(v,y,w)}function d(y,w,x){const v=n.getSymbolTotalCodewords(w),L=l.getTotalCodewordsCount(w,x),C=v-L,R=l.getBlocksCount(w,x),E=v%R,A=R-E,z=Math.floor(v/R),B=Math.floor(C/R),G=B+1,X=z-B,se=new c(X);let $=0;const Q=new Array(R),oe=new Array(R);let ee=0;const W=new Uint8Array(y.buffer);for(let V=0;V<R;V++){const ne=V<A?B:G;Q[V]=W.slice($,$+ne),oe[V]=se.encode(Q[V]),$+=ne,ee=Math.max(ee,ne)}const Y=new Uint8Array(v);let te=0,K,q;for(K=0;K<ee;K++)for(q=0;q<R;q++)K<Q[q].length&&(Y[te++]=Q[q][K]);for(K=0;K<X;K++)for(q=0;q<R;q++)Y[te++]=oe[q][K];return Y}function M(y,w,x,v){let L;if(Array.isArray(y))L=g.fromArray(y);else if(typeof y=="string"){let z=w;if(!z){const B=g.rawSplit(y);z=m.getBestVersionForData(B,x)}L=g.fromString(y,z||40)}else throw new Error("Invalid data");const C=m.getBestVersionForData(L,x);if(!C)throw new Error("The amount of data is too big to be stored in a QR Code");if(!w)w=C;else if(w<C)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+C+`.
`);const R=P(w,x,L),E=n.getSymbolSize(w),A=new i(E);return f(A,w),h(A),S(A,w),k(A,x,0),w>=7&&D(A,w),T(A,R),isNaN(v)&&(v=a.getBestMask(A,k.bind(null,A,x))),a.applyMask(v,A),k(A,x,v),{modules:A,version:w,errorCorrectionLevel:x,maskPattern:v,segments:L}}return Ee.create=function(w,x){if(typeof w>"u"||w==="")throw new Error("No input text");let v=r.M,L,C;return typeof x<"u"&&(v=r.from(x.errorCorrectionLevel,r.M),L=m.from(x.version),C=a.from(x.maskPattern),x.toSJISFunc&&n.setToSJISFunction(x.toSJISFunc)),M(w,L,v,C)},Ee}var Ke={},Ve={},At;function It(){return At||(At=1,(function(n){function r(o){if(typeof o=="number"&&(o=o.toString()),typeof o!="string")throw new Error("Color should be defined as hex string");let i=o.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+o);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(s){return[s,s]}))),i.length===6&&i.push("F","F");const t=parseInt(i.join(""),16);return{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:t&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const t=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,s=i.width&&i.width>=21?i.width:void 0,a=i.scale||4;return{width:s,scale:s?4:a,margin:t,color:{dark:r(i.color.dark||"#000000ff"),light:r(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,t){return t.width&&t.width>=i+t.margin*2?t.width/(i+t.margin*2):t.scale},n.getImageWidth=function(i,t){const s=n.getScale(i,t);return Math.floor((i+t.margin*2)*s)},n.qrToImageData=function(i,t,s){const a=t.modules.size,l=t.modules.data,c=n.getScale(a,s),m=Math.floor((a+s.margin*2)*c),b=s.margin*c,N=[s.color.light,s.color.dark];for(let g=0;g<m;g++)for(let f=0;f<m;f++){let h=(g*m+f)*4,S=s.color.light;if(g>=b&&f>=b&&g<m-b&&f<m-b){const D=Math.floor((g-b)/c),k=Math.floor((f-b)/c);S=N[l[D*a+k]?1:0]}i[h++]=S.r,i[h++]=S.g,i[h++]=S.b,i[h]=S.a}}})(Ve)),Ve}var Pt;function fn(){return Pt||(Pt=1,(function(n){const r=It();function o(t,s,a){t.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=a,s.width=a,s.style.height=a+"px",s.style.width=a+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,a,l){let c=l,m=a;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),a||(m=i()),c=r.getOptions(c);const b=r.getImageWidth(s.modules.size,c),N=m.getContext("2d"),g=N.createImageData(b,b);return r.qrToImageData(g.data,s,c),o(N,m,b),N.putImageData(g,0,0),m},n.renderToDataURL=function(s,a,l){let c=l;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),c||(c={});const m=n.render(s,a,c),b=c.type||"image/png",N=c.rendererOpts||{};return m.toDataURL(b,N.quality)}})(Ke)),Ke}var Ge={},Rt;function gn(){if(Rt)return Ge;Rt=1;const n=It();function r(t,s){const a=t.a/255,l=s+'="'+t.hex+'"';return a<1?l+" "+s+'-opacity="'+a.toFixed(2).slice(1)+'"':l}function o(t,s,a){let l=t+s;return typeof a<"u"&&(l+=" "+a),l}function i(t,s,a){let l="",c=0,m=!1,b=0;for(let N=0;N<t.length;N++){const g=Math.floor(N%s),f=Math.floor(N/s);!g&&!m&&(m=!0),t[N]?(b++,N>0&&g>0&&t[N-1]||(l+=m?o("M",g+a,.5+f+a):o("m",c,0),c=0,m=!1),g+1<s&&t[N+1]||(l+=o("h",b),b=0)):c++}return l}return Ge.render=function(s,a,l){const c=n.getOptions(a),m=s.modules.size,b=s.modules.data,N=m+c.margin*2,g=c.color.light.a?"<path "+r(c.color.light,"fill")+' d="M0 0h'+N+"v"+N+'H0z"/>':"",f="<path "+r(c.color.dark,"stroke")+' d="'+i(b,m,c.margin)+'"/>',h='viewBox="0 0 '+N+" "+N+'"',D='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+h+' shape-rendering="crispEdges">'+g+f+`</svg>
`;return typeof l=="function"&&l(null,D),D},Ge}var Tt;function pn(){if(Tt)return me;Tt=1;const n=Qt(),r=mn(),o=fn(),i=gn();function t(s,a,l,c,m){const b=[].slice.call(arguments,1),N=b.length,g=typeof b[N-1]=="function";if(!g&&!n())throw new Error("Callback required as last argument");if(g){if(N<2)throw new Error("Too few arguments provided");N===2?(m=l,l=a,a=c=void 0):N===3&&(a.getContext&&typeof m>"u"?(m=c,c=void 0):(m=c,c=l,l=a,a=void 0))}else{if(N<1)throw new Error("Too few arguments provided");return N===1?(l=a,a=c=void 0):N===2&&!a.getContext&&(c=l,l=a,a=void 0),new Promise(function(f,h){try{const S=r.create(l,c);f(s(S,a,c))}catch(S){h(S)}})}try{const f=r.create(l,c);m(null,s(f,a,c))}catch(f){m(f)}}return me.create=r.create,me.toCanvas=t.bind(null,o.render),me.toDataURL=t.bind(null,o.renderToDataURL),me.toString=t.bind(null,function(s,a,l){return i.render(s,l)}),me}var yn=pn();const bn=Ot(yn);function wn({sessionId:n,hassUrl:r,hassToken:o,onLogout:i}){const[t,s]=u.useState([]),[a,l]=u.useState(new Set),[c,m]=u.useState("LobbyHA"),[b,N]=u.useState(!1),[g,f]=u.useState(""),[h,S]=u.useState(!0),[D,k]=u.useState(!1),[T,P]=u.useState(!1),[d,M]=u.useState(!1),[y,w]=u.useState(!1),[x,v]=u.useState(!1),[L,C]=u.useState(!1),[R,E]=u.useState(!1),[A,z]=u.useState({}),[B,G]=u.useState(null),[X,se]=u.useState(null),[$,Q]=u.useState(""),[oe,ee]=u.useState(""),[W,Y]=u.useState(null),[te,K]=u.useState(null),q=u.useRef(null),V=u.useCallback(async(p=!1)=>{p||S(!0);try{const[_,I,F,O]=await Promise.all([U("/api/ui/modules",{sessionId:n}),U("/api/ui/hidden",{sessionId:n}),U("/api/ui/guest-entities",{sessionId:n}),U("/api/ui/entity-props",{sessionId:n})]);s(_.modules),l(new Set(I.hidden)),m(F.title||"LobbyHA");const H={};for(const J of O.props)H[J.entity_id]=J;z(H)}catch{}finally{p||S(!1)}},[n]);u.useEffect(()=>{V()},[V]),u.useEffect(()=>{if(!L)return;const p=_=>{q.current&&!q.current.contains(_.target)&&C(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[L]);const ne=()=>{f(c),N(!0)},pe=async()=>{const p=g.trim()||"LobbyHA";m(p),N(!1),await U("/api/ui/guest-entities",{method:"POST",sessionId:n,body:JSON.stringify({title:p})})},ye=async p=>{const _=new Set(a);_.add(p),l(_),await U("/api/ui/hidden",{method:"POST",sessionId:n,body:JSON.stringify({hidden:Array.from(_)})})},ce=async p=>{const _=new Set(a);_.delete(p),l(_),await U("/api/ui/hidden",{method:"POST",sessionId:n,body:JSON.stringify({hidden:Array.from(_)})})},Ne=async(p,_)=>{const I=t.find(F=>F.entities.includes(p));if(I){const F=I.entities.filter(O=>O!==p);s(O=>O.map(H=>H.id===I.id?{...H,entities:F}:H)),await U(`/api/ui/modules/${I.id}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})})}if(_!==null){const F=t.find(O=>O.id===_);if(F){const O=[...F.entities.filter(H=>H!==p),p];s(H=>H.map(J=>J.id===F.id?{...J,entities:O}:J)),await U(`/api/ui/modules/${F.id}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:O})})}}V(!0)},fe=async(p,_,I)=>{const F=t.find(ue=>ue.id===p);if(!F)return;const O=[...F.entities],H=O.indexOf(_);if(H<0)return;const J=I==="up"?H-1:H+1;J<0||J>=O.length||([O[H],O[J]]=[O[J],O[H]],s(ue=>ue.map(he=>he.id===p?{...he,entities:O}:he)),await U(`/api/ui/modules/${p}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:O})}))},[ie,de]=u.useState(null),be=async(p,_)=>{if(!ie||ie.moduleId!==p){de(null);return}const I=t.find(H=>H.id===p);if(!I)return;const F=[...I.entities],O=F.indexOf(ie.entityId);O<0||(F.splice(O,1),F.splice(_,0,ie.entityId),s(H=>H.map(J=>J.id===p?{...J,entities:F}:J)),de(null),await U(`/api/ui/modules/${p}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})}))},xe=async()=>{const p=new URL("./",window.location.href).toString();try{const _=await bn.toDataURL(p,{width:256,margin:2});K(_),v(!0)}catch(_){console.error("Failed to generate QR code:",_)}},we=async()=>{Y(null);try{await U("/api/admin/change-password",{method:"POST",sessionId:n,body:JSON.stringify({currentPassword:$,newPassword:oe})}),Y("Password changed!"),Q(""),ee("")}catch(p){Y(p instanceof Error?p.message:"Failed")}},j=async(p,_)=>{const I=t.find(O=>O.id===p);if(!I)return;const F=I.entities.filter(O=>O!==_);await U(`/api/ui/modules/${p}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})}),V()};return h?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading dashboard..."})}):e.jsxs("div",{className:"admin-layout",children:[e.jsxs("header",{className:"admin-header",children:[e.jsxs("div",{className:"header-left",children:[b?e.jsxs("span",{className:"title-edit",children:[e.jsx("input",{className:"title-input",value:g,onChange:p=>f(p.target.value),onKeyDown:p=>{p.key==="Enter"&&pe(),p.key==="Escape"&&N(!1)},autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:pe,children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>N(!1),children:"‚úï"})]}):e.jsx("h1",{className:"dashboard-title",onClick:ne,title:"Click to edit",children:c}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("div",{className:"header-right",children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(!0),children:"üîç Discover"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!0),children:"üì¶ Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:xe,children:"üì± QR Code"}),e.jsxs("div",{className:"settings-menu-wrap",ref:q,children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>C(!L),children:"‚öôÔ∏è"}),L&&e.jsxs("div",{className:"settings-dropdown",children:[e.jsxs("button",{onClick:()=>{C(!1),w(!0)},children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{onClick:()=>{C(!1),E(!0)},children:"Change Password"}),e.jsx("button",{onClick:()=>{C(!1),M(!0)},children:"Server Settings"}),e.jsx("button",{onClick:()=>{C(!1),i()},children:"Logout"})]})]})]})]}),e.jsx("main",{className:"admin-main",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No areas yet. Create areas to organize your entities."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!0),children:"Create First Area"})]}):t.map(p=>{const _=p.entities.filter(I=>!a.has(I));return e.jsxs("section",{className:"module-section",children:[e.jsxs("div",{className:"module-header",children:[e.jsxs("h2",{children:[p.icon," ",p.name]}),e.jsxs("span",{className:"entity-count",children:[p.entities.length," entities"]})]}),e.jsxs("div",{className:"entity-grid",children:[_.map((I,F)=>{var O,H,J,ue,he,Ye,Ze;return e.jsxs("div",{className:`entity-card-wrap admin-card${(ie==null?void 0:ie.entityId)===I?" dragging":""}`,draggable:!0,onDragStart:()=>de({moduleId:p.id,entityId:I}),onDragOver:Ce=>Ce.preventDefault(),onDrop:()=>be(p.id,F),onDragEnd:()=>de(null),children:[e.jsx(qt,{entityId:I,showActions:!0,showAttributes:!0,onHide:()=>ye(I),onGearClick:(Ce,Ut)=>{G(Ce),se(Ut)},customName:(O=A[I])==null?void 0:O.custom_name,customIcon:(H=A[I])==null?void 0:H.custom_icon,showLastUpdated:(J=A[I])==null?void 0:J.show_last_updated,hideState:(ue=A[I])==null?void 0:ue.hide_state,hideUpdated:(he=A[I])==null?void 0:he.hide_updated,hideAttributes:(Ye=A[I])==null?void 0:Ye.hide_attributes,hideLogbook:(Ze=A[I])==null?void 0:Ze.hide_logbook}),e.jsxs("div",{className:"entity-admin-actions",children:[e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>fe(p.id,I,"up"),disabled:F===0,title:"Move up",children:"‚Üë"}),e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>fe(p.id,I,"down"),disabled:F===_.length-1,title:"Move down",children:"‚Üì"}),e.jsx("button",{type:"button",className:"remove-from-module-btn",onClick:()=>j(p.id,I),title:"Remove from area",children:"‚úï"})]})]},I)}),p.entities.length===0&&e.jsx("p",{className:"note",style:{gridColumn:"1 / -1"},children:"No entities in this area. Use Discover to add some."})]})]},p.id)})}),B&&X&&e.jsx(Wt,{entityId:B,friendlyName:B.split(".").slice(1).join(".").replace(/_/g," "),sessionId:n,anchorRect:X,onClose:()=>{G(null),se(null)},onSave:()=>V(!0),onHide:()=>{ye(B),G(null),se(null)}}),D&&e.jsx(Kt,{sessionId:n,modules:t,onAssignEntity:Ne,onClose:()=>k(!1)}),T&&e.jsx(Vt,{sessionId:n,modules:t,onModulesChange:s,onClose:()=>{P(!1),V()}}),d&&e.jsx(Lt,{sessionId:n,onClose:()=>M(!1)}),y&&e.jsx("div",{className:"modal-overlay",onClick:()=>w(!1),children:e.jsxs("div",{className:"modal",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>w(!1),children:"Close"})]}),e.jsxs("ul",{className:"hidden-list",children:[Array.from(a).map(p=>e.jsxs("li",{children:[e.jsx("span",{className:"hidden-id",children:p}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>ce(p),children:"Unhide"})]},p)),a.size===0&&e.jsx("p",{className:"note",children:"No hidden entities."})]})]})}),x&&e.jsx("div",{className:"modal-overlay",onClick:()=>v(!1),children:e.jsxs("div",{className:"modal qr-modal",onClick:p=>p.stopPropagation(),children:[e.jsx("h3",{children:"Guest Access QR Code"}),te&&e.jsx("img",{src:te,alt:"QR Code for guest access"}),e.jsx("p",{className:"note",children:"Scan this code to open the guest dashboard."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>v(!1),children:"Close"})]})}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>E(!1),children:e.jsxs("div",{className:"modal",onClick:p=>p.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Change Password"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>E(!1),children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:$,onChange:p=>Q(p.target.value)})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:oe,onChange:p=>ee(p.target.value)})]}),W&&e.jsx("p",{className:"note",children:W}),e.jsx("button",{type:"button",className:"action-button",onClick:we,children:"Change Password"})]})]})})]})}function vn({onLogin:n,error:r}){const[o,i]=u.useState(""),[t,s]=u.useState(!1),a=async l=>{l.preventDefault(),s(!0),await n(o),s(!1)};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Admin Login"}),e.jsxs("form",{className:"login-form",onSubmit:a,children:[e.jsx("input",{className:"login-input",type:"password",placeholder:"Admin password",value:o,onChange:l=>i(l.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"action-button",disabled:t,children:t?"Logging in...":"Login"})]}),r&&e.jsx("p",{className:"note error",children:r})]})}function Nn(){const[n,r]=u.useState(()=>sessionStorage.getItem("admin_session")),[o,i]=u.useState(""),[t,s]=u.useState(""),[a,l]=u.useState(null),[c,m]=u.useState(!0);u.useEffect(()=>{(async()=>{const f=sessionStorage.getItem("admin_session");if(!f){m(!1);return}try{const h=await U("/api/admin/session",{sessionId:f});h.valid?(r(f),i(h.hassUrl),s(h.hassToken)):(sessionStorage.removeItem("admin_session"),r(null))}catch{sessionStorage.removeItem("admin_session"),r(null)}finally{m(!1)}})()},[]);const b=async g=>{l(null);try{const f=await U("/api/admin/login",{method:"POST",body:JSON.stringify({password:g})});f.success?(sessionStorage.setItem("admin_session",f.sessionId),r(f.sessionId),i(f.hassUrl),s(f.hassToken)):l("Invalid password")}catch(f){l(f instanceof Error?f.message:"Login failed")}},N=async()=>{if(n)try{await U("/api/admin/logout",{method:"POST",sessionId:n})}catch{}sessionStorage.removeItem("admin_session"),r(null),i(""),s("")};return c?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading..."})}):n?o?e.jsxs(zt,{hassUrl:o,hassToken:t,loading:e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."})}),options:{renderError:()=>e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"LobbyHA Admin"}),e.jsxs("p",{className:"note error",style:{marginBottom:"1.5rem"},children:["Unable to connect to Home Assistant.",e.jsx("br",{}),"Update the settings below and save to reconnect."]}),e.jsx(Lt,{sessionId:n,inline:!0,onSaved:()=>{setTimeout(()=>window.location.reload(),1500)}}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>window.location.reload(),children:"Retry Connection"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:N,children:"Logout"})]})]})},children:[e.jsx(Jt,{}),e.jsx(wn,{sessionId:n,hassUrl:o,hassToken:t,onLogout:N})]}):e.jsx("div",{className:"container",children:e.jsxs("p",{className:"note",children:["Server not configured. ",e.jsx("a",{href:"/setup",children:"Run setup"})]})}):e.jsx(vn,{onLogin:b,error:a})}Ft.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Nn,{})}));
