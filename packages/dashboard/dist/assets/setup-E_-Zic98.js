import{r as t,a as b,j as e,c as _}from"./index-Bd1r4d6-.js";function Y({existingConfig:d,reconfigure:o}={}){const[a,n]=t.useState("url"),[l,u]=t.useState(""),[i,T]=t.useState(""),[p,R]=t.useState(""),[N,U]=t.useState(""),[C,I]=t.useState("3000"),[F,P]=t.useState(!1),[B,w]=t.useState(!1),[A,L]=t.useState(null),[x,r]=t.useState(null),[H,f]=t.useState(!1),[O,g]=t.useState(!1),[h,D]=t.useState(!1),[c,y]=t.useState([]),[j,v]=t.useState(""),[k,S]=t.useState(!1);t.useEffect(()=>{if(d){d.HA_URL&&d.HA_URL!=="http://localhost:8123"?u(d.HA_URL):u("http://homeassistant.local:8123"),g(!0);return}b("/api/setup/status").then(s=>{var m;(m=s.config)!=null&&m.HA_URL&&s.config.HA_URL!=="http://localhost:8123"?u(s.config.HA_URL):u("http://homeassistant.local:8123"),g(!0)}).catch(()=>{u("http://homeassistant.local:8123"),g(!0)})},[d]);const E=async()=>{P(!0),w(!1),L(null),r(null);try{const s=await b("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:l,haToken:i})});s.success?(w(!0),L(s.version??null)):r(s.error||"Connection failed")}catch(s){r(s instanceof Error?s.message:"Connection test failed")}finally{P(!1)}},z=async()=>{if(!o){if(p!==N){r("Passwords do not match");return}if(p.length<4){r("Password must be at least 4 characters");return}}f(!0),r(null);try{await b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:l,haToken:i,adminPassword:o?void 0:p,port:C||void 0,pinEnabled:h||void 0,pins:h&&c.length>0?c:void 0})}),n("done")}catch(s){r(s instanceof Error?s.message:"Setup failed")}finally{f(!1)}};return t.useEffect(()=>{a==="done-reconfig"&&(f(!0),b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:l,haToken:i})}).then(()=>{n("done")}).catch(s=>{r(s instanceof Error?s.message:"Setup failed"),n("token")}).finally(()=>f(!1)))},[a,l,i]),O?e.jsx("div",{className:"setup-wizard",children:e.jsxs("div",{className:"setup-card",children:[e.jsx("h1",{className:"setup-title",children:o?"Reconfigure LobbyHA":"LobbyHA Setup"}),e.jsx("div",{className:"setup-progress",children:(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).map((s,m)=>e.jsxs("div",{className:`setup-step ${s===a?"active":""} ${(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).indexOf(a)>m?"completed":""}`,children:[e.jsx("div",{className:"step-dot",children:m+1}),e.jsx("span",{className:"step-label",children:s==="url"?"URL":s==="token"?"Token":s==="test"?"Test":s==="password"?"Password":s==="pin"?"PIN":"Done"})]},s))}),a==="url"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Home Assistant URL"}),e.jsx("p",{children:o?"Update your Home Assistant URL.":"Enter the URL of your Home Assistant instance."}),e.jsx("input",{className:"setup-input",value:l,onChange:s=>u(s.target.value),placeholder:"http://homeassistant.local:8123",autoFocus:!0}),e.jsx("p",{className:"note",children:"Usually http://homeassistant.local:8123 or your HA IP address."}),e.jsx("div",{className:"setup-actions",children:e.jsx("button",{type:"button",className:"action-button",onClick:()=>n("token"),disabled:!l.trim(),children:"Next â†’"})})]}),a==="token"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Access Token"}),o?e.jsx("p",{children:"Enter a new token or paste the existing one to re-verify."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Create a Long-Lived Access Token in Home Assistant:"}),e.jsxs("ol",{className:"setup-instructions",children:[e.jsx("li",{children:"Go to your HA Profile (click your name in the sidebar)"}),e.jsx("li",{children:'Scroll to "Long-Lived Access Tokens"'}),e.jsx("li",{children:'Click "Create Token"'}),e.jsx("li",{children:'Name it "LobbyHA" and copy the token'})]})]}),e.jsx("input",{className:"setup-input",type:"password",value:i,onChange:s=>T(s.target.value),placeholder:"Paste your token here",autoFocus:!0}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("url"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{n("test"),E()},disabled:!i.trim(),children:"Test Connection â†’"})]})]}),a==="test"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Testing Connection"}),F?e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."}):B?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"note",style:{color:"#4ade80"},children:["âœ“ Connected successfully!",A?` (HA ${A})`:""]}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>n(o?"done-reconfig":"password"),children:"Next â†’"})]})]}):x?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:E,children:"Retry"})]})]}):null]}),a==="password"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Set Admin Password"}),e.jsx("p",{children:"Connection successful! Now set your admin password."}),e.jsx("input",{className:"setup-input",type:"password",value:p,onChange:s=>R(s.target.value),placeholder:"Admin password",autoFocus:!0}),e.jsx("input",{className:"setup-input",type:"password",value:N,onChange:s=>U(s.target.value),placeholder:"Confirm password"}),e.jsx("div",{className:"setup-advanced",children:e.jsxs("details",{children:[e.jsx("summary",{children:"Advanced Settings"}),e.jsxs("div",{className:"form-field",style:{marginTop:"0.75rem"},children:[e.jsx("label",{children:"Server Port"}),e.jsx("input",{className:"setup-input",type:"number",value:C,onChange:s=>I(s.target.value),placeholder:"3000",min:"1",max:"65535"}),e.jsx("p",{className:"note",style:{marginTop:"0.25rem",fontSize:"0.82rem"},children:"Default: 3000. Change only if needed."})]})]})}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{r(null),n("pin")},disabled:!p||!N||p!==N||p.length<4,children:"Next â†’"})]})]}),a==="pin"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"ðŸ”’ Guest PIN Access"}),e.jsx("p",{children:"Control who can see your guest dashboard. When enabled, guests must enter a PIN before they can view any controls."}),e.jsxs("div",{className:"pin-setup-card",children:[e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>D(s.target.checked)}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest access"}),e.jsx("span",{className:"pin-toggle-hint",children:h?"âœ“ Enabled":"Disabled"})]}),h&&e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("ul",{className:"pin-list",style:{marginBottom:"0.75rem"},children:c.map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s.pin}),s.permanent&&e.jsx("span",{className:"pin-badge permanent",children:"permanent"}),!s.permanent&&e.jsx("span",{className:"pin-badge expiring",children:"7-day"}),e.jsx("button",{type:"button",onClick:()=>y(c.filter(m=>m.pin!==s.pin)),children:"âœ•"})]},s.pin))}),e.jsxs("div",{className:"pin-add-row",style:{marginBottom:"0.75rem"},children:[e.jsx("input",{value:j,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"&&j.trim()&&(y([...c,{pin:j.trim(),permanent:k}]),v(""),S(!1))},placeholder:"Enter a PIN (e.g. 1234)",autoFocus:!0}),e.jsxs("label",{className:"pin-permanent-toggle",title:"Permanent PINs never expire",children:[e.jsx("input",{type:"checkbox",checked:k,onChange:s=>S(s.target.checked)}),e.jsx("span",{children:"Permanent"})]}),e.jsx("button",{type:"button",onClick:()=>{j.trim()&&(y([...c,{pin:j.trim(),permanent:k}]),v(""),S(!1))},disabled:!j.trim(),children:"Add"})]}),c.length===0&&e.jsx("p",{className:"note error",style:{fontSize:"0.85rem"},children:"Add at least one PIN or disable PIN access."}),c.length>0&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0"},children:"ðŸ’¡ You can add multiple PINs â€” e.g. one per guest or group. Non-permanent PINs expire after 7 days."})]}),!h&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0",marginTop:"-0.5rem"},children:"Anyone with the URL can access the guest dashboard. You can enable this later in Settings."})]}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("password"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:z,disabled:H||h&&c.length===0,children:H?"Setting up...":"Complete Setup"})]})]}),a==="done"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Setup Complete! ðŸŽ‰"}),e.jsx("p",{children:"Your LobbyHA dashboard is ready."}),e.jsx("div",{className:"setup-actions",children:e.jsx("a",{href:"/admin",className:"action-button",children:"Open Admin Dashboard â†’"})})]})]})}):e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading configuration..."})})}function G(){const[d,o]=t.useState(null),[a,n]=t.useState(),[l,u]=t.useState(!1);return t.useEffect(()=>{b("/api/setup/status").then(i=>{o(i.needsSetup),i.config&&n(i.config)}).catch(()=>o(!0))},[]),d===null?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Checking setup status..."})}):!d&&!l?e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Already Configured"}),e.jsx("p",{className:"note",children:"Your LobbyHA dashboard is already set up."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("a",{href:"/admin",className:"action-button",children:"Admin Dashboard"}),e.jsx("a",{href:"/",className:"action-button secondary",children:"Guest Dashboard"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>u(!0),children:"Reconfigure"})]})]}):e.jsx(Y,{existingConfig:a,reconfigure:l})}_.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(G,{})}));
