import{r as t,a as b,j as e,c as T}from"./index-D630IaMI.js";function U({existingConfig:d,reconfigure:o}={}){const[a,n]=t.useState("url"),[l,u]=t.useState(""),[c,w]=t.useState(""),[p,A]=t.useState(""),[f,P]=t.useState(""),[L,v]=t.useState(!1),[x,r]=t.useState(null),[S,N]=t.useState(!1),[E,y]=t.useState(!1),[h,H]=t.useState(!1),[i,g]=t.useState([]),[j,k]=t.useState("");t.useEffect(()=>{if(d){d.HA_URL&&d.HA_URL!=="http://localhost:8123"?u(d.HA_URL):u("http://homeassistant.local:8123"),y(!0);return}b("/api/setup/status").then(s=>{var m;(m=s.config)!=null&&m.HA_URL&&s.config.HA_URL!=="http://localhost:8123"?u(s.config.HA_URL):u("http://homeassistant.local:8123"),y(!0)}).catch(()=>{u("http://homeassistant.local:8123"),y(!0)})},[d]);const C=async()=>{v(!0),r(null);try{const s=await b("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:l,haToken:c})});s.success?n(o?"done-reconfig":"password"):r(s.error||"Connection failed")}catch(s){r(s instanceof Error?s.message:"Connection test failed")}finally{v(!1)}},R=async()=>{if(!o){if(p!==f){r("Passwords do not match");return}if(p.length<4){r("Password must be at least 4 characters");return}}N(!0),r(null);try{await b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:l,haToken:c,adminPassword:o?void 0:p,pinEnabled:h||void 0,pins:h&&i.length>0?i:void 0})}),n("done")}catch(s){r(s instanceof Error?s.message:"Setup failed")}finally{N(!1)}};return t.useEffect(()=>{a==="done-reconfig"&&(N(!0),b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:l,haToken:c})}).then(()=>{n("done")}).catch(s=>{r(s instanceof Error?s.message:"Setup failed"),n("token")}).finally(()=>N(!1)))},[a,l,c]),E?e.jsx("div",{className:"setup-wizard",children:e.jsxs("div",{className:"setup-card",children:[e.jsx("h1",{className:"setup-title",children:o?"Reconfigure LobbyHA":"LobbyHA Setup"}),e.jsx("div",{className:"setup-progress",children:(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).map((s,m)=>e.jsxs("div",{className:`setup-step ${s===a?"active":""} ${(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).indexOf(a)>m?"completed":""}`,children:[e.jsx("div",{className:"step-dot",children:m+1}),e.jsx("span",{className:"step-label",children:s==="url"?"URL":s==="token"?"Token":s==="test"?"Test":s==="password"?"Password":s==="pin"?"PIN":"Done"})]},s))}),a==="url"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Home Assistant URL"}),e.jsx("p",{children:o?"Update your Home Assistant URL.":"Enter the URL of your Home Assistant instance."}),e.jsx("input",{className:"setup-input",value:l,onChange:s=>u(s.target.value),placeholder:"http://homeassistant.local:8123",autoFocus:!0}),e.jsx("p",{className:"note",children:"Usually http://homeassistant.local:8123 or your HA IP address."}),e.jsx("div",{className:"setup-actions",children:e.jsx("button",{type:"button",className:"action-button",onClick:()=>n("token"),disabled:!l.trim(),children:"Next â†’"})})]}),a==="token"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Access Token"}),o?e.jsx("p",{children:"Enter a new token or paste the existing one to re-verify."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Create a Long-Lived Access Token in Home Assistant:"}),e.jsxs("ol",{className:"setup-instructions",children:[e.jsx("li",{children:"Go to your HA Profile (click your name in the sidebar)"}),e.jsx("li",{children:'Scroll to "Long-Lived Access Tokens"'}),e.jsx("li",{children:'Click "Create Token"'}),e.jsx("li",{children:'Name it "LobbyHA" and copy the token'})]})]}),e.jsx("input",{className:"setup-input",type:"password",value:c,onChange:s=>w(s.target.value),placeholder:"Paste your token here",autoFocus:!0}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("url"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{n("test"),C()},disabled:!c.trim(),children:"Test Connection â†’"})]})]}),a==="test"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Testing Connection"}),L?e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."}):x?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:C,children:"Retry"})]})]}):null]}),a==="password"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Set Admin Password"}),e.jsx("p",{children:"Connection successful! Now set your admin password."}),e.jsx("input",{className:"setup-input",type:"password",value:p,onChange:s=>A(s.target.value),placeholder:"Admin password",autoFocus:!0}),e.jsx("input",{className:"setup-input",type:"password",value:f,onChange:s=>P(s.target.value),placeholder:"Confirm password"}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{r(null),n("pin")},disabled:!p||!f||p!==f||p.length<4,children:"Next â†’"})]})]}),a==="pin"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"ðŸ”’ Guest PIN Access"}),e.jsx("p",{children:"Control who can see your guest dashboard. When enabled, guests must enter a PIN before they can view any controls."}),e.jsxs("div",{className:"pin-setup-card",children:[e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>H(s.target.checked)}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest access"}),e.jsx("span",{className:"pin-toggle-hint",children:h?"âœ“ Enabled":"Disabled"})]}),h&&e.jsxs(e.Fragment,{children:[i.length>0&&e.jsx("ul",{className:"pin-list",style:{marginBottom:"0.75rem"},children:i.map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>g(i.filter(m=>m!==s)),children:"âœ•"})]},s))}),e.jsxs("div",{className:"pin-add-row",style:{marginBottom:"0.75rem"},children:[e.jsx("input",{value:j,onChange:s=>k(s.target.value),onKeyDown:s=>{s.key==="Enter"&&j.trim()&&(g([...i,j.trim()]),k(""))},placeholder:"Enter a PIN (e.g. 1234)",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>{j.trim()&&(g([...i,j.trim()]),k(""))},disabled:!j.trim(),children:"Add"})]}),i.length===0&&e.jsx("p",{className:"note error",style:{fontSize:"0.85rem"},children:"Add at least one PIN or disable PIN access."}),i.length>0&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0"},children:"ðŸ’¡ You can add multiple PINs â€” e.g. one per guest or group. Sessions last 7 days."})]}),!h&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0",marginTop:"-0.5rem"},children:"Anyone with the URL can access the guest dashboard. You can enable this later in Settings."})]}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("password"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:R,disabled:S||h&&i.length===0,children:S?"Setting up...":"Complete Setup"})]})]}),a==="done"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Setup Complete! ðŸŽ‰"}),e.jsx("p",{children:"Your LobbyHA dashboard is ready."}),e.jsx("div",{className:"setup-actions",children:e.jsx("a",{href:"/admin",className:"action-button",children:"Open Admin Dashboard â†’"})})]})]})}):e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading configuration..."})})}function I(){const[d,o]=t.useState(null),[a,n]=t.useState(),[l,u]=t.useState(!1);return t.useEffect(()=>{b("/api/setup/status").then(c=>{o(c.needsSetup),c.config&&n(c.config)}).catch(()=>o(!0))},[]),d===null?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Checking setup status..."})}):!d&&!l?e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Already Configured"}),e.jsx("p",{className:"note",children:"Your LobbyHA dashboard is already set up."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("a",{href:"/admin",className:"action-button",children:"Admin Dashboard"}),e.jsx("a",{href:"/",className:"action-button secondary",children:"Guest Dashboard"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>u(!0),children:"Reconfigure"})]})]}):e.jsx(U,{existingConfig:a,reconfigure:l})}T.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(I,{})}));
