import{r as u,a as I,j as e,g as Ut,c as Ot}from"./index-DB0qu6yo.js";import{d as Ge,r as He,l as Et,i as ue,I as ge,E as qt,h as Ft,e as Ht}from"./EntityCard-B9flHlKp.js";function zt({sessionId:i,modules:o,onAssignEntity:r,onClose:n}){const[t,s]=u.useState([]),[a,l]=u.useState([]),[c,h]=u.useState([]),[b,N]=u.useState(!0),[p,f]=u.useState(""),[v,R]=u.useState(null),[M,g]=u.useState(!1),j=u.useMemo(()=>{const d=new Map;return o.forEach(L=>L.entities.forEach(m=>d.set(m,L.id))),d},[o]),S=u.useCallback(async(d=!1)=>{d?g(!0):N(!0);try{const y=await I(d?"/api/discovery/refresh":"/api/discovery/entities",d?{method:"POST",sessionId:i}:{sessionId:i});l(y.entities),s(y.entities),h(y.domains.map(w=>({domain:w.domain,label:w.label,count:w.entities.length})))}catch{}finally{N(!1),g(!1)}},[i]);return u.useEffect(()=>{S()},[S]),u.useEffect(()=>{let d=a;if(v&&(d=d.filter(L=>L.domain===v)),p){const L=p.toLowerCase();d=d.filter(m=>{var y;return m.entity_id.toLowerCase().includes(L)||m.name.toLowerCase().includes(L)||(((y=m.area)==null?void 0:y.toLowerCase().includes(L))??!1)})}s(d)},[a,p,v]),e.jsx("div",{className:"modal-overlay",onClick:n,children:e.jsxs("div",{className:"modal",style:{maxWidth:"700px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Discover Entities (",a.length," total)"]}),e.jsx("button",{type:"button",className:"action-button",onClick:n,children:"Close"})]}),e.jsxs("div",{className:"discovery-search",children:[e.jsx("input",{type:"text",placeholder:"Search entities...",value:p,onChange:d=>f(d.target.value),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!0),disabled:M,children:M?"Refreshing...":"üîÑ Refresh"})]}),e.jsxs("div",{className:"domain-filter",children:[e.jsxs("button",{type:"button",className:`domain-chip ${v===null?"active":""}`,onClick:()=>R(null),children:["All (",a.length,")"]}),c.length===0&&!b&&e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)",alignSelf:"center"},children:"No entity types found"}),c.map(d=>e.jsxs("button",{type:"button",className:`domain-chip ${v===d.domain?"active":""}`,onClick:()=>R(v===d.domain?null:d.domain),children:[Ge(d.domain)," ",d.label," (",d.count,")"]},d.domain))]}),b?e.jsx("p",{className:"note",children:"Loading entities..."}):e.jsxs("ul",{className:"discovery-entity-list",children:[t.map(d=>{const L=j.get(d.entity_id),m=L!==void 0;return e.jsxs("li",{className:`discovery-entity-item ${m?"on-dashboard":""}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"discovery-entity-name",children:[Ge(d.domain)," ",d.name]}),e.jsx("div",{className:"discovery-entity-id",children:d.entity_id})]}),e.jsx("span",{className:"discovery-entity-state",children:d.state}),e.jsxs("select",{className:"discovery-area-select",value:L??"",onChange:y=>{const w=y.target.value;r(d.entity_id,w===""?null:Number(w))},children:[e.jsx("option",{value:"",children:"‚Äî None ‚Äî"}),o.map(y=>e.jsxs("option",{value:y.id,children:[y.icon," ",y.name]},y.id))]})]},d.entity_id)}),t.length===0&&e.jsx("p",{className:"note",children:"No entities found matching your criteria."})]})]})})}const We=[{label:"Home",emojis:["üè†","üè°","üè¢","üèó","üèò","üè∞","üõè","üõã","üö™","ü™ü","üèï","‚õ∫","üß±"]},{label:"Rooms",emojis:["üõÅ","üöø","üöΩ","ü™•","üç≥","üçΩ","üßë‚Äçüç≥","üì∫","üéÆ","üíª","üñ•","üìö","üéµ","üé∏","üéπ"]},{label:"Lighting",emojis:["üí°","üî¶","üïØ","üåü","‚ú®","‚≠ê","üåô","‚òÄÔ∏è","üîÜ","üîÖ","ü™î"]},{label:"Climate",emojis:["üå°","‚ùÑÔ∏è","üî•","üí®","üåÄ","‚òÅÔ∏è","üå§","üåß","üåä","üíß","üßä"]},{label:"Security",emojis:["üîí","üîì","üîë","üõ°","üìπ","üì∑","üö®","üîî","üö´","‚ö†Ô∏è","üëÅ"]},{label:"Outdoor",emojis:["üå≥","üå≤","üåø","üå∫","üåª","üå¥","üèä","üÖøÔ∏è","üöó","üèã","üßπ","üóë"]},{label:"Appliances",emojis:["üß∫","üëï","ü´ß","üßä","üçï","‚òï","üßÉ","ü•§","üßΩ","ü™£","üîå","üîã","‚ö°"]},{label:"General",emojis:["üì¶","üéØ","üé®","üß©","üõ†","‚öôÔ∏è","üìä","üìà","üóÇ","üìã","‚úÖ","‚ùå","‚ûï","üîÑ"]}];function Qe({value:i,onChange:o}){const[r,n]=u.useState(!1),[t,s]=u.useState(""),a=u.useRef(null),l=u.useRef(null),[c,h]=u.useState({top:0,left:0});u.useEffect(()=>{if(r&&a.current){const p=a.current.getBoundingClientRect();h({top:p.bottom+6,left:Math.max(8,p.left-100)})}},[r]),u.useEffect(()=>{if(!r)return;const p=f=>{l.current&&!l.current.contains(f.target)&&a.current&&!a.current.contains(f.target)&&n(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[r]);const b=We.flatMap(p=>p.emojis),N=t.trim()?b.filter(()=>!0):null;return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:a,type:"button",className:"emoji-picker-trigger",onClick:()=>n(!r),title:"Pick icon",children:i||"üè†"}),r&&He.createPortal(e.jsx("div",{ref:l,className:"emoji-picker-panel",style:{top:c.top,left:c.left},children:e.jsx("div",{className:"emoji-picker-grid",children:(N??We.flatMap(p=>p.emojis)).map((p,f)=>e.jsx("button",{type:"button",className:`emoji-picker-item${p===i?" selected":""}`,onClick:()=>{o(p),n(!1)},children:p},`${p}-${f}`))})}),document.body)]})}function Jt({sessionId:i,modules:o,onModulesChange:r,onClose:n}){const[t,s]=u.useState(""),[a,l]=u.useState("üè†"),[c,h]=u.useState(null),[b,N]=u.useState(""),[p,f]=u.useState(""),v=u.useCallback(async()=>{const d=await I("/api/ui/modules",{sessionId:i});r(d.modules)},[i,r]),R=async()=>{t.trim()&&(await I("/api/ui/modules",{method:"POST",sessionId:i,body:JSON.stringify({name:t.trim(),icon:a})}),s(""),l("üè†"),v())},M=async d=>{await I(`/api/ui/modules/${d}`,{method:"PUT",sessionId:i,body:JSON.stringify({name:b,icon:p})}),h(null),v()},g=async d=>{confirm("Delete this area and remove all entity assignments?")&&(await I(`/api/ui/modules/${d}`,{method:"DELETE",sessionId:i}),v())},j=async d=>{await I(`/api/ui/modules/${d.id}`,{method:"PUT",sessionId:i,body:JSON.stringify({visible:!d.visible})}),v()},S=async(d,L)=>{const m=o.findIndex(C=>C.id===d);if(m<0)return;const y=[...o.map(C=>C.id)],w=L==="up"?m-1:m+1;w<0||w>=y.length||([y[m],y[w]]=[y[w],y[m]],await I("/api/ui/modules/reorder",{method:"POST",sessionId:i,body:JSON.stringify({moduleIds:y})}),v())};return e.jsx("div",{className:"modal-overlay",onClick:n,children:e.jsxs("div",{className:"modal",style:{maxWidth:"550px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Manage Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:n,children:"Close"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center"},children:[e.jsx(Qe,{value:a,onChange:l}),e.jsx("input",{style:{flex:1},value:t,onChange:d=>s(d.target.value),placeholder:"Area name...",onKeyDown:d=>d.key==="Enter"&&R()}),e.jsx("button",{type:"button",className:"action-button",onClick:R,children:"Add"})]}),e.jsxs("ul",{className:"hidden-list",children:[o.map((d,L)=>e.jsx("li",{children:c===d.id?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:1,alignItems:"center"},children:[e.jsx(Qe,{value:p,onChange:f}),e.jsx("input",{style:{flex:1},value:b,onChange:m=>N(m.target.value),onKeyDown:m=>m.key==="Enter"&&M(d.id),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>M(d.id),children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>h(null),children:"‚úï"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"hidden-name",children:[d.icon," ",d.name]}),e.jsxs("div",{className:"hidden-id",children:[d.entities.length," entities ¬∑ ",d.visible?"visible":"hidden"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(d.id,"up"),disabled:L===0,children:"‚Üë"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(d.id,"down"),disabled:L===o.length-1,children:"‚Üì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>j(d),children:d.visible?"üëÅ":"üëÅ‚Äçüó®"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{h(d.id),N(d.name),f(d.icon)},children:"‚úèÔ∏è"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>g(d.id),children:"üóë"})]})]})},d.id)),o.length===0&&e.jsx("p",{className:"note",children:"No areas yet. Create one above to organize your entities."})]})]})})}function St({sessionId:i,onClose:o,inline:r,onSaved:n}){const[t,s]=u.useState(""),[a,l]=u.useState("‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"),[c,h]=u.useState(""),[b,N]=u.useState("INFO"),[p,f]=u.useState(""),[v,R]=u.useState(!1),[M,g]=u.useState(!1),[j,S]=u.useState(!1),[d,L]=u.useState([]),[m,y]=u.useState(null),[w,C]=u.useState(!1),[A,k]=u.useState([]),[T,P]=u.useState(""),[B,V]=u.useState(!1),[J,Z]=u.useState(!1);j||I("/api/admin/config",{sessionId:i}).then(E=>{E.success&&(s(E.config.HA_URL||""),l(E.config.HA_TOKEN||""),h(E.config.PORT||"3000"),N(E.config.LOG_LEVEL||"INFO"),f(E.config.ALLOWED_ENTITIES||""),L(E.missing||[])),S(!0)}).catch(()=>S(!0)),B||I("/api/guest/settings",{sessionId:i}).then(E=>{C(E.pinEnabled),k(E.pins),V(!0)}).catch(()=>V(!0));const K=E=>d.includes(E),te=async()=>{g(!0),y(null);try{const H=await I("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:t,haToken:(a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?"":a)||void 0})});H.success?y({type:"success",message:"Connection successful!"}):y({type:"error",message:H.error||"Connection failed"})}catch(E){y({type:"error",message:E instanceof Error?E.message:"Test failed"})}finally{g(!1)}},X=async()=>{if(!t.trim()){y({type:"error",message:"Home Assistant URL is required"});return}if(!a.trim()||a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&K("HA_TOKEN")){y({type:"error",message:"Access token is required. Please enter your HA long-lived token."});return}R(!0),y(null);try{await I("/api/admin/config",{method:"POST",sessionId:i,body:JSON.stringify({haUrl:t,haToken:a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?void 0:a,port:c,logLevel:b,allowedEntities:p})}),L(E=>E.filter(q=>q==="HA_URL"&&!t.trim()||q==="HA_TOKEN"&&!a.trim())),y({type:"success",message:"Settings saved! Reload to apply."}),n==null||n()}catch(E){y({type:"error",message:E instanceof Error?E.message:"Failed to save"})}finally{R(!1)}},G=async(E,q)=>{Z(!0);try{const H=await I("/api/guest/settings",{method:"POST",sessionId:i,body:JSON.stringify({pinEnabled:E,pins:q})});C(H.pinEnabled),k(H.pins)}catch{}finally{Z(!1)}},ne=()=>{const E=!w;C(E),G(E,A)},Y=()=>{const E=T.trim();if(!E||A.includes(E))return;const q=[...A,E];k(q),P(""),G(w,q)},re=E=>{const q=A.filter(H=>H!==E);k(q),G(w,q)},W=d.length>0,$=e.jsxs("div",{className:r?"":"modal settings-modal",onClick:E=>E.stopPropagation(),children:[!r&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Settings"}),e.jsx("button",{type:"button",className:"action-button",onClick:o,children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üîí Guest PIN Access"}),e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:ne,disabled:J}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest dashboard"}),e.jsx("span",{className:"pin-toggle-hint",children:w?"Enabled":"Disabled"})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{fontSize:"0.85rem",color:"#8a9bc0",display:"block",marginBottom:"0.5rem"},children:["Allowed PINs (",A.length,")"]}),A.length>0&&e.jsx("ul",{className:"pin-list",children:A.map(E=>e.jsxs("li",{children:[e.jsx("span",{children:E}),e.jsx("button",{type:"button",onClick:()=>re(E),title:"Remove PIN",disabled:J,children:"‚úï"})]},E))}),e.jsxs("div",{className:"pin-add-row",children:[e.jsx("input",{value:T,onChange:E=>P(E.target.value),onKeyDown:E=>{E.key==="Enter"&&Y()},placeholder:"Enter new PIN",disabled:J}),e.jsx("button",{type:"button",onClick:Y,disabled:J||!T.trim(),children:"Add"})]}),w&&A.length===0&&e.jsx("p",{className:"note error",style:{marginTop:"0.5rem",fontSize:"0.85rem"},children:"‚ö† PIN is enabled but no PINs are set. Guests won't be able to access the dashboard."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üåê Server Connection"}),W&&e.jsx("p",{className:"note error",style:{marginBottom:"0.75rem"},children:"Required settings are missing. Please fill in the highlighted fields."}),e.jsxs("div",{className:`form-field${K("HA_URL")?" field-missing":""}`,children:[e.jsxs("label",{children:["Home Assistant URL",K("HA_URL")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:t,onChange:E=>s(E.target.value),placeholder:"http://homeassistant.local:8123"}),K("HA_URL")&&e.jsx("span",{className:"field-hint",children:"Enter your Home Assistant URL (e.g. http://192.168.1.x:8123)"})]}),e.jsxs("div",{className:`form-field${K("HA_TOKEN")?" field-missing":""}`,children:[e.jsxs("label",{children:["Long-Lived Access Token",K("HA_TOKEN")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:a,onChange:E=>l(E.target.value),type:"password",placeholder:K("HA_TOKEN")?"Paste your HA token here":""}),K("HA_TOKEN")&&e.jsx("span",{className:"field-hint",children:"Create a token in HA ‚Üí Profile ‚Üí Long-Lived Access Tokens ‚Üí Create Token"})]}),m&&e.jsx("p",{className:`note ${m.type}`,children:m.message}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:te,disabled:M||!t,children:M?"Testing...":"Test Connection"}),e.jsx("button",{type:"button",className:"action-button",onClick:X,disabled:v,children:v?"Saving...":W?"Save & Configure":"Save Settings"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"‚ö° Advanced"}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Server Port"}),e.jsx("input",{value:c,onChange:E=>h(E.target.value),placeholder:"3000"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Log Level"}),e.jsxs("select",{value:b,onChange:E=>N(E.target.value),children:[e.jsx("option",{value:"DEBUG",children:"DEBUG"}),e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"WARNING",children:"WARNING"}),e.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:["Allowed Entities ",e.jsx("span",{style:{fontWeight:400,opacity:.7},children:"(optional, comma-separated)"})]}),e.jsx("input",{value:p,onChange:E=>f(E.target.value),placeholder:"light.living_room, switch.bedroom (leave empty for all)"}),e.jsx("span",{className:"field-hint",children:"Limit which entities are exposed. Leave empty to allow all."})]})]})]})]});return r?$:e.jsx("div",{className:"modal-overlay",onClick:o,children:$})}const kt=[{label:"Lighting",color:"#ffd54f",icons:["mdi:lightbulb","mdi:lightbulb-outline","mdi:lightbulb-group","mdi:lightbulb-on","mdi:lamp","mdi:floor-lamp","mdi:desk-lamp","mdi:ceiling-light","mdi:led-strip","mdi:led-strip-variant","mdi:track-light","mdi:wall-sconce","mdi:wall-sconce-round","mdi:vanity-light","mdi:chandelier","mdi:outdoor-lamp","mdi:lava-lamp","mdi:string-lights","mdi:light-switch","mdi:brightness-5"]},{label:"Climate",color:"#4fc3f7",icons:["mdi:thermometer","mdi:thermometer-half","mdi:thermometer-high","mdi:thermometer-low","mdi:air-conditioner","mdi:hvac","mdi:fan","mdi:fan-off","mdi:snowflake","mdi:fire","mdi:water-percent","mdi:weather-windy","mdi:heat-wave","mdi:coolant-temperature","mdi:radiator","mdi:air-humidifier","mdi:air-purifier","mdi:air-filter","mdi:thermostat","mdi:thermostat-box"]},{label:"Security",color:"#ef5350",icons:["mdi:lock","mdi:lock-open","mdi:lock-smart","mdi:shield-home","mdi:shield-lock","mdi:alarm-light","mdi:bell-ring","mdi:bell","mdi:cctv","mdi:video-surveillance","mdi:camera","mdi:camera-iris","mdi:motion-sensor","mdi:door-sensor","mdi:window-sensor","mdi:smoke-detector","mdi:fire-alert","mdi:siren","mdi:shield-check","mdi:security"]},{label:"Doors & Windows",color:"#ab47bc",icons:["mdi:door","mdi:door-open","mdi:door-closed","mdi:door-closed-lock","mdi:window-closed","mdi:window-open","mdi:window-shutter","mdi:window-shutter-open","mdi:blinds","mdi:blinds-open","mdi:curtains","mdi:curtains-closed","mdi:garage","mdi:garage-open","mdi:gate","mdi:gate-open","mdi:roller-shade","mdi:roller-shade-closed","mdi:awning","mdi:awning-outline"]},{label:"Rooms",color:"#66bb6a",icons:["mdi:sofa","mdi:bed","mdi:bed-double","mdi:bunk-bed","mdi:bathtub","mdi:shower","mdi:toilet","mdi:sink","mdi:television","mdi:desk","mdi:table-furniture","mdi:wardrobe","mdi:bookshelf","mdi:chair-rolling","mdi:stairs","mdi:elevator","mdi:room-service","mdi:baby-carriage","mdi:toy-brick","mdi:cradle"]},{label:"Kitchen",color:"#ff7043",icons:["mdi:fridge","mdi:fridge-outline","mdi:stove","mdi:microwave","mdi:dishwasher","mdi:coffee-maker","mdi:toaster-oven","mdi:blender","mdi:food-fork-drink","mdi:pot-steam","mdi:silverware-fork-knife","mdi:glass-wine","mdi:beer","mdi:water-pump","mdi:faucet","mdi:countertop","mdi:kettle","mdi:grill","mdi:ice-cream","mdi:food-apple"]},{label:"Media",color:"#7e57c2",icons:["mdi:speaker","mdi:speaker-wireless","mdi:cast","mdi:cast-audio","mdi:play-circle","mdi:pause-circle","mdi:skip-next","mdi:skip-previous","mdi:volume-high","mdi:volume-medium","mdi:volume-low","mdi:volume-off","mdi:headphones","mdi:microphone","mdi:music","mdi:music-note","mdi:radio","mdi:gamepad-variant","mdi:monitor","mdi:projector"]},{label:"Power & Energy",color:"#ffa726",icons:["mdi:power-plug","mdi:power-plug-off","mdi:power-socket","mdi:flash","mdi:flash-off","mdi:battery","mdi:battery-charging","mdi:battery-50","mdi:battery-alert","mdi:solar-power","mdi:solar-panel","mdi:wind-turbine","mdi:ev-station","mdi:meter-electric","mdi:transmission-tower","mdi:power-cycle","mdi:lightning-bolt","mdi:electric-switch","mdi:surge-protector","mdi:battery-heart"]},{label:"Sensors",color:"#26c6da",icons:["mdi:eye","mdi:motion-sensor","mdi:run","mdi:walk","mdi:water-alert","mdi:leak","mdi:gauge","mdi:speedometer","mdi:scale-bathroom","mdi:pulse","mdi:heart-pulse","mdi:signal","mdi:signal-cellular-3","mdi:wifi","mdi:bluetooth","mdi:nfc","mdi:chip","mdi:counter","mdi:timer-sand","mdi:clock-outline"]},{label:"Weather",color:"#42a5f5",icons:["mdi:weather-sunny","mdi:weather-night","mdi:weather-cloudy","mdi:weather-partly-cloudy","mdi:weather-rainy","mdi:weather-pouring","mdi:weather-snowy","mdi:weather-snowy-heavy","mdi:weather-lightning","mdi:weather-fog","mdi:weather-windy-variant","mdi:weather-hail","mdi:umbrella","mdi:sunglasses","mdi:moon-waning-crescent","mdi:sun-compass","mdi:thermometer-lines","mdi:waves","mdi:weather-tornado","mdi:weather-hurricane"]},{label:"Outdoor & Garden",color:"#8bc34a",icons:["mdi:tree","mdi:flower","mdi:flower-tulip","mdi:leaf","mdi:sprout","mdi:grass","mdi:mushroom","mdi:cactus","mdi:water","mdi:watering-can","mdi:sprinkler","mdi:sprinkler-variant","mdi:lawn-mower","mdi:shovel","mdi:rake","mdi:grill-outline","mdi:pool","mdi:hot-tub","mdi:fence","mdi:patio-heater"]},{label:"Appliances",color:"#78909c",icons:["mdi:washing-machine","mdi:tumble-dryer","mdi:iron","mdi:vacuum","mdi:vacuum-outline","mdi:robot-vacuum","mdi:water-boiler","mdi:water-heater","mdi:hair-dryer","mdi:printer-3d","mdi:printer","mdi:router-wireless","mdi:access-point","mdi:nas","mdi:server","mdi:cellphone","mdi:laptop","mdi:tablet","mdi:watch","mdi:keyboard"]},{label:"Transport",color:"#5c6bc0",icons:["mdi:car","mdi:car-electric","mdi:car-connected","mdi:car-door","mdi:garage-variant","mdi:bicycle","mdi:motorbike","mdi:scooter","mdi:bus","mdi:train","mdi:airplane","mdi:boat","mdi:parking","mdi:gas-station","mdi:ev-plug-type2","mdi:map-marker","mdi:compass","mdi:navigation","mdi:road","mdi:traffic-light"]},{label:"People & Home",color:"#ec407a",icons:["mdi:home","mdi:home-outline","mdi:home-variant","mdi:home-assistant","mdi:account","mdi:account-group","mdi:account-child","mdi:dog","mdi:cat","mdi:paw","mdi:baby-face-outline","mdi:human-male-female","mdi:human-greeting","mdi:hand-wave","mdi:phone","mdi:email","mdi:calendar","mdi:bell-alert","mdi:heart","mdi:star"]},{label:"Automation & System",color:"#78909c",icons:["mdi:cog","mdi:cog-outline","mdi:wrench","mdi:tools","mdi:auto-fix","mdi:robot","mdi:script-text","mdi:code-tags","mdi:webhook","mdi:api","mdi:cloud","mdi:database","mdi:update","mdi:reload","mdi:sync","mdi:timer","mdi:toggle-switch","mdi:numeric","mdi:form-select","mdi:palette","mdi:format-paint"]}],qe=kt.flatMap(i=>i.icons.map(o=>({icon:o,color:i.color,category:i.label}))),Kt=qe.map(i=>i.icon);let Ye=!1,Fe=!1;const me=[];function Vt(){Ye||(Ye=!0,Et(Kt,(i,o,r)=>{Fe=!0;for(const n of me)n();me.length=0}))}Vt();function Gt({value:i,onChange:o}){const[r,n]=u.useState(!1),[t,s]=u.useState(""),[a,l]=u.useState(null),[c,h]=u.useState(Fe),b=u.useRef(null),N=u.useRef(null),[p,f]=u.useState({top:0,left:0});u.useEffect(()=>{if(Fe){h(!0);return}const g=()=>h(!0);return me.push(g),()=>{const j=me.indexOf(g);j>=0&&me.splice(j,1)}},[]),u.useEffect(()=>{if(r&&b.current){const g=b.current.getBoundingClientRect(),j=360,S=420;let d=g.bottom+6,L=g.left;L+j>window.innerWidth-8&&(L=window.innerWidth-j-8),d+S>window.innerHeight-8&&(d=g.top-S-6),f({top:Math.max(8,d),left:Math.max(8,L)})}},[r]),u.useEffect(()=>{if(!r)return;const g=j=>{N.current&&!N.current.contains(j.target)&&b.current&&!b.current.contains(j.target)&&n(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[r]),u.useEffect(()=>{if(!r)return;const g=j=>{j.key==="Escape"&&n(!1)};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[r]);const v=u.useMemo(()=>{const g=t.trim().toLowerCase();return!g&&!a?qe:qe.filter(j=>a&&j.category!==a?!1:g?j.icon.replace("mdi:","").replace(/-/g," ").includes(g)||j.category.toLowerCase().includes(g):!0)},[t,a]),R=i||"mdi:lightbulb",M=!i||ue(i);return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:b,type:"button",className:"icon-picker-trigger",onClick:()=>n(!r),title:"Pick icon",children:M?e.jsx(ge,{icon:R,width:22,height:22}):e.jsx("span",{style:{width:22,height:22,display:"inline-block",opacity:.3},children:"‚öô"})}),r&&He.createPortal(e.jsxs("div",{ref:N,className:"icon-picker-panel",style:{top:p.top,left:p.left},children:[e.jsx("div",{className:"icon-picker-search",children:e.jsx("input",{type:"text",placeholder:"Search icons...",value:t,onChange:g=>s(g.target.value),autoFocus:!0})}),e.jsxs("div",{className:"icon-picker-categories",children:[e.jsx("button",{type:"button",className:`icon-cat-tab${a?"":" active"}`,onClick:()=>l(null),style:{"--cat-color":"#aaa"},children:"All"}),kt.map(g=>e.jsx("button",{type:"button",className:`icon-cat-tab${a===g.label?" active":""}`,onClick:()=>l(a===g.label?null:g.label),style:{"--cat-color":g.color},title:g.label,children:g.label},g.label))]}),e.jsx("div",{className:"icon-picker-grid",children:c?e.jsxs(e.Fragment,{children:[v.map((g,j)=>e.jsx("button",{type:"button",className:`icon-picker-item${g.icon===i?" selected":""}`,onClick:()=>{o(g.icon),n(!1)},title:g.icon.replace("mdi:","").replace(/-/g," "),style:{color:g.color},children:ue(g.icon)?e.jsx(ge,{icon:g.icon,width:24,height:24}):e.jsx("span",{style:{width:24,height:24,display:"inline-block",borderRadius:4,background:"rgba(255,255,255,0.05)"}})},`${g.icon}-${j}`)),v.length===0&&e.jsxs("p",{className:"icon-picker-empty",children:['No icons match "',t,'"']})]}):e.jsx("p",{className:"icon-picker-empty",children:"Loading icons..."})})]}),document.body)]})}function Wt({entityId:i,friendlyName:o,sessionId:r,anchorRect:n,onClose:t,onSave:s,onHide:a}){const[l,c]=u.useState(""),[h,b]=u.useState(""),[N,p]=u.useState(!0),[f,v]=u.useState(!1),[,R]=u.useState(0);u.useEffect(()=>{const m=["mdi:cog","mdi:eye-off"];h&&!ue(h)&&m.push(h),Et(m,()=>R(y=>y+1))},[h]),u.useEffect(()=>{(async()=>{try{const m=await I(`/api/ui/entity-props/${encodeURIComponent(i)}`,{sessionId:r});c(m.props.custom_name||""),b(m.props.custom_icon||"")}catch{}finally{p(!1)}})()},[i,r]);const M=u.useCallback(async()=>{v(!0);try{await I(`/api/ui/entity-props/${encodeURIComponent(i)}`,{method:"POST",sessionId:r,body:JSON.stringify({custom_name:l.trim()||null,custom_icon:h||null})}),s(),t()}catch(m){console.error("Save entity props failed:",m)}finally{v(!1)}},[i,r,l,h,s,t]),g=u.useCallback(async()=>{try{await I(`/api/ui/entity-props/${encodeURIComponent(i)}`,{method:"DELETE",sessionId:r}),c(""),b(""),s(),t()}catch(m){console.error("Reset entity props failed:",m)}},[i,r,s,t]),j=320,S=260;let d=n.bottom+8,L=n.left-j/2+n.width/2;return L+j>window.innerWidth-8&&(L=window.innerWidth-j-8),L<8&&(L=8),d+S>window.innerHeight-8&&(d=n.top-S-8),He.createPortal(e.jsx("div",{className:"entity-prop-overlay",onClick:t,children:e.jsx("div",{className:"entity-prop-editor",style:{top:d,left:L,width:j},onClick:m=>m.stopPropagation(),children:N?e.jsx("p",{className:"note",style:{textAlign:"center",padding:"1rem"},children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entity-prop-header",children:[ue("mdi:cog")?e.jsx(ge,{icon:"mdi:cog",width:16,height:16}):e.jsx("span",{children:"‚öô"}),e.jsx("span",{className:"entity-prop-title",children:o}),e.jsx("button",{type:"button",className:"entity-prop-close",onClick:t,children:"√ó"})]}),e.jsxs("div",{className:"entity-prop-body",children:[e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Icon"}),e.jsxs("div",{className:"entity-prop-icon-row",children:[e.jsx(Gt,{value:h,onChange:b}),h&&e.jsx("span",{className:"entity-prop-icon-name",children:h.replace("mdi:","")}),h&&e.jsx("button",{type:"button",className:"entity-prop-clear-btn",onClick:()=>b(""),title:"Clear icon override",children:"√ó"})]})]}),e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",value:l,onChange:m=>c(m.target.value),placeholder:o,className:"entity-prop-input"})]})]}),e.jsxs("div",{className:"entity-prop-actions",children:[e.jsxs("button",{type:"button",className:"entity-prop-hide-btn",onClick:()=>{a(),t()},title:"Hide this entity",children:[ue("mdi:eye-off")?e.jsx(ge,{icon:"mdi:eye-off",width:14,height:14}):e.jsx("span",{children:"üëÅ"})," Hide"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{type:"button",className:"entity-prop-reset-btn",onClick:g,children:"Reset"}),e.jsx("button",{type:"button",className:"entity-prop-save-btn",onClick:M,disabled:f,children:f?"...":"Save"})]})]})})}),document.body)}var ae={},ye,Ze;function Qt(){return Ze||(Ze=1,ye=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),ye}var be={},ee={},Xe;function se(){if(Xe)return ee;Xe=1;let i;const o=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return ee.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},ee.getSymbolTotalCodewords=function(n){return o[n]},ee.getBCHDigit=function(r){let n=0;for(;r!==0;)n++,r>>>=1;return n},ee.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');i=n},ee.isKanjiModeEnabled=function(){return typeof i<"u"},ee.toSJIS=function(n){return i(n)},ee}var we={},$e;function ze(){return $e||($e=1,(function(i){i.L={bit:1},i.M={bit:0},i.Q={bit:3},i.H={bit:2};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return i.L;case"m":case"medium":return i.M;case"q":case"quartile":return i.Q;case"h":case"high":return i.H;default:throw new Error("Unknown EC Level: "+r)}}i.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},i.from=function(n,t){if(i.isValid(n))return n;try{return o(n)}catch{return t}}})(we)),we}var Ne,et;function Yt(){if(et)return Ne;et=1;function i(){this.buffer=[],this.length=0}return i.prototype={get:function(o){const r=Math.floor(o/8);return(this.buffer[r]>>>7-o%8&1)===1},put:function(o,r){for(let n=0;n<r;n++)this.putBit((o>>>r-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(o){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),o&&(this.buffer[r]|=128>>>this.length%8),this.length++}},Ne=i,Ne}var Ce,tt;function Zt(){if(tt)return Ce;tt=1;function i(o){if(!o||o<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=o,this.data=new Uint8Array(o*o),this.reservedBit=new Uint8Array(o*o)}return i.prototype.set=function(o,r,n,t){const s=o*this.size+r;this.data[s]=n,t&&(this.reservedBit[s]=!0)},i.prototype.get=function(o,r){return this.data[o*this.size+r]},i.prototype.xor=function(o,r,n){this.data[o*this.size+r]^=n},i.prototype.isReserved=function(o,r){return this.reservedBit[o*this.size+r]},Ce=i,Ce}var ve={},nt;function Xt(){return nt||(nt=1,(function(i){const o=se().getSymbolSize;i.getRowColCoords=function(n){if(n===1)return[];const t=Math.floor(n/7)+2,s=o(n),a=s===145?26:Math.ceil((s-13)/(2*t-2))*2,l=[s-7];for(let c=1;c<t-1;c++)l[c]=l[c-1]-a;return l.push(6),l.reverse()},i.getPositions=function(n){const t=[],s=i.getRowColCoords(n),a=s.length;for(let l=0;l<a;l++)for(let c=0;c<a;c++)l===0&&c===0||l===0&&c===a-1||l===a-1&&c===0||t.push([s[l],s[c]]);return t}})(ve)),ve}var je={},it;function $t(){if(it)return je;it=1;const i=se().getSymbolSize,o=7;return je.getPositions=function(n){const t=i(n);return[[0,0],[t-o,0],[0,t-o]]},je}var xe={},st;function en(){return st||(st=1,(function(i){i.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const o={N1:3,N2:3,N3:40,N4:10};i.isValid=function(t){return t!=null&&t!==""&&!isNaN(t)&&t>=0&&t<=7},i.from=function(t){return i.isValid(t)?parseInt(t,10):void 0},i.getPenaltyN1=function(t){const s=t.size;let a=0,l=0,c=0,h=null,b=null;for(let N=0;N<s;N++){l=c=0,h=b=null;for(let p=0;p<s;p++){let f=t.get(N,p);f===h?l++:(l>=5&&(a+=o.N1+(l-5)),h=f,l=1),f=t.get(p,N),f===b?c++:(c>=5&&(a+=o.N1+(c-5)),b=f,c=1)}l>=5&&(a+=o.N1+(l-5)),c>=5&&(a+=o.N1+(c-5))}return a},i.getPenaltyN2=function(t){const s=t.size;let a=0;for(let l=0;l<s-1;l++)for(let c=0;c<s-1;c++){const h=t.get(l,c)+t.get(l,c+1)+t.get(l+1,c)+t.get(l+1,c+1);(h===4||h===0)&&a++}return a*o.N2},i.getPenaltyN3=function(t){const s=t.size;let a=0,l=0,c=0;for(let h=0;h<s;h++){l=c=0;for(let b=0;b<s;b++)l=l<<1&2047|t.get(h,b),b>=10&&(l===1488||l===93)&&a++,c=c<<1&2047|t.get(b,h),b>=10&&(c===1488||c===93)&&a++}return a*o.N3},i.getPenaltyN4=function(t){let s=0;const a=t.data.length;for(let c=0;c<a;c++)s+=t.data[c];return Math.abs(Math.ceil(s*100/a/5)-10)*o.N4};function r(n,t,s){switch(n){case i.Patterns.PATTERN000:return(t+s)%2===0;case i.Patterns.PATTERN001:return t%2===0;case i.Patterns.PATTERN010:return s%3===0;case i.Patterns.PATTERN011:return(t+s)%3===0;case i.Patterns.PATTERN100:return(Math.floor(t/2)+Math.floor(s/3))%2===0;case i.Patterns.PATTERN101:return t*s%2+t*s%3===0;case i.Patterns.PATTERN110:return(t*s%2+t*s%3)%2===0;case i.Patterns.PATTERN111:return(t*s%3+(t+s)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}i.applyMask=function(t,s){const a=s.size;for(let l=0;l<a;l++)for(let c=0;c<a;c++)s.isReserved(c,l)||s.xor(c,l,r(t,c,l))},i.getBestMask=function(t,s){const a=Object.keys(i.Patterns).length;let l=0,c=1/0;for(let h=0;h<a;h++){s(h),i.applyMask(h,t);const b=i.getPenaltyN1(t)+i.getPenaltyN2(t)+i.getPenaltyN3(t)+i.getPenaltyN4(t);i.applyMask(h,t),b<c&&(c=b,l=h)}return l}})(xe)),xe}var fe={},ot;function At(){if(ot)return fe;ot=1;const i=ze(),o=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return fe.getBlocksCount=function(t,s){switch(s){case i.L:return o[(t-1)*4+0];case i.M:return o[(t-1)*4+1];case i.Q:return o[(t-1)*4+2];case i.H:return o[(t-1)*4+3];default:return}},fe.getTotalCodewordsCount=function(t,s){switch(s){case i.L:return r[(t-1)*4+0];case i.M:return r[(t-1)*4+1];case i.Q:return r[(t-1)*4+2];case i.H:return r[(t-1)*4+3];default:return}},fe}var Ee={},de={},rt;function tn(){if(rt)return de;rt=1;const i=new Uint8Array(512),o=new Uint8Array(256);return(function(){let n=1;for(let t=0;t<255;t++)i[t]=n,o[n]=t,n<<=1,n&256&&(n^=285);for(let t=255;t<512;t++)i[t]=i[t-255]})(),de.log=function(n){if(n<1)throw new Error("log("+n+")");return o[n]},de.exp=function(n){return i[n]},de.mul=function(n,t){return n===0||t===0?0:i[o[n]+o[t]]},de}var at;function nn(){return at||(at=1,(function(i){const o=tn();i.mul=function(n,t){const s=new Uint8Array(n.length+t.length-1);for(let a=0;a<n.length;a++)for(let l=0;l<t.length;l++)s[a+l]^=o.mul(n[a],t[l]);return s},i.mod=function(n,t){let s=new Uint8Array(n);for(;s.length-t.length>=0;){const a=s[0];for(let c=0;c<t.length;c++)s[c]^=o.mul(t[c],a);let l=0;for(;l<s.length&&s[l]===0;)l++;s=s.slice(l)}return s},i.generateECPolynomial=function(n){let t=new Uint8Array([1]);for(let s=0;s<n;s++)t=i.mul(t,new Uint8Array([1,o.exp(s)]));return t}})(Ee)),Ee}var Se,lt;function sn(){if(lt)return Se;lt=1;const i=nn();function o(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}return o.prototype.initialize=function(n){this.degree=n,this.genPoly=i.generateECPolynomial(this.degree)},o.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(n.length+this.degree);t.set(n);const s=i.mod(t,this.genPoly),a=this.degree-s.length;if(a>0){const l=new Uint8Array(this.degree);return l.set(s,a),l}return s},Se=o,Se}var ke={},Ae={},Pe={},ct;function Pt(){return ct||(ct=1,Pe.isValid=function(o){return!isNaN(o)&&o>=1&&o<=40}),Pe}var Q={},dt;function Rt(){if(dt)return Q;dt=1;const i="[0-9]+",o="[A-Z $%*+\\-./:]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+`)(?:.|[\r
]))+`;Q.KANJI=new RegExp(r,"g"),Q.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Q.BYTE=new RegExp(n,"g"),Q.NUMERIC=new RegExp(i,"g"),Q.ALPHANUMERIC=new RegExp(o,"g");const t=new RegExp("^"+r+"$"),s=new RegExp("^"+i+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Q.testKanji=function(c){return t.test(c)},Q.testNumeric=function(c){return s.test(c)},Q.testAlphanumeric=function(c){return a.test(c)},Q}var ut;function oe(){return ut||(ut=1,(function(i){const o=Pt(),r=Rt();i.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},i.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},i.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},i.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},i.MIXED={bit:-1},i.getCharCountIndicator=function(s,a){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!o.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?s.ccBits[0]:a<27?s.ccBits[1]:s.ccBits[2]},i.getBestModeForData=function(s){return r.testNumeric(s)?i.NUMERIC:r.testAlphanumeric(s)?i.ALPHANUMERIC:r.testKanji(s)?i.KANJI:i.BYTE},i.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},i.isValid=function(s){return s&&s.bit&&s.ccBits};function n(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return i.NUMERIC;case"alphanumeric":return i.ALPHANUMERIC;case"kanji":return i.KANJI;case"byte":return i.BYTE;default:throw new Error("Unknown mode: "+t)}}i.from=function(s,a){if(i.isValid(s))return s;try{return n(s)}catch{return a}}})(Ae)),Ae}var mt;function on(){return mt||(mt=1,(function(i){const o=se(),r=At(),n=ze(),t=oe(),s=Pt(),a=7973,l=o.getBCHDigit(a);function c(p,f,v){for(let R=1;R<=40;R++)if(f<=i.getCapacity(R,v,p))return R}function h(p,f){return t.getCharCountIndicator(p,f)+4}function b(p,f){let v=0;return p.forEach(function(R){const M=h(R.mode,f);v+=M+R.getBitsLength()}),v}function N(p,f){for(let v=1;v<=40;v++)if(b(p,v)<=i.getCapacity(v,f,t.MIXED))return v}i.from=function(f,v){return s.isValid(f)?parseInt(f,10):v},i.getCapacity=function(f,v,R){if(!s.isValid(f))throw new Error("Invalid QR Code version");typeof R>"u"&&(R=t.BYTE);const M=o.getSymbolTotalCodewords(f),g=r.getTotalCodewordsCount(f,v),j=(M-g)*8;if(R===t.MIXED)return j;const S=j-h(R,f);switch(R){case t.NUMERIC:return Math.floor(S/10*3);case t.ALPHANUMERIC:return Math.floor(S/11*2);case t.KANJI:return Math.floor(S/13);case t.BYTE:default:return Math.floor(S/8)}},i.getBestVersionForData=function(f,v){let R;const M=n.from(v,n.M);if(Array.isArray(f)){if(f.length>1)return N(f,M);if(f.length===0)return 1;R=f[0]}else R=f;return c(R.mode,R.getLength(),M)},i.getEncodedBits=function(f){if(!s.isValid(f)||f<7)throw new Error("Invalid QR Code version");let v=f<<12;for(;o.getBCHDigit(v)-l>=0;)v^=a<<o.getBCHDigit(v)-l;return f<<12|v}})(ke)),ke}var Re={},ht;function rn(){if(ht)return Re;ht=1;const i=se(),o=1335,r=21522,n=i.getBCHDigit(o);return Re.getEncodedBits=function(s,a){const l=s.bit<<3|a;let c=l<<10;for(;i.getBCHDigit(c)-n>=0;)c^=o<<i.getBCHDigit(c)-n;return(l<<10|c)^r},Re}var Te={},Le,ft;function an(){if(ft)return Le;ft=1;const i=oe();function o(r){this.mode=i.NUMERIC,this.data=r.toString()}return o.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(n){let t,s,a;for(t=0;t+3<=this.data.length;t+=3)s=this.data.substr(t,3),a=parseInt(s,10),n.put(a,10);const l=this.data.length-t;l>0&&(s=this.data.substr(t),a=parseInt(s,10),n.put(a,l*3+1))},Le=o,Le}var Be,gt;function ln(){if(gt)return Be;gt=1;const i=oe(),o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function r(n){this.mode=i.ALPHANUMERIC,this.data=n}return r.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(t){let s;for(s=0;s+2<=this.data.length;s+=2){let a=o.indexOf(this.data[s])*45;a+=o.indexOf(this.data[s+1]),t.put(a,11)}this.data.length%2&&t.put(o.indexOf(this.data[s]),6)},Be=r,Be}var Me,pt;function cn(){if(pt)return Me;pt=1;const i=oe();function o(r){this.mode=i.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}return o.getBitsLength=function(n){return n*8},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(r){for(let n=0,t=this.data.length;n<t;n++)r.put(this.data[n],8)},Me=o,Me}var Ie,yt;function dn(){if(yt)return Ie;yt=1;const i=oe(),o=se();function r(n){this.mode=i.KANJI,this.data=n}return r.getBitsLength=function(t){return t*13},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let s=o.toSJIS(this.data[t]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),n.put(s,13)}},Ie=r,Ie}var De={exports:{}},bt;function un(){return bt||(bt=1,(function(i){var o={single_source_shortest_paths:function(r,n,t){var s={},a={};a[n]=0;var l=o.PriorityQueue.make();l.push(n,0);for(var c,h,b,N,p,f,v,R,M;!l.empty();){c=l.pop(),h=c.value,N=c.cost,p=r[h]||{};for(b in p)p.hasOwnProperty(b)&&(f=p[b],v=N+f,R=a[b],M=typeof a[b]>"u",(M||R>v)&&(a[b]=v,l.push(b,v),s[b]=h))}if(typeof t<"u"&&typeof a[t]>"u"){var g=["Could not find a path from ",n," to ",t,"."].join("");throw new Error(g)}return s},extract_shortest_path_from_predecessor_list:function(r,n){for(var t=[],s=n;s;)t.push(s),r[s],s=r[s];return t.reverse(),t},find_path:function(r,n,t){var s=o.single_source_shortest_paths(r,n,t);return o.extract_shortest_path_from_predecessor_list(s,t)},PriorityQueue:{make:function(r){var n=o.PriorityQueue,t={},s;r=r||{};for(s in n)n.hasOwnProperty(s)&&(t[s]=n[s]);return t.queue=[],t.sorter=r.sorter||n.default_sorter,t},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var t={value:r,cost:n};this.queue.push(t),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};i.exports=o})(De)),De.exports}var wt;function mn(){return wt||(wt=1,(function(i){const o=oe(),r=an(),n=ln(),t=cn(),s=dn(),a=Rt(),l=se(),c=un();function h(g){return unescape(encodeURIComponent(g)).length}function b(g,j,S){const d=[];let L;for(;(L=g.exec(S))!==null;)d.push({data:L[0],index:L.index,mode:j,length:L[0].length});return d}function N(g){const j=b(a.NUMERIC,o.NUMERIC,g),S=b(a.ALPHANUMERIC,o.ALPHANUMERIC,g);let d,L;return l.isKanjiModeEnabled()?(d=b(a.BYTE,o.BYTE,g),L=b(a.KANJI,o.KANJI,g)):(d=b(a.BYTE_KANJI,o.BYTE,g),L=[]),j.concat(S,d,L).sort(function(y,w){return y.index-w.index}).map(function(y){return{data:y.data,mode:y.mode,length:y.length}})}function p(g,j){switch(j){case o.NUMERIC:return r.getBitsLength(g);case o.ALPHANUMERIC:return n.getBitsLength(g);case o.KANJI:return s.getBitsLength(g);case o.BYTE:return t.getBitsLength(g)}}function f(g){return g.reduce(function(j,S){const d=j.length-1>=0?j[j.length-1]:null;return d&&d.mode===S.mode?(j[j.length-1].data+=S.data,j):(j.push(S),j)},[])}function v(g){const j=[];for(let S=0;S<g.length;S++){const d=g[S];switch(d.mode){case o.NUMERIC:j.push([d,{data:d.data,mode:o.ALPHANUMERIC,length:d.length},{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.ALPHANUMERIC:j.push([d,{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.KANJI:j.push([d,{data:d.data,mode:o.BYTE,length:h(d.data)}]);break;case o.BYTE:j.push([{data:d.data,mode:o.BYTE,length:h(d.data)}])}}return j}function R(g,j){const S={},d={start:{}};let L=["start"];for(let m=0;m<g.length;m++){const y=g[m],w=[];for(let C=0;C<y.length;C++){const A=y[C],k=""+m+C;w.push(k),S[k]={node:A,lastCount:0},d[k]={};for(let T=0;T<L.length;T++){const P=L[T];S[P]&&S[P].node.mode===A.mode?(d[P][k]=p(S[P].lastCount+A.length,A.mode)-p(S[P].lastCount,A.mode),S[P].lastCount+=A.length):(S[P]&&(S[P].lastCount=A.length),d[P][k]=p(A.length,A.mode)+4+o.getCharCountIndicator(A.mode,j))}}L=w}for(let m=0;m<L.length;m++)d[L[m]].end=0;return{map:d,table:S}}function M(g,j){let S;const d=o.getBestModeForData(g);if(S=o.from(j,d),S!==o.BYTE&&S.bit<d.bit)throw new Error('"'+g+'" cannot be encoded with mode '+o.toString(S)+`.
 Suggested mode is: `+o.toString(d));switch(S===o.KANJI&&!l.isKanjiModeEnabled()&&(S=o.BYTE),S){case o.NUMERIC:return new r(g);case o.ALPHANUMERIC:return new n(g);case o.KANJI:return new s(g);case o.BYTE:return new t(g)}}i.fromArray=function(j){return j.reduce(function(S,d){return typeof d=="string"?S.push(M(d,null)):d.data&&S.push(M(d.data,d.mode)),S},[])},i.fromString=function(j,S){const d=N(j,l.isKanjiModeEnabled()),L=v(d),m=R(L,S),y=c.find_path(m.map,"start","end"),w=[];for(let C=1;C<y.length-1;C++)w.push(m.table[y[C]].node);return i.fromArray(f(w))},i.rawSplit=function(j){return i.fromArray(N(j,l.isKanjiModeEnabled()))}})(Te)),Te}var Nt;function hn(){if(Nt)return be;Nt=1;const i=se(),o=ze(),r=Yt(),n=Zt(),t=Xt(),s=$t(),a=en(),l=At(),c=sn(),h=on(),b=rn(),N=oe(),p=mn();function f(m,y){const w=m.size,C=s.getPositions(y);for(let A=0;A<C.length;A++){const k=C[A][0],T=C[A][1];for(let P=-1;P<=7;P++)if(!(k+P<=-1||w<=k+P))for(let B=-1;B<=7;B++)T+B<=-1||w<=T+B||(P>=0&&P<=6&&(B===0||B===6)||B>=0&&B<=6&&(P===0||P===6)||P>=2&&P<=4&&B>=2&&B<=4?m.set(k+P,T+B,!0,!0):m.set(k+P,T+B,!1,!0))}}function v(m){const y=m.size;for(let w=8;w<y-8;w++){const C=w%2===0;m.set(w,6,C,!0),m.set(6,w,C,!0)}}function R(m,y){const w=t.getPositions(y);for(let C=0;C<w.length;C++){const A=w[C][0],k=w[C][1];for(let T=-2;T<=2;T++)for(let P=-2;P<=2;P++)T===-2||T===2||P===-2||P===2||T===0&&P===0?m.set(A+T,k+P,!0,!0):m.set(A+T,k+P,!1,!0)}}function M(m,y){const w=m.size,C=h.getEncodedBits(y);let A,k,T;for(let P=0;P<18;P++)A=Math.floor(P/3),k=P%3+w-8-3,T=(C>>P&1)===1,m.set(A,k,T,!0),m.set(k,A,T,!0)}function g(m,y,w){const C=m.size,A=b.getEncodedBits(y,w);let k,T;for(k=0;k<15;k++)T=(A>>k&1)===1,k<6?m.set(k,8,T,!0):k<8?m.set(k+1,8,T,!0):m.set(C-15+k,8,T,!0),k<8?m.set(8,C-k-1,T,!0):k<9?m.set(8,15-k-1+1,T,!0):m.set(8,15-k-1,T,!0);m.set(C-8,8,1,!0)}function j(m,y){const w=m.size;let C=-1,A=w-1,k=7,T=0;for(let P=w-1;P>0;P-=2)for(P===6&&P--;;){for(let B=0;B<2;B++)if(!m.isReserved(A,P-B)){let V=!1;T<y.length&&(V=(y[T]>>>k&1)===1),m.set(A,P-B,V),k--,k===-1&&(T++,k=7)}if(A+=C,A<0||w<=A){A-=C,C=-C;break}}}function S(m,y,w){const C=new r;w.forEach(function(B){C.put(B.mode.bit,4),C.put(B.getLength(),N.getCharCountIndicator(B.mode,m)),B.write(C)});const A=i.getSymbolTotalCodewords(m),k=l.getTotalCodewordsCount(m,y),T=(A-k)*8;for(C.getLengthInBits()+4<=T&&C.put(0,4);C.getLengthInBits()%8!==0;)C.putBit(0);const P=(T-C.getLengthInBits())/8;for(let B=0;B<P;B++)C.put(B%2?17:236,8);return d(C,m,y)}function d(m,y,w){const C=i.getSymbolTotalCodewords(y),A=l.getTotalCodewordsCount(y,w),k=C-A,T=l.getBlocksCount(y,w),P=C%T,B=T-P,V=Math.floor(C/T),J=Math.floor(k/T),Z=J+1,K=V-J,te=new c(K);let X=0;const G=new Array(T),ne=new Array(T);let Y=0;const re=new Uint8Array(m.buffer);for(let H=0;H<T;H++){const le=H<B?J:Z;G[H]=re.slice(X,X+le),ne[H]=te.encode(G[H]),X+=le,Y=Math.max(Y,le)}const W=new Uint8Array(C);let $=0,E,q;for(E=0;E<Y;E++)for(q=0;q<T;q++)E<G[q].length&&(W[$++]=G[q][E]);for(E=0;E<K;E++)for(q=0;q<T;q++)W[$++]=ne[q][E];return W}function L(m,y,w,C){let A;if(Array.isArray(m))A=p.fromArray(m);else if(typeof m=="string"){let V=y;if(!V){const J=p.rawSplit(m);V=h.getBestVersionForData(J,w)}A=p.fromString(m,V||40)}else throw new Error("Invalid data");const k=h.getBestVersionForData(A,w);if(!k)throw new Error("The amount of data is too big to be stored in a QR Code");if(!y)y=k;else if(y<k)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+k+`.
`);const T=S(y,w,A),P=i.getSymbolSize(y),B=new n(P);return f(B,y),v(B),R(B,y),g(B,w,0),y>=7&&M(B,y),j(B,T),isNaN(C)&&(C=a.getBestMask(B,g.bind(null,B,w))),a.applyMask(C,B),g(B,w,C),{modules:B,version:y,errorCorrectionLevel:w,maskPattern:C,segments:A}}return be.create=function(y,w){if(typeof y>"u"||y==="")throw new Error("No input text");let C=o.M,A,k;return typeof w<"u"&&(C=o.from(w.errorCorrectionLevel,o.M),A=h.from(w.version),k=a.from(w.maskPattern),w.toSJISFunc&&i.setToSJISFunction(w.toSJISFunc)),L(y,A,C,k)},be}var _e={},Ue={},Ct;function Tt(){return Ct||(Ct=1,(function(i){function o(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let n=r.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+r);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(s){return[s,s]}))),n.length===6&&n.push("F","F");const t=parseInt(n.join(""),16);return{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:t&255,hex:"#"+n.slice(0,6).join("")}}i.getOptions=function(n){n||(n={}),n.color||(n.color={});const t=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,s=n.width&&n.width>=21?n.width:void 0,a=n.scale||4;return{width:s,scale:s?4:a,margin:t,color:{dark:o(n.color.dark||"#000000ff"),light:o(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},i.getScale=function(n,t){return t.width&&t.width>=n+t.margin*2?t.width/(n+t.margin*2):t.scale},i.getImageWidth=function(n,t){const s=i.getScale(n,t);return Math.floor((n+t.margin*2)*s)},i.qrToImageData=function(n,t,s){const a=t.modules.size,l=t.modules.data,c=i.getScale(a,s),h=Math.floor((a+s.margin*2)*c),b=s.margin*c,N=[s.color.light,s.color.dark];for(let p=0;p<h;p++)for(let f=0;f<h;f++){let v=(p*h+f)*4,R=s.color.light;if(p>=b&&f>=b&&p<h-b&&f<h-b){const M=Math.floor((p-b)/c),g=Math.floor((f-b)/c);R=N[l[M*a+g]?1:0]}n[v++]=R.r,n[v++]=R.g,n[v++]=R.b,n[v]=R.a}}})(Ue)),Ue}var vt;function fn(){return vt||(vt=1,(function(i){const o=Tt();function r(t,s,a){t.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=a,s.width=a,s.style.height=a+"px",s.style.width=a+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}i.render=function(s,a,l){let c=l,h=a;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),a||(h=n()),c=o.getOptions(c);const b=o.getImageWidth(s.modules.size,c),N=h.getContext("2d"),p=N.createImageData(b,b);return o.qrToImageData(p.data,s,c),r(N,h,b),N.putImageData(p,0,0),h},i.renderToDataURL=function(s,a,l){let c=l;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),c||(c={});const h=i.render(s,a,c),b=c.type||"image/png",N=c.rendererOpts||{};return h.toDataURL(b,N.quality)}})(_e)),_e}var Oe={},jt;function gn(){if(jt)return Oe;jt=1;const i=Tt();function o(t,s){const a=t.a/255,l=s+'="'+t.hex+'"';return a<1?l+" "+s+'-opacity="'+a.toFixed(2).slice(1)+'"':l}function r(t,s,a){let l=t+s;return typeof a<"u"&&(l+=" "+a),l}function n(t,s,a){let l="",c=0,h=!1,b=0;for(let N=0;N<t.length;N++){const p=Math.floor(N%s),f=Math.floor(N/s);!p&&!h&&(h=!0),t[N]?(b++,N>0&&p>0&&t[N-1]||(l+=h?r("M",p+a,.5+f+a):r("m",c,0),c=0,h=!1),p+1<s&&t[N+1]||(l+=r("h",b),b=0)):c++}return l}return Oe.render=function(s,a,l){const c=i.getOptions(a),h=s.modules.size,b=s.modules.data,N=h+c.margin*2,p=c.color.light.a?"<path "+o(c.color.light,"fill")+' d="M0 0h'+N+"v"+N+'H0z"/>':"",f="<path "+o(c.color.dark,"stroke")+' d="'+n(b,h,c.margin)+'"/>',v='viewBox="0 0 '+N+" "+N+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+v+' shape-rendering="crispEdges">'+p+f+`</svg>
`;return typeof l=="function"&&l(null,M),M},Oe}var xt;function pn(){if(xt)return ae;xt=1;const i=Qt(),o=hn(),r=fn(),n=gn();function t(s,a,l,c,h){const b=[].slice.call(arguments,1),N=b.length,p=typeof b[N-1]=="function";if(!p&&!i())throw new Error("Callback required as last argument");if(p){if(N<2)throw new Error("Too few arguments provided");N===2?(h=l,l=a,a=c=void 0):N===3&&(a.getContext&&typeof h>"u"?(h=c,c=void 0):(h=c,c=l,l=a,a=void 0))}else{if(N<1)throw new Error("Too few arguments provided");return N===1?(l=a,a=c=void 0):N===2&&!a.getContext&&(c=l,l=a,a=void 0),new Promise(function(f,v){try{const R=o.create(l,c);f(s(R,a,c))}catch(R){v(R)}})}try{const f=o.create(l,c);h(null,s(f,a,c))}catch(f){h(f)}}return ae.create=o.create,ae.toCanvas=t.bind(null,r.render),ae.toDataURL=t.bind(null,r.renderToDataURL),ae.toString=t.bind(null,function(s,a,l){return n.render(s,l)}),ae}var yn=pn();const bn=Ut(yn);function wn({sessionId:i,hassUrl:o,hassToken:r,onLogout:n}){const[t,s]=u.useState([]),[a,l]=u.useState(new Set),[c,h]=u.useState("LobbyHA"),[b,N]=u.useState(!1),[p,f]=u.useState(""),[v,R]=u.useState(!0),[M,g]=u.useState(!1),[j,S]=u.useState(!1),[d,L]=u.useState(!1),[m,y]=u.useState(!1),[w,C]=u.useState(!1),[A,k]=u.useState(!1),[T,P]=u.useState(!1),[B,V]=u.useState({}),[J,Z]=u.useState(null),[K,te]=u.useState(null),[X,G]=u.useState(""),[ne,Y]=u.useState(""),[re,W]=u.useState(null),[$,E]=u.useState(null),q=u.useRef(null),H=u.useCallback(async(x=!1)=>{x||R(!0);try{const[_,U,O,D]=await Promise.all([I("/api/ui/modules",{sessionId:i}),I("/api/ui/hidden",{sessionId:i}),I("/api/ui/guest-entities",{sessionId:i}),I("/api/ui/entity-props",{sessionId:i})]);s(_.modules),l(new Set(U.hidden)),h(O.title||"LobbyHA");const F={};for(const z of D.props)F[z.entity_id]={custom_name:z.custom_name,custom_icon:z.custom_icon};V(F)}catch{}finally{x||R(!1)}},[i]);u.useEffect(()=>{H()},[H]),u.useEffect(()=>{if(!A)return;const x=_=>{q.current&&!q.current.contains(_.target)&&k(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[A]);const le=()=>{f(c),N(!0)},Je=async()=>{const x=p.trim()||"LobbyHA";h(x),N(!1),await I("/api/ui/guest-entities",{method:"POST",sessionId:i,body:JSON.stringify({title:x})})},Ke=async x=>{const _=new Set(a);_.add(x),l(_),await I("/api/ui/hidden",{method:"POST",sessionId:i,body:JSON.stringify({hidden:Array.from(_)})})},Lt=async x=>{const _=new Set(a);_.delete(x),l(_),await I("/api/ui/hidden",{method:"POST",sessionId:i,body:JSON.stringify({hidden:Array.from(_)})})},Bt=async(x,_)=>{const U=t.find(O=>O.entities.includes(x));if(U){const O=U.entities.filter(D=>D!==x);s(D=>D.map(F=>F.id===U.id?{...F,entities:O}:F)),await I(`/api/ui/modules/${U.id}/entities`,{method:"POST",sessionId:i,body:JSON.stringify({entities:O})})}if(_!==null){const O=t.find(D=>D.id===_);if(O){const D=[...O.entities.filter(F=>F!==x),x];s(F=>F.map(z=>z.id===O.id?{...z,entities:D}:z)),await I(`/api/ui/modules/${O.id}/entities`,{method:"POST",sessionId:i,body:JSON.stringify({entities:D})})}}H(!0)},Ve=async(x,_,U)=>{const O=t.find(ce=>ce.id===x);if(!O)return;const D=[...O.entities],F=D.indexOf(_);if(F<0)return;const z=U==="up"?F-1:F+1;z<0||z>=D.length||([D[F],D[z]]=[D[z],D[F]],s(ce=>ce.map(pe=>pe.id===x?{...pe,entities:D}:pe)),await I(`/api/ui/modules/${x}/entities`,{method:"POST",sessionId:i,body:JSON.stringify({entities:D})}))},[ie,he]=u.useState(null),Mt=async(x,_)=>{if(!ie||ie.moduleId!==x){he(null);return}const U=t.find(F=>F.id===x);if(!U)return;const O=[...U.entities],D=O.indexOf(ie.entityId);D<0||(O.splice(D,1),O.splice(_,0,ie.entityId),s(F=>F.map(z=>z.id===x?{...z,entities:O}:z)),he(null),await I(`/api/ui/modules/${x}/entities`,{method:"POST",sessionId:i,body:JSON.stringify({entities:O})}))},It=async()=>{const x=new URL("./",window.location.href).toString();try{const _=await bn.toDataURL(x,{width:256,margin:2});E(_),C(!0)}catch(_){console.error("Failed to generate QR code:",_)}},Dt=async()=>{W(null);try{await I("/api/admin/change-password",{method:"POST",sessionId:i,body:JSON.stringify({currentPassword:X,newPassword:ne})}),W("Password changed!"),G(""),Y("")}catch(x){W(x instanceof Error?x.message:"Failed")}},_t=async(x,_)=>{const U=t.find(D=>D.id===x);if(!U)return;const O=U.entities.filter(D=>D!==_);await I(`/api/ui/modules/${x}/entities`,{method:"POST",sessionId:i,body:JSON.stringify({entities:O})}),H()};return v?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading dashboard..."})}):e.jsxs("div",{className:"admin-layout",children:[e.jsxs("header",{className:"admin-header",children:[e.jsxs("div",{className:"header-left",children:[b?e.jsxs("span",{className:"title-edit",children:[e.jsx("input",{className:"title-input",value:p,onChange:x=>f(x.target.value),onKeyDown:x=>{x.key==="Enter"&&Je(),x.key==="Escape"&&N(!1)},autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:Je,children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>N(!1),children:"‚úï"})]}):e.jsx("h1",{className:"dashboard-title",onClick:le,title:"Click to edit",children:c}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("div",{className:"header-right",children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>g(!0),children:"üîç Discover"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!0),children:"üì¶ Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:It,children:"üì± QR Code"}),e.jsxs("div",{className:"settings-menu-wrap",ref:q,children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(!A),children:"‚öôÔ∏è"}),A&&e.jsxs("div",{className:"settings-dropdown",children:[e.jsxs("button",{onClick:()=>{k(!1),y(!0)},children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{onClick:()=>{k(!1),P(!0)},children:"Change Password"}),e.jsx("button",{onClick:()=>{k(!1),L(!0)},children:"Server Settings"}),e.jsx("button",{onClick:()=>{k(!1),n()},children:"Logout"})]})]})]})]}),e.jsx("main",{className:"admin-main",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No areas yet. Create areas to organize your entities."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!0),children:"Create First Area"})]}):t.map(x=>{const _=x.entities.filter(U=>!a.has(U));return e.jsxs("section",{className:"module-section",children:[e.jsxs("div",{className:"module-header",children:[e.jsxs("h2",{children:[x.icon," ",x.name]}),e.jsxs("span",{className:"entity-count",children:[x.entities.length," entities"]})]}),e.jsxs("div",{className:"entity-grid",children:[_.map((U,O)=>{var D,F;return e.jsxs("div",{className:`entity-card-wrap admin-card${(ie==null?void 0:ie.entityId)===U?" dragging":""}`,draggable:!0,onDragStart:()=>he({moduleId:x.id,entityId:U}),onDragOver:z=>z.preventDefault(),onDrop:()=>Mt(x.id,O),onDragEnd:()=>he(null),children:[e.jsx(qt,{entityId:U,showActions:!0,showAttributes:!0,onHide:()=>Ke(U),onGearClick:(z,ce)=>{Z(z),te(ce)},customName:(D=B[U])==null?void 0:D.custom_name,customIcon:(F=B[U])==null?void 0:F.custom_icon}),e.jsxs("div",{className:"entity-admin-actions",children:[e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>Ve(x.id,U,"up"),disabled:O===0,title:"Move up",children:"‚Üë"}),e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>Ve(x.id,U,"down"),disabled:O===_.length-1,title:"Move down",children:"‚Üì"}),e.jsx("button",{type:"button",className:"remove-from-module-btn",onClick:()=>_t(x.id,U),title:"Remove from area",children:"‚úï"})]})]},U)}),x.entities.length===0&&e.jsx("p",{className:"note",style:{gridColumn:"1 / -1"},children:"No entities in this area. Use Discover to add some."})]})]},x.id)})}),J&&K&&e.jsx(Wt,{entityId:J,friendlyName:J.split(".").slice(1).join(".").replace(/_/g," "),sessionId:i,anchorRect:K,onClose:()=>{Z(null),te(null)},onSave:()=>H(!0),onHide:()=>{Ke(J),Z(null),te(null)}}),M&&e.jsx(zt,{sessionId:i,modules:t,onAssignEntity:Bt,onClose:()=>g(!1)}),j&&e.jsx(Jt,{sessionId:i,modules:t,onModulesChange:s,onClose:()=>{S(!1),H()}}),d&&e.jsx(St,{sessionId:i,onClose:()=>L(!1)}),m&&e.jsx("div",{className:"modal-overlay",onClick:()=>y(!1),children:e.jsxs("div",{className:"modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>y(!1),children:"Close"})]}),e.jsxs("ul",{className:"hidden-list",children:[Array.from(a).map(x=>e.jsxs("li",{children:[e.jsx("span",{className:"hidden-id",children:x}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>Lt(x),children:"Unhide"})]},x)),a.size===0&&e.jsx("p",{className:"note",children:"No hidden entities."})]})]})}),w&&e.jsx("div",{className:"modal-overlay",onClick:()=>C(!1),children:e.jsxs("div",{className:"modal qr-modal",onClick:x=>x.stopPropagation(),children:[e.jsx("h3",{children:"Guest Access QR Code"}),$&&e.jsx("img",{src:$,alt:"QR Code for guest access"}),e.jsx("p",{className:"note",children:"Scan this code to open the guest dashboard."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>C(!1),children:"Close"})]})}),T&&e.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:e.jsxs("div",{className:"modal",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Change Password"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!1),children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:X,onChange:x=>G(x.target.value)})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:ne,onChange:x=>Y(x.target.value)})]}),re&&e.jsx("p",{className:"note",children:re}),e.jsx("button",{type:"button",className:"action-button",onClick:Dt,children:"Change Password"})]})]})})]})}function Nn({onLogin:i,error:o}){const[r,n]=u.useState(""),[t,s]=u.useState(!1),a=async l=>{l.preventDefault(),s(!0),await i(r),s(!1)};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Admin Login"}),e.jsxs("form",{className:"login-form",onSubmit:a,children:[e.jsx("input",{className:"login-input",type:"password",placeholder:"Admin password",value:r,onChange:l=>n(l.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"action-button",disabled:t,children:t?"Logging in...":"Login"})]}),o&&e.jsx("p",{className:"note error",children:o})]})}function Cn(){const[i,o]=u.useState(()=>sessionStorage.getItem("admin_session")),[r,n]=u.useState(""),[t,s]=u.useState(""),[a,l]=u.useState(null),[c,h]=u.useState(!0);u.useEffect(()=>{(async()=>{const f=sessionStorage.getItem("admin_session");if(!f){h(!1);return}try{const v=await I("/api/admin/session",{sessionId:f});v.valid?(o(f),n(v.hassUrl),s(v.hassToken)):(sessionStorage.removeItem("admin_session"),o(null))}catch{sessionStorage.removeItem("admin_session"),o(null)}finally{h(!1)}})()},[]);const b=async p=>{l(null);try{const f=await I("/api/admin/login",{method:"POST",body:JSON.stringify({password:p})});f.success?(sessionStorage.setItem("admin_session",f.sessionId),o(f.sessionId),n(f.hassUrl),s(f.hassToken)):l("Invalid password")}catch(f){l(f instanceof Error?f.message:"Login failed")}},N=async()=>{if(i)try{await I("/api/admin/logout",{method:"POST",sessionId:i})}catch{}sessionStorage.removeItem("admin_session"),o(null),n(""),s("")};return c?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading..."})}):i?r?e.jsxs(Ft,{hassUrl:r,hassToken:t,loading:e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."})}),options:{renderError:()=>e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"LobbyHA Admin"}),e.jsxs("p",{className:"note error",style:{marginBottom:"1.5rem"},children:["Unable to connect to Home Assistant.",e.jsx("br",{}),"Update the settings below and save to reconnect."]}),e.jsx(St,{sessionId:i,inline:!0,onSaved:()=>{setTimeout(()=>window.location.reload(),1500)}}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>window.location.reload(),children:"Retry Connection"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:N,children:"Logout"})]})]})},children:[e.jsx(Ht,{}),e.jsx(wn,{sessionId:i,hassUrl:r,hassToken:t,onLogout:N})]}):e.jsx("div",{className:"container",children:e.jsxs("p",{className:"note",children:["Server not configured. ",e.jsx("a",{href:"/setup",children:"Run setup"})]})}):e.jsx(Nn,{onLogin:b,error:a})}Ot.createRoot(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Cn,{})}));
