import{r as h,a as I,j as e,g as Bt,c as Mt}from"./index-DB0qu6yo.js";import{d as ze,r as Ue,I as he,E as It,h as Dt,e as _t}from"./EntityCard-BQJr6hC3.js";function Ut({sessionId:s,modules:o,onAssignEntity:r,onClose:n}){const[t,i]=h.useState([]),[a,l]=h.useState([]),[c,f]=h.useState([]),[b,v]=h.useState(!0),[g,m]=h.useState(""),[u,C]=h.useState(null),[M,E]=h.useState(!1),L=h.useMemo(()=>{const d=new Map;return o.forEach(R=>R.entities.forEach(y=>d.set(y,R.id))),d},[o]),k=h.useCallback(async(d=!1)=>{d?E(!0):v(!0);try{const p=await I(d?"/api/discovery/refresh":"/api/discovery/entities",d?{method:"POST",sessionId:s}:{sessionId:s});l(p.entities),i(p.entities),f(p.domains.map(w=>({domain:w.domain,label:w.label,count:w.entities.length})))}catch{}finally{v(!1),E(!1)}},[s]);return h.useEffect(()=>{k()},[k]),h.useEffect(()=>{let d=a;if(u&&(d=d.filter(R=>R.domain===u)),g){const R=g.toLowerCase();d=d.filter(y=>{var p;return y.entity_id.toLowerCase().includes(R)||y.name.toLowerCase().includes(R)||(((p=y.area)==null?void 0:p.toLowerCase().includes(R))??!1)})}i(d)},[a,g,u]),e.jsx("div",{className:"modal-overlay",onClick:n,children:e.jsxs("div",{className:"modal",style:{maxWidth:"700px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Discover Entities (",a.length," total)"]}),e.jsx("button",{type:"button",className:"action-button",onClick:n,children:"Close"})]}),e.jsxs("div",{className:"discovery-search",children:[e.jsx("input",{type:"text",placeholder:"Search entities...",value:g,onChange:d=>m(d.target.value),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(!0),disabled:M,children:M?"Refreshing...":"ðŸ”„ Refresh"})]}),e.jsxs("div",{className:"domain-filter",children:[e.jsxs("button",{type:"button",className:`domain-chip ${u===null?"active":""}`,onClick:()=>C(null),children:["All (",a.length,")"]}),c.length===0&&!b&&e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)",alignSelf:"center"},children:"No entity types found"}),c.map(d=>e.jsxs("button",{type:"button",className:`domain-chip ${u===d.domain?"active":""}`,onClick:()=>C(u===d.domain?null:d.domain),children:[ze(d.domain)," ",d.label," (",d.count,")"]},d.domain))]}),b?e.jsx("p",{className:"note",children:"Loading entities..."}):e.jsxs("ul",{className:"discovery-entity-list",children:[t.map(d=>{const R=L.get(d.entity_id),y=R!==void 0;return e.jsxs("li",{className:`discovery-entity-item ${y?"on-dashboard":""}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"discovery-entity-name",children:[ze(d.domain)," ",d.name]}),e.jsx("div",{className:"discovery-entity-id",children:d.entity_id})]}),e.jsx("span",{className:"discovery-entity-state",children:d.state}),e.jsxs("select",{className:"discovery-area-select",value:R??"",onChange:p=>{const w=p.target.value;r(d.entity_id,w===""?null:Number(w))},children:[e.jsx("option",{value:"",children:"â€” None â€”"}),o.map(p=>e.jsxs("option",{value:p.id,children:[p.icon," ",p.name]},p.id))]})]},d.entity_id)}),t.length===0&&e.jsx("p",{className:"note",children:"No entities found matching your criteria."})]})]})})}const Je=[{label:"Home",emojis:["ðŸ ","ðŸ¡","ðŸ¢","ðŸ—","ðŸ˜","ðŸ°","ðŸ›","ðŸ›‹","ðŸšª","ðŸªŸ","ðŸ•","â›º","ðŸ§±"]},{label:"Rooms",emojis:["ðŸ›","ðŸš¿","ðŸš½","ðŸª¥","ðŸ³","ðŸ½","ðŸ§‘â€ðŸ³","ðŸ“º","ðŸŽ®","ðŸ’»","ðŸ–¥","ðŸ“š","ðŸŽµ","ðŸŽ¸","ðŸŽ¹"]},{label:"Lighting",emojis:["ðŸ’¡","ðŸ”¦","ðŸ•¯","ðŸŒŸ","âœ¨","â­","ðŸŒ™","â˜€ï¸","ðŸ”†","ðŸ”…","ðŸª”"]},{label:"Climate",emojis:["ðŸŒ¡","â„ï¸","ðŸ”¥","ðŸ’¨","ðŸŒ€","â˜ï¸","ðŸŒ¤","ðŸŒ§","ðŸŒŠ","ðŸ’§","ðŸ§Š"]},{label:"Security",emojis:["ðŸ”’","ðŸ”“","ðŸ”‘","ðŸ›¡","ðŸ“¹","ðŸ“·","ðŸš¨","ðŸ””","ðŸš«","âš ï¸","ðŸ‘"]},{label:"Outdoor",emojis:["ðŸŒ³","ðŸŒ²","ðŸŒ¿","ðŸŒº","ðŸŒ»","ðŸŒ´","ðŸŠ","ðŸ…¿ï¸","ðŸš—","ðŸ‹","ðŸ§¹","ðŸ—‘"]},{label:"Appliances",emojis:["ðŸ§º","ðŸ‘•","ðŸ«§","ðŸ§Š","ðŸ•","â˜•","ðŸ§ƒ","ðŸ¥¤","ðŸ§½","ðŸª£","ðŸ”Œ","ðŸ”‹","âš¡"]},{label:"General",emojis:["ðŸ“¦","ðŸŽ¯","ðŸŽ¨","ðŸ§©","ðŸ› ","âš™ï¸","ðŸ“Š","ðŸ“ˆ","ðŸ—‚","ðŸ“‹","âœ…","âŒ","âž•","ðŸ”„"]}];function Ke({value:s,onChange:o}){const[r,n]=h.useState(!1),[t,i]=h.useState(""),a=h.useRef(null),l=h.useRef(null),[c,f]=h.useState({top:0,left:0});h.useEffect(()=>{if(r&&a.current){const g=a.current.getBoundingClientRect();f({top:g.bottom+6,left:Math.max(8,g.left-100)})}},[r]),h.useEffect(()=>{if(!r)return;const g=m=>{l.current&&!l.current.contains(m.target)&&a.current&&!a.current.contains(m.target)&&n(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[r]);const b=Je.flatMap(g=>g.emojis),v=t.trim()?b.filter(()=>!0):null;return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:a,type:"button",className:"emoji-picker-trigger",onClick:()=>n(!r),title:"Pick icon",children:s||"ðŸ "}),r&&Ue.createPortal(e.jsx("div",{ref:l,className:"emoji-picker-panel",style:{top:c.top,left:c.left},children:e.jsx("div",{className:"emoji-picker-grid",children:(v??Je.flatMap(g=>g.emojis)).map((g,m)=>e.jsx("button",{type:"button",className:`emoji-picker-item${g===s?" selected":""}`,onClick:()=>{o(g),n(!1)},children:g},`${g}-${m}`))})}),document.body)]})}function Ot({sessionId:s,modules:o,onModulesChange:r,onClose:n}){const[t,i]=h.useState(""),[a,l]=h.useState("ðŸ "),[c,f]=h.useState(null),[b,v]=h.useState(""),[g,m]=h.useState(""),u=h.useCallback(async()=>{const d=await I("/api/ui/modules",{sessionId:s});r(d.modules)},[s,r]),C=async()=>{t.trim()&&(await I("/api/ui/modules",{method:"POST",sessionId:s,body:JSON.stringify({name:t.trim(),icon:a})}),i(""),l("ðŸ "),u())},M=async d=>{await I(`/api/ui/modules/${d}`,{method:"PUT",sessionId:s,body:JSON.stringify({name:b,icon:g})}),f(null),u()},E=async d=>{confirm("Delete this area and remove all entity assignments?")&&(await I(`/api/ui/modules/${d}`,{method:"DELETE",sessionId:s}),u())},L=async d=>{await I(`/api/ui/modules/${d.id}`,{method:"PUT",sessionId:s,body:JSON.stringify({visible:!d.visible})}),u()},k=async(d,R)=>{const y=o.findIndex(N=>N.id===d);if(y<0)return;const p=[...o.map(N=>N.id)],w=R==="up"?y-1:y+1;w<0||w>=p.length||([p[y],p[w]]=[p[w],p[y]],await I("/api/ui/modules/reorder",{method:"POST",sessionId:s,body:JSON.stringify({moduleIds:p})}),u())};return e.jsx("div",{className:"modal-overlay",onClick:n,children:e.jsxs("div",{className:"modal",style:{maxWidth:"550px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Manage Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:n,children:"Close"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center"},children:[e.jsx(Ke,{value:a,onChange:l}),e.jsx("input",{style:{flex:1},value:t,onChange:d=>i(d.target.value),placeholder:"Area name...",onKeyDown:d=>d.key==="Enter"&&C()}),e.jsx("button",{type:"button",className:"action-button",onClick:C,children:"Add"})]}),e.jsxs("ul",{className:"hidden-list",children:[o.map((d,R)=>e.jsx("li",{children:c===d.id?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:1,alignItems:"center"},children:[e.jsx(Ke,{value:g,onChange:m}),e.jsx("input",{style:{flex:1},value:b,onChange:y=>v(y.target.value),onKeyDown:y=>y.key==="Enter"&&M(d.id),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>M(d.id),children:"âœ“"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>f(null),children:"âœ•"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"hidden-name",children:[d.icon," ",d.name]}),e.jsxs("div",{className:"hidden-id",children:[d.entities.length," entities Â· ",d.visible?"visible":"hidden"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(d.id,"up"),disabled:R===0,children:"â†‘"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(d.id,"down"),disabled:R===o.length-1,children:"â†“"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>L(d),children:d.visible?"ðŸ‘":"ðŸ‘â€ðŸ—¨"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{f(d.id),v(d.name),m(d.icon)},children:"âœï¸"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>E(d.id),children:"ðŸ—‘"})]})]})},d.id)),o.length===0&&e.jsx("p",{className:"note",children:"No areas yet. Create one above to organize your entities."})]})]})})}function vt({sessionId:s,onClose:o,inline:r,onSaved:n}){const[t,i]=h.useState(""),[a,l]=h.useState("â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"),[c,f]=h.useState(""),[b,v]=h.useState("INFO"),[g,m]=h.useState(""),[u,C]=h.useState(!1),[M,E]=h.useState(!1),[L,k]=h.useState(!1),[d,R]=h.useState([]),[y,p]=h.useState(null),[w,N]=h.useState(!1),[A,S]=h.useState([]),[T,P]=h.useState(""),[B,V]=h.useState(!1),[J,Z]=h.useState(!1);L||I("/api/admin/config",{sessionId:s}).then(x=>{x.success&&(i(x.config.HA_URL||""),l(x.config.HA_TOKEN||""),f(x.config.PORT||"3000"),v(x.config.LOG_LEVEL||"INFO"),m(x.config.ALLOWED_ENTITIES||""),R(x.missing||[])),k(!0)}).catch(()=>k(!0)),B||I("/api/guest/settings",{sessionId:s}).then(x=>{N(x.pinEnabled),S(x.pins),V(!0)}).catch(()=>V(!0));const K=x=>d.includes(x),te=async()=>{E(!0),p(null);try{const H=await I("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:t,haToken:(a==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"?"":a)||void 0})});H.success?p({type:"success",message:"Connection successful!"}):p({type:"error",message:H.error||"Connection failed"})}catch(x){p({type:"error",message:x instanceof Error?x.message:"Test failed"})}finally{E(!1)}},X=async()=>{if(!t.trim()){p({type:"error",message:"Home Assistant URL is required"});return}if(!a.trim()||a==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"&&K("HA_TOKEN")){p({type:"error",message:"Access token is required. Please enter your HA long-lived token."});return}C(!0),p(null);try{await I("/api/admin/config",{method:"POST",sessionId:s,body:JSON.stringify({haUrl:t,haToken:a==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"?void 0:a,port:c,logLevel:b,allowedEntities:g})}),R(x=>x.filter(q=>q==="HA_URL"&&!t.trim()||q==="HA_TOKEN"&&!a.trim())),p({type:"success",message:"Settings saved! Reload to apply."}),n==null||n()}catch(x){p({type:"error",message:x instanceof Error?x.message:"Failed to save"})}finally{C(!1)}},G=async(x,q)=>{Z(!0);try{const H=await I("/api/guest/settings",{method:"POST",sessionId:s,body:JSON.stringify({pinEnabled:x,pins:q})});N(H.pinEnabled),S(H.pins)}catch{}finally{Z(!1)}},ne=()=>{const x=!w;N(x),G(x,A)},Y=()=>{const x=T.trim();if(!x||A.includes(x))return;const q=[...A,x];S(q),P(""),G(w,q)},re=x=>{const q=A.filter(H=>H!==x);S(q),G(w,q)},W=d.length>0,$=e.jsxs("div",{className:r?"":"modal settings-modal",onClick:x=>x.stopPropagation(),children:[!r&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Settings"}),e.jsx("button",{type:"button",className:"action-button",onClick:o,children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"ðŸ”’ Guest PIN Access"}),e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:ne,disabled:J}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest dashboard"}),e.jsx("span",{className:"pin-toggle-hint",children:w?"Enabled":"Disabled"})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{fontSize:"0.85rem",color:"#8a9bc0",display:"block",marginBottom:"0.5rem"},children:["Allowed PINs (",A.length,")"]}),A.length>0&&e.jsx("ul",{className:"pin-list",children:A.map(x=>e.jsxs("li",{children:[e.jsx("span",{children:x}),e.jsx("button",{type:"button",onClick:()=>re(x),title:"Remove PIN",disabled:J,children:"âœ•"})]},x))}),e.jsxs("div",{className:"pin-add-row",children:[e.jsx("input",{value:T,onChange:x=>P(x.target.value),onKeyDown:x=>{x.key==="Enter"&&Y()},placeholder:"Enter new PIN",disabled:J}),e.jsx("button",{type:"button",onClick:Y,disabled:J||!T.trim(),children:"Add"})]}),w&&A.length===0&&e.jsx("p",{className:"note error",style:{marginTop:"0.5rem",fontSize:"0.85rem"},children:"âš  PIN is enabled but no PINs are set. Guests won't be able to access the dashboard."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"ðŸŒ Server Connection"}),W&&e.jsx("p",{className:"note error",style:{marginBottom:"0.75rem"},children:"Required settings are missing. Please fill in the highlighted fields."}),e.jsxs("div",{className:`form-field${K("HA_URL")?" field-missing":""}`,children:[e.jsxs("label",{children:["Home Assistant URL",K("HA_URL")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:t,onChange:x=>i(x.target.value),placeholder:"http://homeassistant.local:8123"}),K("HA_URL")&&e.jsx("span",{className:"field-hint",children:"Enter your Home Assistant URL (e.g. http://192.168.1.x:8123)"})]}),e.jsxs("div",{className:`form-field${K("HA_TOKEN")?" field-missing":""}`,children:[e.jsxs("label",{children:["Long-Lived Access Token",K("HA_TOKEN")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:a,onChange:x=>l(x.target.value),type:"password",placeholder:K("HA_TOKEN")?"Paste your HA token here":""}),K("HA_TOKEN")&&e.jsx("span",{className:"field-hint",children:"Create a token in HA â†’ Profile â†’ Long-Lived Access Tokens â†’ Create Token"})]}),y&&e.jsx("p",{className:`note ${y.type}`,children:y.message}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:te,disabled:M||!t,children:M?"Testing...":"Test Connection"}),e.jsx("button",{type:"button",className:"action-button",onClick:X,disabled:u,children:u?"Saving...":W?"Save & Configure":"Save Settings"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"âš¡ Advanced"}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Server Port"}),e.jsx("input",{value:c,onChange:x=>f(x.target.value),placeholder:"3000"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Log Level"}),e.jsxs("select",{value:b,onChange:x=>v(x.target.value),children:[e.jsx("option",{value:"DEBUG",children:"DEBUG"}),e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"WARNING",children:"WARNING"}),e.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:["Allowed Entities ",e.jsx("span",{style:{fontWeight:400,opacity:.7},children:"(optional, comma-separated)"})]}),e.jsx("input",{value:g,onChange:x=>m(x.target.value),placeholder:"light.living_room, switch.bedroom (leave empty for all)"}),e.jsx("span",{className:"field-hint",children:"Limit which entities are exposed. Leave empty to allow all."})]})]})]})]});return r?$:e.jsx("div",{className:"modal-overlay",onClick:o,children:$})}const Ct=[{label:"Lighting",color:"#ffd54f",icons:["mdi:lightbulb","mdi:lightbulb-outline","mdi:lightbulb-group","mdi:lightbulb-on","mdi:lamp","mdi:floor-lamp","mdi:desk-lamp","mdi:ceiling-light","mdi:led-strip","mdi:led-strip-variant","mdi:track-light","mdi:wall-sconce","mdi:wall-sconce-round","mdi:vanity-light","mdi:chandelier","mdi:outdoor-lamp","mdi:lava-lamp","mdi:string-lights","mdi:light-switch","mdi:brightness-5"]},{label:"Climate",color:"#4fc3f7",icons:["mdi:thermometer","mdi:thermometer-half","mdi:thermometer-high","mdi:thermometer-low","mdi:air-conditioner","mdi:hvac","mdi:fan","mdi:fan-off","mdi:snowflake","mdi:fire","mdi:water-percent","mdi:weather-windy","mdi:heat-wave","mdi:coolant-temperature","mdi:radiator","mdi:air-humidifier","mdi:air-purifier","mdi:air-filter","mdi:thermostat","mdi:thermostat-box"]},{label:"Security",color:"#ef5350",icons:["mdi:lock","mdi:lock-open","mdi:lock-smart","mdi:shield-home","mdi:shield-lock","mdi:alarm-light","mdi:bell-ring","mdi:bell","mdi:cctv","mdi:video-surveillance","mdi:camera","mdi:camera-iris","mdi:motion-sensor","mdi:door-sensor","mdi:window-sensor","mdi:smoke-detector","mdi:fire-alert","mdi:siren","mdi:shield-check","mdi:security"]},{label:"Doors & Windows",color:"#ab47bc",icons:["mdi:door","mdi:door-open","mdi:door-closed","mdi:door-closed-lock","mdi:window-closed","mdi:window-open","mdi:window-shutter","mdi:window-shutter-open","mdi:blinds","mdi:blinds-open","mdi:curtains","mdi:curtains-closed","mdi:garage","mdi:garage-open","mdi:gate","mdi:gate-open","mdi:roller-shade","mdi:roller-shade-closed","mdi:awning","mdi:awning-outline"]},{label:"Rooms",color:"#66bb6a",icons:["mdi:sofa","mdi:bed","mdi:bed-double","mdi:bunk-bed","mdi:bathtub","mdi:shower","mdi:toilet","mdi:sink","mdi:television","mdi:desk","mdi:table-furniture","mdi:wardrobe","mdi:bookshelf","mdi:chair-rolling","mdi:stairs","mdi:elevator","mdi:room-service","mdi:baby-carriage","mdi:toy-brick","mdi:cradle"]},{label:"Kitchen",color:"#ff7043",icons:["mdi:fridge","mdi:fridge-outline","mdi:stove","mdi:microwave","mdi:dishwasher","mdi:coffee-maker","mdi:toaster-oven","mdi:blender","mdi:food-fork-drink","mdi:pot-steam","mdi:silverware-fork-knife","mdi:glass-wine","mdi:beer","mdi:water-pump","mdi:faucet","mdi:countertop","mdi:kettle","mdi:grill","mdi:ice-cream","mdi:food-apple"]},{label:"Media",color:"#7e57c2",icons:["mdi:speaker","mdi:speaker-wireless","mdi:cast","mdi:cast-audio","mdi:play-circle","mdi:pause-circle","mdi:skip-next","mdi:skip-previous","mdi:volume-high","mdi:volume-medium","mdi:volume-low","mdi:volume-off","mdi:headphones","mdi:microphone","mdi:music","mdi:music-note","mdi:radio","mdi:gamepad-variant","mdi:monitor","mdi:projector"]},{label:"Power & Energy",color:"#ffa726",icons:["mdi:power-plug","mdi:power-plug-off","mdi:power-socket","mdi:flash","mdi:flash-off","mdi:battery","mdi:battery-charging","mdi:battery-50","mdi:battery-alert","mdi:solar-power","mdi:solar-panel","mdi:wind-turbine","mdi:ev-station","mdi:meter-electric","mdi:transmission-tower","mdi:power-cycle","mdi:lightning-bolt","mdi:electric-switch","mdi:surge-protector","mdi:battery-heart"]},{label:"Sensors",color:"#26c6da",icons:["mdi:eye","mdi:motion-sensor","mdi:run","mdi:walk","mdi:water-alert","mdi:leak","mdi:gauge","mdi:speedometer","mdi:scale-bathroom","mdi:pulse","mdi:heart-pulse","mdi:signal","mdi:signal-cellular-3","mdi:wifi","mdi:bluetooth","mdi:nfc","mdi:chip","mdi:counter","mdi:timer-sand","mdi:clock-outline"]},{label:"Weather",color:"#42a5f5",icons:["mdi:weather-sunny","mdi:weather-night","mdi:weather-cloudy","mdi:weather-partly-cloudy","mdi:weather-rainy","mdi:weather-pouring","mdi:weather-snowy","mdi:weather-snowy-heavy","mdi:weather-lightning","mdi:weather-fog","mdi:weather-windy-variant","mdi:weather-hail","mdi:umbrella","mdi:sunglasses","mdi:moon-waning-crescent","mdi:sun-compass","mdi:thermometer-lines","mdi:waves","mdi:weather-tornado","mdi:weather-hurricane"]},{label:"Outdoor & Garden",color:"#8bc34a",icons:["mdi:tree","mdi:flower","mdi:flower-tulip","mdi:leaf","mdi:sprout","mdi:grass","mdi:mushroom","mdi:cactus","mdi:water","mdi:watering-can","mdi:sprinkler","mdi:sprinkler-variant","mdi:lawn-mower","mdi:shovel","mdi:rake","mdi:grill-outline","mdi:pool","mdi:hot-tub","mdi:fence","mdi:patio-heater"]},{label:"Appliances",color:"#78909c",icons:["mdi:washing-machine","mdi:tumble-dryer","mdi:iron","mdi:vacuum","mdi:vacuum-outline","mdi:robot-vacuum","mdi:water-boiler","mdi:water-heater","mdi:hair-dryer","mdi:printer-3d","mdi:printer","mdi:router-wireless","mdi:access-point","mdi:nas","mdi:server","mdi:cellphone","mdi:laptop","mdi:tablet","mdi:watch","mdi:keyboard"]},{label:"Transport",color:"#5c6bc0",icons:["mdi:car","mdi:car-electric","mdi:car-connected","mdi:car-door","mdi:garage-variant","mdi:bicycle","mdi:motorbike","mdi:scooter","mdi:bus","mdi:train","mdi:airplane","mdi:boat","mdi:parking","mdi:gas-station","mdi:ev-plug-type2","mdi:map-marker","mdi:compass","mdi:navigation","mdi:road","mdi:traffic-light"]},{label:"People & Home",color:"#ec407a",icons:["mdi:home","mdi:home-outline","mdi:home-variant","mdi:home-assistant","mdi:account","mdi:account-group","mdi:account-child","mdi:dog","mdi:cat","mdi:paw","mdi:baby-face-outline","mdi:human-male-female","mdi:human-greeting","mdi:hand-wave","mdi:phone","mdi:email","mdi:calendar","mdi:bell-alert","mdi:heart","mdi:star"]},{label:"Automation & System",color:"#78909c",icons:["mdi:cog","mdi:cog-outline","mdi:wrench","mdi:tools","mdi:auto-fix","mdi:robot","mdi:script-text","mdi:code-tags","mdi:webhook","mdi:api","mdi:cloud","mdi:database","mdi:update","mdi:reload","mdi:sync","mdi:timer","mdi:toggle-switch","mdi:numeric","mdi:form-select","mdi:palette","mdi:format-paint"]}],Ve=Ct.flatMap(s=>s.icons.map(o=>({icon:o,color:s.color,category:s.label})));function qt({value:s,onChange:o}){const[r,n]=h.useState(!1),[t,i]=h.useState(""),[a,l]=h.useState(null),c=h.useRef(null),f=h.useRef(null),[b,v]=h.useState({top:0,left:0});h.useEffect(()=>{if(r&&c.current){const u=c.current.getBoundingClientRect(),C=360,M=420;let E=u.bottom+6,L=u.left;L+C>window.innerWidth-8&&(L=window.innerWidth-C-8),E+M>window.innerHeight-8&&(E=u.top-M-6),v({top:Math.max(8,E),left:Math.max(8,L)})}},[r]),h.useEffect(()=>{if(!r)return;const u=C=>{f.current&&!f.current.contains(C.target)&&c.current&&!c.current.contains(C.target)&&n(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[r]),h.useEffect(()=>{if(!r)return;const u=C=>{C.key==="Escape"&&n(!1)};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[r]);const g=h.useMemo(()=>{const u=t.trim().toLowerCase();return!u&&!a?Ve:Ve.filter(C=>a&&C.category!==a?!1:u?C.icon.replace("mdi:","").replace(/-/g," ").includes(u)||C.category.toLowerCase().includes(u):!0)},[t,a]),m=s||"mdi:lightbulb";return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:c,type:"button",className:"icon-picker-trigger",onClick:()=>n(!r),title:"Pick icon",children:e.jsx(he,{icon:m,width:22,height:22})}),r&&Ue.createPortal(e.jsxs("div",{ref:f,className:"icon-picker-panel",style:{top:b.top,left:b.left},children:[e.jsx("div",{className:"icon-picker-search",children:e.jsx("input",{type:"text",placeholder:"Search icons...",value:t,onChange:u=>i(u.target.value),autoFocus:!0})}),e.jsxs("div",{className:"icon-picker-categories",children:[e.jsx("button",{type:"button",className:`icon-cat-tab${a?"":" active"}`,onClick:()=>l(null),style:{"--cat-color":"#aaa"},children:"All"}),Ct.map(u=>e.jsx("button",{type:"button",className:`icon-cat-tab${a===u.label?" active":""}`,onClick:()=>l(a===u.label?null:u.label),style:{"--cat-color":u.color},title:u.label,children:u.label},u.label))]}),e.jsxs("div",{className:"icon-picker-grid",children:[g.map((u,C)=>e.jsx("button",{type:"button",className:`icon-picker-item${u.icon===s?" selected":""}`,onClick:()=>{o(u.icon),n(!1)},title:u.icon.replace("mdi:","").replace(/-/g," "),style:{color:u.color},children:e.jsx(he,{icon:u.icon,width:24,height:24})},`${u.icon}-${C}`)),g.length===0&&e.jsxs("p",{className:"icon-picker-empty",children:['No icons match "',t,'"']})]})]}),document.body)]})}function Ft({entityId:s,friendlyName:o,sessionId:r,anchorRect:n,onClose:t,onSave:i,onHide:a}){const[l,c]=h.useState(""),[f,b]=h.useState(""),[v,g]=h.useState(!0),[m,u]=h.useState(!1);h.useEffect(()=>{(async()=>{try{const R=await I(`/api/ui/entity-props/${encodeURIComponent(s)}`,{sessionId:r});c(R.props.custom_name||""),b(R.props.custom_icon||"")}catch{}finally{g(!1)}})()},[s,r]);const C=h.useCallback(async()=>{u(!0);try{await I(`/api/ui/entity-props/${encodeURIComponent(s)}`,{method:"POST",sessionId:r,body:JSON.stringify({custom_name:l.trim()||null,custom_icon:f||null})}),i(),t()}catch(R){console.error("Save entity props failed:",R)}finally{u(!1)}},[s,r,l,f,i,t]),M=h.useCallback(async()=>{try{await I(`/api/ui/entity-props/${encodeURIComponent(s)}`,{method:"DELETE",sessionId:r}),c(""),b(""),i(),t()}catch(R){console.error("Reset entity props failed:",R)}},[s,r,i,t]),E=320,L=260;let k=n.bottom+8,d=n.left-E/2+n.width/2;return d+E>window.innerWidth-8&&(d=window.innerWidth-E-8),d<8&&(d=8),k+L>window.innerHeight-8&&(k=n.top-L-8),Ue.createPortal(e.jsx("div",{className:"entity-prop-overlay",onClick:t,children:e.jsx("div",{className:"entity-prop-editor",style:{top:k,left:d,width:E},onClick:R=>R.stopPropagation(),children:v?e.jsx("p",{className:"note",style:{textAlign:"center",padding:"1rem"},children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entity-prop-header",children:[e.jsx(he,{icon:"mdi:cog",width:16,height:16}),e.jsx("span",{className:"entity-prop-title",children:o}),e.jsx("button",{type:"button",className:"entity-prop-close",onClick:t,children:"Ã—"})]}),e.jsxs("div",{className:"entity-prop-body",children:[e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Icon"}),e.jsxs("div",{className:"entity-prop-icon-row",children:[e.jsx(qt,{value:f,onChange:b}),f&&e.jsx("span",{className:"entity-prop-icon-name",children:f.replace("mdi:","")}),f&&e.jsx("button",{type:"button",className:"entity-prop-clear-btn",onClick:()=>b(""),title:"Clear icon override",children:"Ã—"})]})]}),e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",value:l,onChange:R=>c(R.target.value),placeholder:o,className:"entity-prop-input"})]})]}),e.jsxs("div",{className:"entity-prop-actions",children:[e.jsxs("button",{type:"button",className:"entity-prop-hide-btn",onClick:()=>{a(),t()},title:"Hide this entity",children:[e.jsx(he,{icon:"mdi:eye-off",width:14,height:14})," Hide"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{type:"button",className:"entity-prop-reset-btn",onClick:M,children:"Reset"}),e.jsx("button",{type:"button",className:"entity-prop-save-btn",onClick:C,disabled:m,children:m?"...":"Save"})]})]})})}),document.body)}var ae={},ge,Ge;function Ht(){return Ge||(Ge=1,ge=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),ge}var pe={},ee={},We;function se(){if(We)return ee;We=1;let s;const o=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return ee.getSymbolSize=function(n){if(!n)throw new Error('"version" cannot be null or undefined');if(n<1||n>40)throw new Error('"version" should be in range from 1 to 40');return n*4+17},ee.getSymbolTotalCodewords=function(n){return o[n]},ee.getBCHDigit=function(r){let n=0;for(;r!==0;)n++,r>>>=1;return n},ee.setToSJISFunction=function(n){if(typeof n!="function")throw new Error('"toSJISFunc" is not a valid function.');s=n},ee.isKanjiModeEnabled=function(){return typeof s<"u"},ee.toSJIS=function(n){return s(n)},ee}var ye={},Qe;function Oe(){return Qe||(Qe=1,(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+r)}}s.isValid=function(n){return n&&typeof n.bit<"u"&&n.bit>=0&&n.bit<4},s.from=function(n,t){if(s.isValid(n))return n;try{return o(n)}catch{return t}}})(ye)),ye}var be,Ye;function zt(){if(Ye)return be;Ye=1;function s(){this.buffer=[],this.length=0}return s.prototype={get:function(o){const r=Math.floor(o/8);return(this.buffer[r]>>>7-o%8&1)===1},put:function(o,r){for(let n=0;n<r;n++)this.putBit((o>>>r-n-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(o){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),o&&(this.buffer[r]|=128>>>this.length%8),this.length++}},be=s,be}var we,Ze;function Jt(){if(Ze)return we;Ze=1;function s(o){if(!o||o<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=o,this.data=new Uint8Array(o*o),this.reservedBit=new Uint8Array(o*o)}return s.prototype.set=function(o,r,n,t){const i=o*this.size+r;this.data[i]=n,t&&(this.reservedBit[i]=!0)},s.prototype.get=function(o,r){return this.data[o*this.size+r]},s.prototype.xor=function(o,r,n){this.data[o*this.size+r]^=n},s.prototype.isReserved=function(o,r){return this.reservedBit[o*this.size+r]},we=s,we}var Ne={},Xe;function Kt(){return Xe||(Xe=1,(function(s){const o=se().getSymbolSize;s.getRowColCoords=function(n){if(n===1)return[];const t=Math.floor(n/7)+2,i=o(n),a=i===145?26:Math.ceil((i-13)/(2*t-2))*2,l=[i-7];for(let c=1;c<t-1;c++)l[c]=l[c-1]-a;return l.push(6),l.reverse()},s.getPositions=function(n){const t=[],i=s.getRowColCoords(n),a=i.length;for(let l=0;l<a;l++)for(let c=0;c<a;c++)l===0&&c===0||l===0&&c===a-1||l===a-1&&c===0||t.push([i[l],i[c]]);return t}})(Ne)),Ne}var ve={},$e;function Vt(){if($e)return ve;$e=1;const s=se().getSymbolSize,o=7;return ve.getPositions=function(n){const t=s(n);return[[0,0],[t-o,0],[0,t-o]]},ve}var Ce={},et;function Gt(){return et||(et=1,(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const o={N1:3,N2:3,N3:40,N4:10};s.isValid=function(t){return t!=null&&t!==""&&!isNaN(t)&&t>=0&&t<=7},s.from=function(t){return s.isValid(t)?parseInt(t,10):void 0},s.getPenaltyN1=function(t){const i=t.size;let a=0,l=0,c=0,f=null,b=null;for(let v=0;v<i;v++){l=c=0,f=b=null;for(let g=0;g<i;g++){let m=t.get(v,g);m===f?l++:(l>=5&&(a+=o.N1+(l-5)),f=m,l=1),m=t.get(g,v),m===b?c++:(c>=5&&(a+=o.N1+(c-5)),b=m,c=1)}l>=5&&(a+=o.N1+(l-5)),c>=5&&(a+=o.N1+(c-5))}return a},s.getPenaltyN2=function(t){const i=t.size;let a=0;for(let l=0;l<i-1;l++)for(let c=0;c<i-1;c++){const f=t.get(l,c)+t.get(l,c+1)+t.get(l+1,c)+t.get(l+1,c+1);(f===4||f===0)&&a++}return a*o.N2},s.getPenaltyN3=function(t){const i=t.size;let a=0,l=0,c=0;for(let f=0;f<i;f++){l=c=0;for(let b=0;b<i;b++)l=l<<1&2047|t.get(f,b),b>=10&&(l===1488||l===93)&&a++,c=c<<1&2047|t.get(b,f),b>=10&&(c===1488||c===93)&&a++}return a*o.N3},s.getPenaltyN4=function(t){let i=0;const a=t.data.length;for(let c=0;c<a;c++)i+=t.data[c];return Math.abs(Math.ceil(i*100/a/5)-10)*o.N4};function r(n,t,i){switch(n){case s.Patterns.PATTERN000:return(t+i)%2===0;case s.Patterns.PATTERN001:return t%2===0;case s.Patterns.PATTERN010:return i%3===0;case s.Patterns.PATTERN011:return(t+i)%3===0;case s.Patterns.PATTERN100:return(Math.floor(t/2)+Math.floor(i/3))%2===0;case s.Patterns.PATTERN101:return t*i%2+t*i%3===0;case s.Patterns.PATTERN110:return(t*i%2+t*i%3)%2===0;case s.Patterns.PATTERN111:return(t*i%3+(t+i)%2)%2===0;default:throw new Error("bad maskPattern:"+n)}}s.applyMask=function(t,i){const a=i.size;for(let l=0;l<a;l++)for(let c=0;c<a;c++)i.isReserved(c,l)||i.xor(c,l,r(t,c,l))},s.getBestMask=function(t,i){const a=Object.keys(s.Patterns).length;let l=0,c=1/0;for(let f=0;f<a;f++){i(f),s.applyMask(f,t);const b=s.getPenaltyN1(t)+s.getPenaltyN2(t)+s.getPenaltyN3(t)+s.getPenaltyN4(t);s.applyMask(f,t),b<c&&(c=b,l=f)}return l}})(Ce)),Ce}var me={},tt;function jt(){if(tt)return me;tt=1;const s=Oe(),o=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return me.getBlocksCount=function(t,i){switch(i){case s.L:return o[(t-1)*4+0];case s.M:return o[(t-1)*4+1];case s.Q:return o[(t-1)*4+2];case s.H:return o[(t-1)*4+3];default:return}},me.getTotalCodewordsCount=function(t,i){switch(i){case s.L:return r[(t-1)*4+0];case s.M:return r[(t-1)*4+1];case s.Q:return r[(t-1)*4+2];case s.H:return r[(t-1)*4+3];default:return}},me}var je={},de={},nt;function Wt(){if(nt)return de;nt=1;const s=new Uint8Array(512),o=new Uint8Array(256);return(function(){let n=1;for(let t=0;t<255;t++)s[t]=n,o[n]=t,n<<=1,n&256&&(n^=285);for(let t=255;t<512;t++)s[t]=s[t-255]})(),de.log=function(n){if(n<1)throw new Error("log("+n+")");return o[n]},de.exp=function(n){return s[n]},de.mul=function(n,t){return n===0||t===0?0:s[o[n]+o[t]]},de}var it;function Qt(){return it||(it=1,(function(s){const o=Wt();s.mul=function(n,t){const i=new Uint8Array(n.length+t.length-1);for(let a=0;a<n.length;a++)for(let l=0;l<t.length;l++)i[a+l]^=o.mul(n[a],t[l]);return i},s.mod=function(n,t){let i=new Uint8Array(n);for(;i.length-t.length>=0;){const a=i[0];for(let c=0;c<t.length;c++)i[c]^=o.mul(t[c],a);let l=0;for(;l<i.length&&i[l]===0;)l++;i=i.slice(l)}return i},s.generateECPolynomial=function(n){let t=new Uint8Array([1]);for(let i=0;i<n;i++)t=s.mul(t,new Uint8Array([1,o.exp(i)]));return t}})(je)),je}var xe,st;function Yt(){if(st)return xe;st=1;const s=Qt();function o(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}return o.prototype.initialize=function(n){this.degree=n,this.genPoly=s.generateECPolynomial(this.degree)},o.prototype.encode=function(n){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(n.length+this.degree);t.set(n);const i=s.mod(t,this.genPoly),a=this.degree-i.length;if(a>0){const l=new Uint8Array(this.degree);return l.set(i,a),l}return i},xe=o,xe}var Ee={},Se={},ke={},ot;function xt(){return ot||(ot=1,ke.isValid=function(o){return!isNaN(o)&&o>=1&&o<=40}),ke}var Q={},rt;function Et(){if(rt)return Q;rt=1;const s="[0-9]+",o="[A-Z $%*+\\-./:]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const n="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+`)(?:.|[\r
]))+`;Q.KANJI=new RegExp(r,"g"),Q.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),Q.BYTE=new RegExp(n,"g"),Q.NUMERIC=new RegExp(s,"g"),Q.ALPHANUMERIC=new RegExp(o,"g");const t=new RegExp("^"+r+"$"),i=new RegExp("^"+s+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return Q.testKanji=function(c){return t.test(c)},Q.testNumeric=function(c){return i.test(c)},Q.testAlphanumeric=function(c){return a.test(c)},Q}var at;function oe(){return at||(at=1,(function(s){const o=xt(),r=Et();s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(i,a){if(!i.ccBits)throw new Error("Invalid mode: "+i);if(!o.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?i.ccBits[0]:a<27?i.ccBits[1]:i.ccBits[2]},s.getBestModeForData=function(i){return r.testNumeric(i)?s.NUMERIC:r.testAlphanumeric(i)?s.ALPHANUMERIC:r.testKanji(i)?s.KANJI:s.BYTE},s.toString=function(i){if(i&&i.id)return i.id;throw new Error("Invalid mode")},s.isValid=function(i){return i&&i.bit&&i.ccBits};function n(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+t)}}s.from=function(i,a){if(s.isValid(i))return i;try{return n(i)}catch{return a}}})(Se)),Se}var lt;function Zt(){return lt||(lt=1,(function(s){const o=se(),r=jt(),n=Oe(),t=oe(),i=xt(),a=7973,l=o.getBCHDigit(a);function c(g,m,u){for(let C=1;C<=40;C++)if(m<=s.getCapacity(C,u,g))return C}function f(g,m){return t.getCharCountIndicator(g,m)+4}function b(g,m){let u=0;return g.forEach(function(C){const M=f(C.mode,m);u+=M+C.getBitsLength()}),u}function v(g,m){for(let u=1;u<=40;u++)if(b(g,u)<=s.getCapacity(u,m,t.MIXED))return u}s.from=function(m,u){return i.isValid(m)?parseInt(m,10):u},s.getCapacity=function(m,u,C){if(!i.isValid(m))throw new Error("Invalid QR Code version");typeof C>"u"&&(C=t.BYTE);const M=o.getSymbolTotalCodewords(m),E=r.getTotalCodewordsCount(m,u),L=(M-E)*8;if(C===t.MIXED)return L;const k=L-f(C,m);switch(C){case t.NUMERIC:return Math.floor(k/10*3);case t.ALPHANUMERIC:return Math.floor(k/11*2);case t.KANJI:return Math.floor(k/13);case t.BYTE:default:return Math.floor(k/8)}},s.getBestVersionForData=function(m,u){let C;const M=n.from(u,n.M);if(Array.isArray(m)){if(m.length>1)return v(m,M);if(m.length===0)return 1;C=m[0]}else C=m;return c(C.mode,C.getLength(),M)},s.getEncodedBits=function(m){if(!i.isValid(m)||m<7)throw new Error("Invalid QR Code version");let u=m<<12;for(;o.getBCHDigit(u)-l>=0;)u^=a<<o.getBCHDigit(u)-l;return m<<12|u}})(Ee)),Ee}var Ae={},ct;function Xt(){if(ct)return Ae;ct=1;const s=se(),o=1335,r=21522,n=s.getBCHDigit(o);return Ae.getEncodedBits=function(i,a){const l=i.bit<<3|a;let c=l<<10;for(;s.getBCHDigit(c)-n>=0;)c^=o<<s.getBCHDigit(c)-n;return(l<<10|c)^r},Ae}var Pe={},Re,dt;function $t(){if(dt)return Re;dt=1;const s=oe();function o(r){this.mode=s.NUMERIC,this.data=r.toString()}return o.getBitsLength=function(n){return 10*Math.floor(n/3)+(n%3?n%3*3+1:0)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(n){let t,i,a;for(t=0;t+3<=this.data.length;t+=3)i=this.data.substr(t,3),a=parseInt(i,10),n.put(a,10);const l=this.data.length-t;l>0&&(i=this.data.substr(t),a=parseInt(i,10),n.put(a,l*3+1))},Re=o,Re}var Te,ut;function en(){if(ut)return Te;ut=1;const s=oe(),o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function r(n){this.mode=s.ALPHANUMERIC,this.data=n}return r.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(t){let i;for(i=0;i+2<=this.data.length;i+=2){let a=o.indexOf(this.data[i])*45;a+=o.indexOf(this.data[i+1]),t.put(a,11)}this.data.length%2&&t.put(o.indexOf(this.data[i]),6)},Te=r,Te}var Le,mt;function tn(){if(mt)return Le;mt=1;const s=oe();function o(r){this.mode=s.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}return o.getBitsLength=function(n){return n*8},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(r){for(let n=0,t=this.data.length;n<t;n++)r.put(this.data[n],8)},Le=o,Le}var Be,ht;function nn(){if(ht)return Be;ht=1;const s=oe(),o=se();function r(n){this.mode=s.KANJI,this.data=n}return r.getBitsLength=function(t){return t*13},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(n){let t;for(t=0;t<this.data.length;t++){let i=o.toSJIS(this.data[t]);if(i>=33088&&i<=40956)i-=33088;else if(i>=57408&&i<=60351)i-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);i=(i>>>8&255)*192+(i&255),n.put(i,13)}},Be=r,Be}var Me={exports:{}},ft;function sn(){return ft||(ft=1,(function(s){var o={single_source_shortest_paths:function(r,n,t){var i={},a={};a[n]=0;var l=o.PriorityQueue.make();l.push(n,0);for(var c,f,b,v,g,m,u,C,M;!l.empty();){c=l.pop(),f=c.value,v=c.cost,g=r[f]||{};for(b in g)g.hasOwnProperty(b)&&(m=g[b],u=v+m,C=a[b],M=typeof a[b]>"u",(M||C>u)&&(a[b]=u,l.push(b,u),i[b]=f))}if(typeof t<"u"&&typeof a[t]>"u"){var E=["Could not find a path from ",n," to ",t,"."].join("");throw new Error(E)}return i},extract_shortest_path_from_predecessor_list:function(r,n){for(var t=[],i=n;i;)t.push(i),r[i],i=r[i];return t.reverse(),t},find_path:function(r,n,t){var i=o.single_source_shortest_paths(r,n,t);return o.extract_shortest_path_from_predecessor_list(i,t)},PriorityQueue:{make:function(r){var n=o.PriorityQueue,t={},i;r=r||{};for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t.queue=[],t.sorter=r.sorter||n.default_sorter,t},default_sorter:function(r,n){return r.cost-n.cost},push:function(r,n){var t={value:r,cost:n};this.queue.push(t),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=o})(Me)),Me.exports}var gt;function on(){return gt||(gt=1,(function(s){const o=oe(),r=$t(),n=en(),t=tn(),i=nn(),a=Et(),l=se(),c=sn();function f(E){return unescape(encodeURIComponent(E)).length}function b(E,L,k){const d=[];let R;for(;(R=E.exec(k))!==null;)d.push({data:R[0],index:R.index,mode:L,length:R[0].length});return d}function v(E){const L=b(a.NUMERIC,o.NUMERIC,E),k=b(a.ALPHANUMERIC,o.ALPHANUMERIC,E);let d,R;return l.isKanjiModeEnabled()?(d=b(a.BYTE,o.BYTE,E),R=b(a.KANJI,o.KANJI,E)):(d=b(a.BYTE_KANJI,o.BYTE,E),R=[]),L.concat(k,d,R).sort(function(p,w){return p.index-w.index}).map(function(p){return{data:p.data,mode:p.mode,length:p.length}})}function g(E,L){switch(L){case o.NUMERIC:return r.getBitsLength(E);case o.ALPHANUMERIC:return n.getBitsLength(E);case o.KANJI:return i.getBitsLength(E);case o.BYTE:return t.getBitsLength(E)}}function m(E){return E.reduce(function(L,k){const d=L.length-1>=0?L[L.length-1]:null;return d&&d.mode===k.mode?(L[L.length-1].data+=k.data,L):(L.push(k),L)},[])}function u(E){const L=[];for(let k=0;k<E.length;k++){const d=E[k];switch(d.mode){case o.NUMERIC:L.push([d,{data:d.data,mode:o.ALPHANUMERIC,length:d.length},{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.ALPHANUMERIC:L.push([d,{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.KANJI:L.push([d,{data:d.data,mode:o.BYTE,length:f(d.data)}]);break;case o.BYTE:L.push([{data:d.data,mode:o.BYTE,length:f(d.data)}])}}return L}function C(E,L){const k={},d={start:{}};let R=["start"];for(let y=0;y<E.length;y++){const p=E[y],w=[];for(let N=0;N<p.length;N++){const A=p[N],S=""+y+N;w.push(S),k[S]={node:A,lastCount:0},d[S]={};for(let T=0;T<R.length;T++){const P=R[T];k[P]&&k[P].node.mode===A.mode?(d[P][S]=g(k[P].lastCount+A.length,A.mode)-g(k[P].lastCount,A.mode),k[P].lastCount+=A.length):(k[P]&&(k[P].lastCount=A.length),d[P][S]=g(A.length,A.mode)+4+o.getCharCountIndicator(A.mode,L))}}R=w}for(let y=0;y<R.length;y++)d[R[y]].end=0;return{map:d,table:k}}function M(E,L){let k;const d=o.getBestModeForData(E);if(k=o.from(L,d),k!==o.BYTE&&k.bit<d.bit)throw new Error('"'+E+'" cannot be encoded with mode '+o.toString(k)+`.
 Suggested mode is: `+o.toString(d));switch(k===o.KANJI&&!l.isKanjiModeEnabled()&&(k=o.BYTE),k){case o.NUMERIC:return new r(E);case o.ALPHANUMERIC:return new n(E);case o.KANJI:return new i(E);case o.BYTE:return new t(E)}}s.fromArray=function(L){return L.reduce(function(k,d){return typeof d=="string"?k.push(M(d,null)):d.data&&k.push(M(d.data,d.mode)),k},[])},s.fromString=function(L,k){const d=v(L,l.isKanjiModeEnabled()),R=u(d),y=C(R,k),p=c.find_path(y.map,"start","end"),w=[];for(let N=1;N<p.length-1;N++)w.push(y.table[p[N]].node);return s.fromArray(m(w))},s.rawSplit=function(L){return s.fromArray(v(L,l.isKanjiModeEnabled()))}})(Pe)),Pe}var pt;function rn(){if(pt)return pe;pt=1;const s=se(),o=Oe(),r=zt(),n=Jt(),t=Kt(),i=Vt(),a=Gt(),l=jt(),c=Yt(),f=Zt(),b=Xt(),v=oe(),g=on();function m(y,p){const w=y.size,N=i.getPositions(p);for(let A=0;A<N.length;A++){const S=N[A][0],T=N[A][1];for(let P=-1;P<=7;P++)if(!(S+P<=-1||w<=S+P))for(let B=-1;B<=7;B++)T+B<=-1||w<=T+B||(P>=0&&P<=6&&(B===0||B===6)||B>=0&&B<=6&&(P===0||P===6)||P>=2&&P<=4&&B>=2&&B<=4?y.set(S+P,T+B,!0,!0):y.set(S+P,T+B,!1,!0))}}function u(y){const p=y.size;for(let w=8;w<p-8;w++){const N=w%2===0;y.set(w,6,N,!0),y.set(6,w,N,!0)}}function C(y,p){const w=t.getPositions(p);for(let N=0;N<w.length;N++){const A=w[N][0],S=w[N][1];for(let T=-2;T<=2;T++)for(let P=-2;P<=2;P++)T===-2||T===2||P===-2||P===2||T===0&&P===0?y.set(A+T,S+P,!0,!0):y.set(A+T,S+P,!1,!0)}}function M(y,p){const w=y.size,N=f.getEncodedBits(p);let A,S,T;for(let P=0;P<18;P++)A=Math.floor(P/3),S=P%3+w-8-3,T=(N>>P&1)===1,y.set(A,S,T,!0),y.set(S,A,T,!0)}function E(y,p,w){const N=y.size,A=b.getEncodedBits(p,w);let S,T;for(S=0;S<15;S++)T=(A>>S&1)===1,S<6?y.set(S,8,T,!0):S<8?y.set(S+1,8,T,!0):y.set(N-15+S,8,T,!0),S<8?y.set(8,N-S-1,T,!0):S<9?y.set(8,15-S-1+1,T,!0):y.set(8,15-S-1,T,!0);y.set(N-8,8,1,!0)}function L(y,p){const w=y.size;let N=-1,A=w-1,S=7,T=0;for(let P=w-1;P>0;P-=2)for(P===6&&P--;;){for(let B=0;B<2;B++)if(!y.isReserved(A,P-B)){let V=!1;T<p.length&&(V=(p[T]>>>S&1)===1),y.set(A,P-B,V),S--,S===-1&&(T++,S=7)}if(A+=N,A<0||w<=A){A-=N,N=-N;break}}}function k(y,p,w){const N=new r;w.forEach(function(B){N.put(B.mode.bit,4),N.put(B.getLength(),v.getCharCountIndicator(B.mode,y)),B.write(N)});const A=s.getSymbolTotalCodewords(y),S=l.getTotalCodewordsCount(y,p),T=(A-S)*8;for(N.getLengthInBits()+4<=T&&N.put(0,4);N.getLengthInBits()%8!==0;)N.putBit(0);const P=(T-N.getLengthInBits())/8;for(let B=0;B<P;B++)N.put(B%2?17:236,8);return d(N,y,p)}function d(y,p,w){const N=s.getSymbolTotalCodewords(p),A=l.getTotalCodewordsCount(p,w),S=N-A,T=l.getBlocksCount(p,w),P=N%T,B=T-P,V=Math.floor(N/T),J=Math.floor(S/T),Z=J+1,K=V-J,te=new c(K);let X=0;const G=new Array(T),ne=new Array(T);let Y=0;const re=new Uint8Array(y.buffer);for(let H=0;H<T;H++){const le=H<B?J:Z;G[H]=re.slice(X,X+le),ne[H]=te.encode(G[H]),X+=le,Y=Math.max(Y,le)}const W=new Uint8Array(N);let $=0,x,q;for(x=0;x<Y;x++)for(q=0;q<T;q++)x<G[q].length&&(W[$++]=G[q][x]);for(x=0;x<K;x++)for(q=0;q<T;q++)W[$++]=ne[q][x];return W}function R(y,p,w,N){let A;if(Array.isArray(y))A=g.fromArray(y);else if(typeof y=="string"){let V=p;if(!V){const J=g.rawSplit(y);V=f.getBestVersionForData(J,w)}A=g.fromString(y,V||40)}else throw new Error("Invalid data");const S=f.getBestVersionForData(A,w);if(!S)throw new Error("The amount of data is too big to be stored in a QR Code");if(!p)p=S;else if(p<S)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+S+`.
`);const T=k(p,w,A),P=s.getSymbolSize(p),B=new n(P);return m(B,p),u(B),C(B,p),E(B,w,0),p>=7&&M(B,p),L(B,T),isNaN(N)&&(N=a.getBestMask(B,E.bind(null,B,w))),a.applyMask(N,B),E(B,w,N),{modules:B,version:p,errorCorrectionLevel:w,maskPattern:N,segments:A}}return pe.create=function(p,w){if(typeof p>"u"||p==="")throw new Error("No input text");let N=o.M,A,S;return typeof w<"u"&&(N=o.from(w.errorCorrectionLevel,o.M),A=f.from(w.version),S=a.from(w.maskPattern),w.toSJISFunc&&s.setToSJISFunction(w.toSJISFunc)),R(p,A,N,S)},pe}var Ie={},De={},yt;function St(){return yt||(yt=1,(function(s){function o(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let n=r.slice().replace("#","").split("");if(n.length<3||n.length===5||n.length>8)throw new Error("Invalid hex color: "+r);(n.length===3||n.length===4)&&(n=Array.prototype.concat.apply([],n.map(function(i){return[i,i]}))),n.length===6&&n.push("F","F");const t=parseInt(n.join(""),16);return{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:t&255,hex:"#"+n.slice(0,6).join("")}}s.getOptions=function(n){n||(n={}),n.color||(n.color={});const t=typeof n.margin>"u"||n.margin===null||n.margin<0?4:n.margin,i=n.width&&n.width>=21?n.width:void 0,a=n.scale||4;return{width:i,scale:i?4:a,margin:t,color:{dark:o(n.color.dark||"#000000ff"),light:o(n.color.light||"#ffffffff")},type:n.type,rendererOpts:n.rendererOpts||{}}},s.getScale=function(n,t){return t.width&&t.width>=n+t.margin*2?t.width/(n+t.margin*2):t.scale},s.getImageWidth=function(n,t){const i=s.getScale(n,t);return Math.floor((n+t.margin*2)*i)},s.qrToImageData=function(n,t,i){const a=t.modules.size,l=t.modules.data,c=s.getScale(a,i),f=Math.floor((a+i.margin*2)*c),b=i.margin*c,v=[i.color.light,i.color.dark];for(let g=0;g<f;g++)for(let m=0;m<f;m++){let u=(g*f+m)*4,C=i.color.light;if(g>=b&&m>=b&&g<f-b&&m<f-b){const M=Math.floor((g-b)/c),E=Math.floor((m-b)/c);C=v[l[M*a+E]?1:0]}n[u++]=C.r,n[u++]=C.g,n[u++]=C.b,n[u]=C.a}}})(De)),De}var bt;function an(){return bt||(bt=1,(function(s){const o=St();function r(t,i,a){t.clearRect(0,0,i.width,i.height),i.style||(i.style={}),i.height=a,i.width=a,i.style.height=a+"px",i.style.width=a+"px"}function n(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(i,a,l){let c=l,f=a;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),a||(f=n()),c=o.getOptions(c);const b=o.getImageWidth(i.modules.size,c),v=f.getContext("2d"),g=v.createImageData(b,b);return o.qrToImageData(g.data,i,c),r(v,f,b),v.putImageData(g,0,0),f},s.renderToDataURL=function(i,a,l){let c=l;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),c||(c={});const f=s.render(i,a,c),b=c.type||"image/png",v=c.rendererOpts||{};return f.toDataURL(b,v.quality)}})(Ie)),Ie}var _e={},wt;function ln(){if(wt)return _e;wt=1;const s=St();function o(t,i){const a=t.a/255,l=i+'="'+t.hex+'"';return a<1?l+" "+i+'-opacity="'+a.toFixed(2).slice(1)+'"':l}function r(t,i,a){let l=t+i;return typeof a<"u"&&(l+=" "+a),l}function n(t,i,a){let l="",c=0,f=!1,b=0;for(let v=0;v<t.length;v++){const g=Math.floor(v%i),m=Math.floor(v/i);!g&&!f&&(f=!0),t[v]?(b++,v>0&&g>0&&t[v-1]||(l+=f?r("M",g+a,.5+m+a):r("m",c,0),c=0,f=!1),g+1<i&&t[v+1]||(l+=r("h",b),b=0)):c++}return l}return _e.render=function(i,a,l){const c=s.getOptions(a),f=i.modules.size,b=i.modules.data,v=f+c.margin*2,g=c.color.light.a?"<path "+o(c.color.light,"fill")+' d="M0 0h'+v+"v"+v+'H0z"/>':"",m="<path "+o(c.color.dark,"stroke")+' d="'+n(b,f,c.margin)+'"/>',u='viewBox="0 0 '+v+" "+v+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+u+' shape-rendering="crispEdges">'+g+m+`</svg>
`;return typeof l=="function"&&l(null,M),M},_e}var Nt;function cn(){if(Nt)return ae;Nt=1;const s=Ht(),o=rn(),r=an(),n=ln();function t(i,a,l,c,f){const b=[].slice.call(arguments,1),v=b.length,g=typeof b[v-1]=="function";if(!g&&!s())throw new Error("Callback required as last argument");if(g){if(v<2)throw new Error("Too few arguments provided");v===2?(f=l,l=a,a=c=void 0):v===3&&(a.getContext&&typeof f>"u"?(f=c,c=void 0):(f=c,c=l,l=a,a=void 0))}else{if(v<1)throw new Error("Too few arguments provided");return v===1?(l=a,a=c=void 0):v===2&&!a.getContext&&(c=l,l=a,a=void 0),new Promise(function(m,u){try{const C=o.create(l,c);m(i(C,a,c))}catch(C){u(C)}})}try{const m=o.create(l,c);f(null,i(m,a,c))}catch(m){f(m)}}return ae.create=o.create,ae.toCanvas=t.bind(null,r.render),ae.toDataURL=t.bind(null,r.renderToDataURL),ae.toString=t.bind(null,function(i,a,l){return n.render(i,l)}),ae}var dn=cn();const un=Bt(dn);function mn({sessionId:s,hassUrl:o,hassToken:r,onLogout:n}){const[t,i]=h.useState([]),[a,l]=h.useState(new Set),[c,f]=h.useState("LobbyHA"),[b,v]=h.useState(!1),[g,m]=h.useState(""),[u,C]=h.useState(!0),[M,E]=h.useState(!1),[L,k]=h.useState(!1),[d,R]=h.useState(!1),[y,p]=h.useState(!1),[w,N]=h.useState(!1),[A,S]=h.useState(!1),[T,P]=h.useState(!1),[B,V]=h.useState({}),[J,Z]=h.useState(null),[K,te]=h.useState(null),[X,G]=h.useState(""),[ne,Y]=h.useState(""),[re,W]=h.useState(null),[$,x]=h.useState(null),q=h.useRef(null),H=h.useCallback(async(j=!1)=>{j||C(!0);try{const[_,U,O,D]=await Promise.all([I("/api/ui/modules",{sessionId:s}),I("/api/ui/hidden",{sessionId:s}),I("/api/ui/guest-entities",{sessionId:s}),I("/api/ui/entity-props",{sessionId:s})]);i(_.modules),l(new Set(U.hidden)),f(O.title||"LobbyHA");const F={};for(const z of D.props)F[z.entity_id]={custom_name:z.custom_name,custom_icon:z.custom_icon};V(F)}catch{}finally{j||C(!1)}},[s]);h.useEffect(()=>{H()},[H]),h.useEffect(()=>{if(!A)return;const j=_=>{q.current&&!q.current.contains(_.target)&&S(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[A]);const le=()=>{m(c),v(!0)},qe=async()=>{const j=g.trim()||"LobbyHA";f(j),v(!1),await I("/api/ui/guest-entities",{method:"POST",sessionId:s,body:JSON.stringify({title:j})})},Fe=async j=>{const _=new Set(a);_.add(j),l(_),await I("/api/ui/hidden",{method:"POST",sessionId:s,body:JSON.stringify({hidden:Array.from(_)})})},kt=async j=>{const _=new Set(a);_.delete(j),l(_),await I("/api/ui/hidden",{method:"POST",sessionId:s,body:JSON.stringify({hidden:Array.from(_)})})},At=async(j,_)=>{const U=t.find(O=>O.entities.includes(j));if(U){const O=U.entities.filter(D=>D!==j);i(D=>D.map(F=>F.id===U.id?{...F,entities:O}:F)),await I(`/api/ui/modules/${U.id}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:O})})}if(_!==null){const O=t.find(D=>D.id===_);if(O){const D=[...O.entities.filter(F=>F!==j),j];i(F=>F.map(z=>z.id===O.id?{...z,entities:D}:z)),await I(`/api/ui/modules/${O.id}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:D})})}}H(!0)},He=async(j,_,U)=>{const O=t.find(ce=>ce.id===j);if(!O)return;const D=[...O.entities],F=D.indexOf(_);if(F<0)return;const z=U==="up"?F-1:F+1;z<0||z>=D.length||([D[F],D[z]]=[D[z],D[F]],i(ce=>ce.map(fe=>fe.id===j?{...fe,entities:D}:fe)),await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:D})}))},[ie,ue]=h.useState(null),Pt=async(j,_)=>{if(!ie||ie.moduleId!==j){ue(null);return}const U=t.find(F=>F.id===j);if(!U)return;const O=[...U.entities],D=O.indexOf(ie.entityId);D<0||(O.splice(D,1),O.splice(_,0,ie.entityId),i(F=>F.map(z=>z.id===j?{...z,entities:O}:z)),ue(null),await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:O})}))},Rt=async()=>{const j=new URL("./",window.location.href).toString();try{const _=await un.toDataURL(j,{width:256,margin:2});x(_),N(!0)}catch(_){console.error("Failed to generate QR code:",_)}},Tt=async()=>{W(null);try{await I("/api/admin/change-password",{method:"POST",sessionId:s,body:JSON.stringify({currentPassword:X,newPassword:ne})}),W("Password changed!"),G(""),Y("")}catch(j){W(j instanceof Error?j.message:"Failed")}},Lt=async(j,_)=>{const U=t.find(D=>D.id===j);if(!U)return;const O=U.entities.filter(D=>D!==_);await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:O})}),H()};return u?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading dashboard..."})}):e.jsxs("div",{className:"admin-layout",children:[e.jsxs("header",{className:"admin-header",children:[e.jsxs("div",{className:"header-left",children:[b?e.jsxs("span",{className:"title-edit",children:[e.jsx("input",{className:"title-input",value:g,onChange:j=>m(j.target.value),onKeyDown:j=>{j.key==="Enter"&&qe(),j.key==="Escape"&&v(!1)},autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:qe,children:"âœ“"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>v(!1),children:"âœ•"})]}):e.jsx("h1",{className:"dashboard-title",onClick:le,title:"Click to edit",children:c}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("div",{className:"header-right",children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>E(!0),children:"ðŸ” Discover"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(!0),children:"ðŸ“¦ Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:Rt,children:"ðŸ“± QR Code"}),e.jsxs("div",{className:"settings-menu-wrap",ref:q,children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!A),children:"âš™ï¸"}),A&&e.jsxs("div",{className:"settings-dropdown",children:[e.jsxs("button",{onClick:()=>{S(!1),p(!0)},children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{onClick:()=>{S(!1),P(!0)},children:"Change Password"}),e.jsx("button",{onClick:()=>{S(!1),R(!0)},children:"Server Settings"}),e.jsx("button",{onClick:()=>{S(!1),n()},children:"Logout"})]})]})]})]}),e.jsx("main",{className:"admin-main",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No areas yet. Create areas to organize your entities."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>k(!0),children:"Create First Area"})]}):t.map(j=>{const _=j.entities.filter(U=>!a.has(U));return e.jsxs("section",{className:"module-section",children:[e.jsxs("div",{className:"module-header",children:[e.jsxs("h2",{children:[j.icon," ",j.name]}),e.jsxs("span",{className:"entity-count",children:[j.entities.length," entities"]})]}),e.jsxs("div",{className:"entity-grid",children:[_.map((U,O)=>{var D,F;return e.jsxs("div",{className:`entity-card-wrap admin-card${(ie==null?void 0:ie.entityId)===U?" dragging":""}`,draggable:!0,onDragStart:()=>ue({moduleId:j.id,entityId:U}),onDragOver:z=>z.preventDefault(),onDrop:()=>Pt(j.id,O),onDragEnd:()=>ue(null),children:[e.jsx(It,{entityId:U,showActions:!0,showAttributes:!0,onHide:()=>Fe(U),onGearClick:(z,ce)=>{Z(z),te(ce)},customName:(D=B[U])==null?void 0:D.custom_name,customIcon:(F=B[U])==null?void 0:F.custom_icon}),e.jsxs("div",{className:"entity-admin-actions",children:[e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>He(j.id,U,"up"),disabled:O===0,title:"Move up",children:"â†‘"}),e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>He(j.id,U,"down"),disabled:O===_.length-1,title:"Move down",children:"â†“"}),e.jsx("button",{type:"button",className:"remove-from-module-btn",onClick:()=>Lt(j.id,U),title:"Remove from area",children:"âœ•"})]})]},U)}),j.entities.length===0&&e.jsx("p",{className:"note",style:{gridColumn:"1 / -1"},children:"No entities in this area. Use Discover to add some."})]})]},j.id)})}),J&&K&&e.jsx(Ft,{entityId:J,friendlyName:J.split(".").slice(1).join(".").replace(/_/g," "),sessionId:s,anchorRect:K,onClose:()=>{Z(null),te(null)},onSave:()=>H(!0),onHide:()=>{Fe(J),Z(null),te(null)}}),M&&e.jsx(Ut,{sessionId:s,modules:t,onAssignEntity:At,onClose:()=>E(!1)}),L&&e.jsx(Ot,{sessionId:s,modules:t,onModulesChange:i,onClose:()=>{k(!1),H()}}),d&&e.jsx(vt,{sessionId:s,onClose:()=>R(!1)}),y&&e.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>p(!1),children:"Close"})]}),e.jsxs("ul",{className:"hidden-list",children:[Array.from(a).map(j=>e.jsxs("li",{children:[e.jsx("span",{className:"hidden-id",children:j}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>kt(j),children:"Unhide"})]},j)),a.size===0&&e.jsx("p",{className:"note",children:"No hidden entities."})]})]})}),w&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal qr-modal",onClick:j=>j.stopPropagation(),children:[e.jsx("h3",{children:"Guest Access QR Code"}),$&&e.jsx("img",{src:$,alt:"QR Code for guest access"}),e.jsx("p",{className:"note",children:"Scan this code to open the guest dashboard."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>N(!1),children:"Close"})]})}),T&&e.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:e.jsxs("div",{className:"modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Change Password"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!1),children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:X,onChange:j=>G(j.target.value)})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:ne,onChange:j=>Y(j.target.value)})]}),re&&e.jsx("p",{className:"note",children:re}),e.jsx("button",{type:"button",className:"action-button",onClick:Tt,children:"Change Password"})]})]})})]})}function hn({onLogin:s,error:o}){const[r,n]=h.useState(""),[t,i]=h.useState(!1),a=async l=>{l.preventDefault(),i(!0),await s(r),i(!1)};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Admin Login"}),e.jsxs("form",{className:"login-form",onSubmit:a,children:[e.jsx("input",{className:"login-input",type:"password",placeholder:"Admin password",value:r,onChange:l=>n(l.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"action-button",disabled:t,children:t?"Logging in...":"Login"})]}),o&&e.jsx("p",{className:"note error",children:o})]})}function fn(){const[s,o]=h.useState(()=>sessionStorage.getItem("admin_session")),[r,n]=h.useState(""),[t,i]=h.useState(""),[a,l]=h.useState(null),[c,f]=h.useState(!0);h.useEffect(()=>{(async()=>{const m=sessionStorage.getItem("admin_session");if(!m){f(!1);return}try{const u=await I("/api/admin/session",{sessionId:m});u.valid?(o(m),n(u.hassUrl),i(u.hassToken)):(sessionStorage.removeItem("admin_session"),o(null))}catch{sessionStorage.removeItem("admin_session"),o(null)}finally{f(!1)}})()},[]);const b=async g=>{l(null);try{const m=await I("/api/admin/login",{method:"POST",body:JSON.stringify({password:g})});m.success?(sessionStorage.setItem("admin_session",m.sessionId),o(m.sessionId),n(m.hassUrl),i(m.hassToken)):l("Invalid password")}catch(m){l(m instanceof Error?m.message:"Login failed")}},v=async()=>{if(s)try{await I("/api/admin/logout",{method:"POST",sessionId:s})}catch{}sessionStorage.removeItem("admin_session"),o(null),n(""),i("")};return c?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading..."})}):s?r?e.jsxs(Dt,{hassUrl:r,hassToken:t,loading:e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."})}),options:{renderError:()=>e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"LobbyHA Admin"}),e.jsxs("p",{className:"note error",style:{marginBottom:"1.5rem"},children:["Unable to connect to Home Assistant.",e.jsx("br",{}),"Update the settings below and save to reconnect."]}),e.jsx(vt,{sessionId:s,inline:!0,onSaved:()=>{setTimeout(()=>window.location.reload(),1500)}}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>window.location.reload(),children:"Retry Connection"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:v,children:"Logout"})]})]})},children:[e.jsx(_t,{}),e.jsx(mn,{sessionId:s,hassUrl:r,hassToken:t,onLogout:v})]}):e.jsx("div",{className:"container",children:e.jsxs("p",{className:"note",children:["Server not configured. ",e.jsx("a",{href:"/setup",children:"Run setup"})]})}):e.jsx(hn,{onLogin:b,error:a})}Mt.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(fn,{})}));
