import{r as t,a as b,j as e,c as I}from"./index-dtVNt39M.js";function F({existingConfig:d,reconfigure:o}={}){const[a,n]=t.useState("url"),[r,u]=t.useState(""),[i,A]=t.useState(""),[p,L]=t.useState(""),[N,E]=t.useState(""),[H,w]=t.useState(!1),[x,l]=t.useState(null),[C,f]=t.useState(!1),[R,g]=t.useState(!1),[h,T]=t.useState(!1),[c,y]=t.useState([]),[j,k]=t.useState(""),[v,S]=t.useState(!1);t.useEffect(()=>{if(d){d.HA_URL&&d.HA_URL!=="http://localhost:8123"?u(d.HA_URL):u("http://homeassistant.local:8123"),g(!0);return}b("/api/setup/status").then(s=>{var m;(m=s.config)!=null&&m.HA_URL&&s.config.HA_URL!=="http://localhost:8123"?u(s.config.HA_URL):u("http://homeassistant.local:8123"),g(!0)}).catch(()=>{u("http://homeassistant.local:8123"),g(!0)})},[d]);const P=async()=>{w(!0),l(null);try{const s=await b("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:r,haToken:i})});s.success?n(o?"done-reconfig":"password"):l(s.error||"Connection failed")}catch(s){l(s instanceof Error?s.message:"Connection test failed")}finally{w(!1)}},U=async()=>{if(!o){if(p!==N){l("Passwords do not match");return}if(p.length<4){l("Password must be at least 4 characters");return}}f(!0),l(null);try{await b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:r,haToken:i,adminPassword:o?void 0:p,pinEnabled:h||void 0,pins:h&&c.length>0?c:void 0})}),n("done")}catch(s){l(s instanceof Error?s.message:"Setup failed")}finally{f(!1)}};return t.useEffect(()=>{a==="done-reconfig"&&(f(!0),b("/api/setup/configure",{method:"POST",body:JSON.stringify({haUrl:r,haToken:i})}).then(()=>{n("done")}).catch(s=>{l(s instanceof Error?s.message:"Setup failed"),n("token")}).finally(()=>f(!1)))},[a,r,i]),R?e.jsx("div",{className:"setup-wizard",children:e.jsxs("div",{className:"setup-card",children:[e.jsx("h1",{className:"setup-title",children:o?"Reconfigure LobbyHA":"LobbyHA Setup"}),e.jsx("div",{className:"setup-progress",children:(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).map((s,m)=>e.jsxs("div",{className:`setup-step ${s===a?"active":""} ${(o?["url","token","test","done"]:["url","token","test","password","pin","done"]).indexOf(a)>m?"completed":""}`,children:[e.jsx("div",{className:"step-dot",children:m+1}),e.jsx("span",{className:"step-label",children:s==="url"?"URL":s==="token"?"Token":s==="test"?"Test":s==="password"?"Password":s==="pin"?"PIN":"Done"})]},s))}),a==="url"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Home Assistant URL"}),e.jsx("p",{children:o?"Update your Home Assistant URL.":"Enter the URL of your Home Assistant instance."}),e.jsx("input",{className:"setup-input",value:r,onChange:s=>u(s.target.value),placeholder:"http://homeassistant.local:8123",autoFocus:!0}),e.jsx("p",{className:"note",children:"Usually http://homeassistant.local:8123 or your HA IP address."}),e.jsx("div",{className:"setup-actions",children:e.jsx("button",{type:"button",className:"action-button",onClick:()=>n("token"),disabled:!r.trim(),children:"Next â†’"})})]}),a==="token"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Access Token"}),o?e.jsx("p",{children:"Enter a new token or paste the existing one to re-verify."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Create a Long-Lived Access Token in Home Assistant:"}),e.jsxs("ol",{className:"setup-instructions",children:[e.jsx("li",{children:"Go to your HA Profile (click your name in the sidebar)"}),e.jsx("li",{children:'Scroll to "Long-Lived Access Tokens"'}),e.jsx("li",{children:'Click "Create Token"'}),e.jsx("li",{children:'Name it "LobbyHA" and copy the token'})]})]}),e.jsx("input",{className:"setup-input",type:"password",value:i,onChange:s=>A(s.target.value),placeholder:"Paste your token here",autoFocus:!0}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("url"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{n("test"),P()},disabled:!i.trim(),children:"Test Connection â†’"})]})]}),a==="test"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Testing Connection"}),H?e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."}):x?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:P,children:"Retry"})]})]}):null]}),a==="password"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Set Admin Password"}),e.jsx("p",{children:"Connection successful! Now set your admin password."}),e.jsx("input",{className:"setup-input",type:"password",value:p,onChange:s=>L(s.target.value),placeholder:"Admin password",autoFocus:!0}),e.jsx("input",{className:"setup-input",type:"password",value:N,onChange:s=>E(s.target.value),placeholder:"Confirm password"}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("token"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{l(null),n("pin")},disabled:!p||!N||p!==N||p.length<4,children:"Next â†’"})]})]}),a==="pin"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"ðŸ”’ Guest PIN Access"}),e.jsx("p",{children:"Control who can see your guest dashboard. When enabled, guests must enter a PIN before they can view any controls."}),e.jsxs("div",{className:"pin-setup-card",children:[e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>T(s.target.checked)}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest access"}),e.jsx("span",{className:"pin-toggle-hint",children:h?"âœ“ Enabled":"Disabled"})]}),h&&e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("ul",{className:"pin-list",style:{marginBottom:"0.75rem"},children:c.map(s=>e.jsxs("li",{children:[e.jsx("span",{children:s.pin}),s.permanent&&e.jsx("span",{className:"pin-badge permanent",children:"permanent"}),!s.permanent&&e.jsx("span",{className:"pin-badge expiring",children:"7-day"}),e.jsx("button",{type:"button",onClick:()=>y(c.filter(m=>m.pin!==s.pin)),children:"âœ•"})]},s.pin))}),e.jsxs("div",{className:"pin-add-row",style:{marginBottom:"0.75rem"},children:[e.jsx("input",{value:j,onChange:s=>k(s.target.value),onKeyDown:s=>{s.key==="Enter"&&j.trim()&&(y([...c,{pin:j.trim(),permanent:v}]),k(""),S(!1))},placeholder:"Enter a PIN (e.g. 1234)",autoFocus:!0}),e.jsxs("label",{className:"pin-permanent-toggle",title:"Permanent PINs never expire",children:[e.jsx("input",{type:"checkbox",checked:v,onChange:s=>S(s.target.checked)}),e.jsx("span",{children:"Permanent"})]}),e.jsx("button",{type:"button",onClick:()=>{j.trim()&&(y([...c,{pin:j.trim(),permanent:v}]),k(""),S(!1))},disabled:!j.trim(),children:"Add"})]}),c.length===0&&e.jsx("p",{className:"note error",style:{fontSize:"0.85rem"},children:"Add at least one PIN or disable PIN access."}),c.length>0&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0"},children:"ðŸ’¡ You can add multiple PINs â€” e.g. one per guest or group. Non-permanent PINs expire after 7 days."})]}),!h&&e.jsx("p",{className:"note",style:{fontSize:"0.82rem",color:"#8a9bc0",marginTop:"-0.5rem"},children:"Anyone with the URL can access the guest dashboard. You can enable this later in Settings."})]}),x&&e.jsx("p",{className:"note error",children:x}),e.jsxs("div",{className:"setup-actions",children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>n("password"),children:"â† Back"}),e.jsx("button",{type:"button",className:"action-button",onClick:U,disabled:C||h&&c.length===0,children:C?"Setting up...":"Complete Setup"})]})]}),a==="done"&&e.jsxs("div",{className:"setup-step-content",children:[e.jsx("h2",{children:"Setup Complete! ðŸŽ‰"}),e.jsx("p",{children:"Your LobbyHA dashboard is ready."}),e.jsx("div",{className:"setup-actions",children:e.jsx("a",{href:"/admin",className:"action-button",children:"Open Admin Dashboard â†’"})})]})]})}):e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading configuration..."})})}function O(){const[d,o]=t.useState(null),[a,n]=t.useState(),[r,u]=t.useState(!1);return t.useEffect(()=>{b("/api/setup/status").then(i=>{o(i.needsSetup),i.config&&n(i.config)}).catch(()=>o(!0))},[]),d===null?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Checking setup status..."})}):!d&&!r?e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Already Configured"}),e.jsx("p",{className:"note",children:"Your LobbyHA dashboard is already set up."}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("a",{href:"/admin",className:"action-button",children:"Admin Dashboard"}),e.jsx("a",{href:"/",className:"action-button secondary",children:"Guest Dashboard"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:()=>u(!0),children:"Reconfigure"})]})]}):e.jsx(F,{existingConfig:a,reconfigure:r})}I.createRoot(document.getElementById("root")).render(e.jsx(t.StrictMode,{children:e.jsx(O,{})}));
