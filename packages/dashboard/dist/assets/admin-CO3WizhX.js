import{r as C,a as D,j as n,g as Ct,c as vt}from"./index-D630IaMI.js";import{d as Ue,E as Et,h as St,e as xt}from"./EntityCard-CZPAd1EA.js";function jt({sessionId:s,modules:r,onAssignEntity:a,onClose:i}){const[e,t]=C.useState([]),[o,l]=C.useState([]),[c,g]=C.useState([]),[y,v]=C.useState(!0),[w,h]=C.useState(""),[E,R]=C.useState(null),[M,P]=C.useState(!1),k=C.useMemo(()=>{const u=new Map;return r.forEach(L=>L.entities.forEach(f=>u.set(f,L.id))),u},[r]),j=C.useCallback(async(u=!1)=>{u?P(!0):v(!0);try{const d=await D(u?"/api/discovery/refresh":"/api/discovery/entities",u?{method:"POST",sessionId:s}:{sessionId:s});l(d.entities),t(d.entities),g(d.domains.map(m=>({domain:m.domain,label:m.label,count:m.entities.length})))}catch{}finally{v(!1),P(!1)}},[s]);return C.useEffect(()=>{j()},[j]),C.useEffect(()=>{let u=o;if(E&&(u=u.filter(L=>L.domain===E)),w){const L=w.toLowerCase();u=u.filter(f=>{var d;return f.entity_id.toLowerCase().includes(L)||f.name.toLowerCase().includes(L)||(((d=f.area)==null?void 0:d.toLowerCase().includes(L))??!1)})}t(u)},[o,w,E]),n.jsx("div",{className:"modal-overlay",onClick:i,children:n.jsxs("div",{className:"modal",style:{maxWidth:"700px"},onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:["Discover Entities (",o.length," total)"]}),n.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),n.jsxs("div",{className:"discovery-search",children:[n.jsx("input",{type:"text",placeholder:"Search entities...",value:w,onChange:u=>h(u.target.value),autoFocus:!0}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>j(!0),disabled:M,children:M?"Refreshing...":"ðŸ”„ Refresh"})]}),n.jsxs("div",{className:"domain-filter",children:[n.jsxs("button",{type:"button",className:`domain-chip ${E===null?"active":""}`,onClick:()=>R(null),children:["All (",o.length,")"]}),c.length===0&&!y&&n.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)",alignSelf:"center"},children:"No entity types found"}),c.map(u=>n.jsxs("button",{type:"button",className:`domain-chip ${E===u.domain?"active":""}`,onClick:()=>R(E===u.domain?null:u.domain),children:[Ue(u.domain)," ",u.label," (",u.count,")"]},u.domain))]}),y?n.jsx("p",{className:"note",children:"Loading entities..."}):n.jsxs("ul",{className:"discovery-entity-list",children:[e.map(u=>{const L=k.get(u.entity_id),f=L!==void 0;return n.jsxs("li",{className:`discovery-entity-item ${f?"on-dashboard":""}`,children:[n.jsxs("div",{children:[n.jsxs("div",{className:"discovery-entity-name",children:[Ue(u.domain)," ",u.name]}),n.jsx("div",{className:"discovery-entity-id",children:u.entity_id})]}),n.jsx("span",{className:"discovery-entity-state",children:u.state}),n.jsxs("select",{className:"discovery-area-select",value:L??"",onChange:d=>{const m=d.target.value;a(u.entity_id,m===""?null:Number(m))},children:[n.jsx("option",{value:"",children:"â€” None â€”"}),r.map(d=>n.jsxs("option",{value:d.id,children:[d.icon," ",d.name]},d.id))]})]},u.entity_id)}),e.length===0&&n.jsx("p",{className:"note",children:"No entities found matching your criteria."})]})]})})}function At({sessionId:s,modules:r,onModulesChange:a,onClose:i}){const[e,t]=C.useState(""),[o,l]=C.useState("ðŸ "),[c,g]=C.useState(null),[y,v]=C.useState(""),[w,h]=C.useState(""),E=C.useCallback(async()=>{const u=await D("/api/ui/modules",{sessionId:s});a(u.modules)},[s,a]),R=async()=>{e.trim()&&(await D("/api/ui/modules",{method:"POST",sessionId:s,body:JSON.stringify({name:e.trim(),icon:o})}),t(""),l("ðŸ "),E())},M=async u=>{await D(`/api/ui/modules/${u}`,{method:"PUT",sessionId:s,body:JSON.stringify({name:y,icon:w})}),g(null),E()},P=async u=>{confirm("Delete this area and remove all entity assignments?")&&(await D(`/api/ui/modules/${u}`,{method:"DELETE",sessionId:s}),E())},k=async u=>{await D(`/api/ui/modules/${u.id}`,{method:"PUT",sessionId:s,body:JSON.stringify({visible:!u.visible})}),E()},j=async(u,L)=>{const f=r.findIndex(p=>p.id===u);if(f<0)return;const d=[...r.map(p=>p.id)],m=L==="up"?f-1:f+1;m<0||m>=d.length||([d[f],d[m]]=[d[m],d[f]],await D("/api/ui/modules/reorder",{method:"POST",sessionId:s,body:JSON.stringify({moduleIds:d})}),E())};return n.jsx("div",{className:"modal-overlay",onClick:i,children:n.jsxs("div",{className:"modal",style:{maxWidth:"550px"},onClick:u=>u.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Manage Areas"}),n.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),n.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[n.jsx("input",{style:{width:"3rem",textAlign:"center"},value:o,onChange:u=>l(u.target.value),placeholder:"ðŸ "}),n.jsx("input",{style:{flex:1},value:e,onChange:u=>t(u.target.value),placeholder:"Area name...",onKeyDown:u=>u.key==="Enter"&&R()}),n.jsx("button",{type:"button",className:"action-button",onClick:R,children:"Add"})]}),n.jsxs("ul",{className:"hidden-list",children:[r.map((u,L)=>n.jsx("li",{children:c===u.id?n.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:1,alignItems:"center"},children:[n.jsx("input",{style:{width:"3rem",textAlign:"center"},value:w,onChange:f=>h(f.target.value)}),n.jsx("input",{style:{flex:1},value:y,onChange:f=>v(f.target.value),onKeyDown:f=>f.key==="Enter"&&M(u.id),autoFocus:!0}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>M(u.id),children:"âœ“"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>g(null),children:"âœ•"})]}):n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsxs("div",{className:"hidden-name",children:[u.icon," ",u.name]}),n.jsxs("div",{className:"hidden-id",children:[u.entities.length," entities Â· ",u.visible?"visible":"hidden"]})]}),n.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[n.jsx("button",{type:"button",className:"action-button",onClick:()=>j(u.id,"up"),disabled:L===0,children:"â†‘"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>j(u.id,"down"),disabled:L===r.length-1,children:"â†“"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>k(u),children:u.visible?"ðŸ‘":"ðŸ‘â€ðŸ—¨"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>{g(u.id),v(u.name),h(u.icon)},children:"âœï¸"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>P(u.id),children:"ðŸ—‘"})]})]})},u.id)),r.length===0&&n.jsx("p",{className:"note",children:"No areas yet. Create one above to organize your entities."})]})]})})}function ht({sessionId:s,onClose:r,inline:a,onSaved:i}){const[e,t]=C.useState(""),[o,l]=C.useState("â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"),[c,g]=C.useState(""),[y,v]=C.useState("INFO"),[w,h]=C.useState(""),[E,R]=C.useState(!1),[M,P]=C.useState(!1),[k,j]=C.useState(!1),[u,L]=C.useState([]),[f,d]=C.useState(null),[m,p]=C.useState(!1),[x,S]=C.useState([]),[T,A]=C.useState(""),[B,z]=C.useState(!1),[K,te]=C.useState(!1);k||D("/api/admin/config",{sessionId:s}).then(N=>{N.success&&(t(N.config.HA_URL||""),l(N.config.HA_TOKEN||""),g(N.config.PORT||"3000"),v(N.config.LOG_LEVEL||"INFO"),h(N.config.ALLOWED_ENTITIES||""),L(N.missing||[])),j(!0)}).catch(()=>j(!0)),B||D("/api/guest/settings",{sessionId:s}).then(N=>{p(N.pinEnabled),S(N.pins),z(!0)}).catch(()=>z(!0));const J=N=>u.includes(N),ne=async()=>{P(!0),d(null);try{const F=await D("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:e,haToken:(o==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"?"":o)||void 0})});F.success?d({type:"success",message:"Connection successful!"}):d({type:"error",message:F.error||"Connection failed"})}catch(N){d({type:"error",message:N instanceof Error?N.message:"Test failed"})}finally{P(!1)}},X=async()=>{if(!e.trim()){d({type:"error",message:"Home Assistant URL is required"});return}if(!o.trim()||o==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"&&J("HA_TOKEN")){d({type:"error",message:"Access token is required. Please enter your HA long-lived token."});return}R(!0),d(null);try{await D("/api/admin/config",{method:"POST",sessionId:s,body:JSON.stringify({haUrl:e,haToken:o==="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"?void 0:o,port:c,logLevel:y,allowedEntities:w})}),L(N=>N.filter(O=>O==="HA_URL"&&!e.trim()||O==="HA_TOKEN"&&!o.trim())),d({type:"success",message:"Settings saved! Reload to apply."}),i==null||i()}catch(N){d({type:"error",message:N instanceof Error?N.message:"Failed to save"})}finally{R(!1)}},Y=async(N,O)=>{te(!0);try{const F=await D("/api/guest/settings",{method:"POST",sessionId:s,body:JSON.stringify({pinEnabled:N,pins:O})});p(F.pinEnabled),S(F.pins)}catch{}finally{te(!1)}},$=()=>{const N=!m;p(N),Y(N,x)},V=()=>{const N=T.trim();if(!N||x.includes(N))return;const O=[...x,N];S(O),A(""),Y(m,O)},ae=N=>{const O=x.filter(F=>F!==N);S(O),Y(m,O)},Z=u.length>0,ie=n.jsxs("div",{className:a?"":"modal settings-modal",onClick:N=>N.stopPropagation(),children:[!a&&n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Settings"}),n.jsx("button",{type:"button",className:"action-button",onClick:r,children:"Close"})]}),n.jsxs("div",{className:"settings-form",children:[n.jsxs("div",{className:"settings-section",children:[n.jsx("h3",{children:"ðŸ”’ Guest PIN Access"}),n.jsxs("label",{className:"pin-toggle-switch",children:[n.jsx("input",{type:"checkbox",checked:m,onChange:$,disabled:K}),n.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest dashboard"}),n.jsx("span",{className:"pin-toggle-hint",children:m?"Enabled":"Disabled"})]}),m&&n.jsxs(n.Fragment,{children:[n.jsxs("label",{style:{fontSize:"0.85rem",color:"#8a9bc0",display:"block",marginBottom:"0.5rem"},children:["Allowed PINs (",x.length,")"]}),x.length>0&&n.jsx("ul",{className:"pin-list",children:x.map(N=>n.jsxs("li",{children:[n.jsx("span",{children:N}),n.jsx("button",{type:"button",onClick:()=>ae(N),title:"Remove PIN",disabled:K,children:"âœ•"})]},N))}),n.jsxs("div",{className:"pin-add-row",children:[n.jsx("input",{value:T,onChange:N=>A(N.target.value),onKeyDown:N=>{N.key==="Enter"&&V()},placeholder:"Enter new PIN",disabled:K}),n.jsx("button",{type:"button",onClick:V,disabled:K||!T.trim(),children:"Add"})]}),m&&x.length===0&&n.jsx("p",{className:"note error",style:{marginTop:"0.5rem",fontSize:"0.85rem"},children:"âš  PIN is enabled but no PINs are set. Guests won't be able to access the dashboard."})]})]}),n.jsxs("div",{className:"settings-section",children:[n.jsx("h3",{children:"ðŸŒ Server Connection"}),Z&&n.jsx("p",{className:"note error",style:{marginBottom:"0.75rem"},children:"Required settings are missing. Please fill in the highlighted fields."}),n.jsxs("div",{className:`form-field${J("HA_URL")?" field-missing":""}`,children:[n.jsxs("label",{children:["Home Assistant URL",J("HA_URL")&&n.jsx("span",{className:"required-badge",children:"required"})]}),n.jsx("input",{value:e,onChange:N=>t(N.target.value),placeholder:"http://homeassistant.local:8123"}),J("HA_URL")&&n.jsx("span",{className:"field-hint",children:"Enter your Home Assistant URL (e.g. http://192.168.1.x:8123)"})]}),n.jsxs("div",{className:`form-field${J("HA_TOKEN")?" field-missing":""}`,children:[n.jsxs("label",{children:["Long-Lived Access Token",J("HA_TOKEN")&&n.jsx("span",{className:"required-badge",children:"required"})]}),n.jsx("input",{value:o,onChange:N=>l(N.target.value),type:"password",placeholder:J("HA_TOKEN")?"Paste your HA token here":""}),J("HA_TOKEN")&&n.jsx("span",{className:"field-hint",children:"Create a token in HA â†’ Profile â†’ Long-Lived Access Tokens â†’ Create Token"})]}),f&&n.jsx("p",{className:`note ${f.type}`,children:f.message}),n.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[n.jsx("button",{type:"button",className:"action-button secondary",onClick:ne,disabled:M||!e,children:M?"Testing...":"Test Connection"}),n.jsx("button",{type:"button",className:"action-button",onClick:X,disabled:E,children:E?"Saving...":Z?"Save & Configure":"Save Settings"})]})]}),n.jsxs("div",{className:"settings-section",children:[n.jsx("h3",{children:"âš¡ Advanced"}),n.jsxs("div",{className:"form-field",children:[n.jsx("label",{children:"Server Port"}),n.jsx("input",{value:c,onChange:N=>g(N.target.value),placeholder:"3000"})]}),n.jsxs("div",{className:"form-field",children:[n.jsx("label",{children:"Log Level"}),n.jsxs("select",{value:y,onChange:N=>v(N.target.value),children:[n.jsx("option",{value:"DEBUG",children:"DEBUG"}),n.jsx("option",{value:"INFO",children:"INFO"}),n.jsx("option",{value:"WARNING",children:"WARNING"}),n.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),n.jsxs("div",{className:"form-field",children:[n.jsxs("label",{children:["Allowed Entities ",n.jsx("span",{style:{fontWeight:400,opacity:.7},children:"(optional, comma-separated)"})]}),n.jsx("input",{value:w,onChange:N=>h(N.target.value),placeholder:"light.living_room, switch.bedroom (leave empty for all)"}),n.jsx("span",{className:"field-hint",children:"Limit which entities are exposed. Leave empty to allow all."})]})]})]})]});return a?ie:n.jsx("div",{className:"modal-overlay",onClick:r,children:ie})}var oe={},fe,_e;function Pt(){return _e||(_e=1,fe=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),fe}var ge={},ee={},qe;function se(){if(qe)return ee;qe=1;let s;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return ee.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},ee.getSymbolTotalCodewords=function(i){return r[i]},ee.getBCHDigit=function(a){let i=0;for(;a!==0;)i++,a>>>=1;return i},ee.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');s=i},ee.isKanjiModeEnabled=function(){return typeof s<"u"},ee.toSJIS=function(i){return s(i)},ee}var me={},Oe;function De(){return Oe||(Oe=1,(function(s){s.L={bit:1},s.M={bit:0},s.Q={bit:3},s.H={bit:2};function r(a){if(typeof a!="string")throw new Error("Param is not a string");switch(a.toLowerCase()){case"l":case"low":return s.L;case"m":case"medium":return s.M;case"q":case"quartile":return s.Q;case"h":case"high":return s.H;default:throw new Error("Unknown EC Level: "+a)}}s.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},s.from=function(i,e){if(s.isValid(i))return i;try{return r(i)}catch{return e}}})(me)),me}var pe,Fe;function Tt(){if(Fe)return pe;Fe=1;function s(){this.buffer=[],this.length=0}return s.prototype={get:function(r){const a=Math.floor(r/8);return(this.buffer[a]>>>7-r%8&1)===1},put:function(r,a){for(let i=0;i<a;i++)this.putBit((r>>>a-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(r){const a=Math.floor(this.length/8);this.buffer.length<=a&&this.buffer.push(0),r&&(this.buffer[a]|=128>>>this.length%8),this.length++}},pe=s,pe}var ye,He;function Rt(){if(He)return ye;He=1;function s(r){if(!r||r<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=r,this.data=new Uint8Array(r*r),this.reservedBit=new Uint8Array(r*r)}return s.prototype.set=function(r,a,i,e){const t=r*this.size+a;this.data[t]=i,e&&(this.reservedBit[t]=!0)},s.prototype.get=function(r,a){return this.data[r*this.size+a]},s.prototype.xor=function(r,a,i){this.data[r*this.size+a]^=i},s.prototype.isReserved=function(r,a){return this.reservedBit[r*this.size+a]},ye=s,ye}var we={},ze;function Bt(){return ze||(ze=1,(function(s){const r=se().getSymbolSize;s.getRowColCoords=function(i){if(i===1)return[];const e=Math.floor(i/7)+2,t=r(i),o=t===145?26:Math.ceil((t-13)/(2*e-2))*2,l=[t-7];for(let c=1;c<e-1;c++)l[c]=l[c-1]-o;return l.push(6),l.reverse()},s.getPositions=function(i){const e=[],t=s.getRowColCoords(i),o=t.length;for(let l=0;l<o;l++)for(let c=0;c<o;c++)l===0&&c===0||l===0&&c===o-1||l===o-1&&c===0||e.push([t[l],t[c]]);return e}})(we)),we}var be={},Je;function kt(){if(Je)return be;Je=1;const s=se().getSymbolSize,r=7;return be.getPositions=function(i){const e=s(i);return[[0,0],[e-r,0],[0,e-r]]},be}var Ne={},Ke;function Lt(){return Ke||(Ke=1,(function(s){s.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const r={N1:3,N2:3,N3:40,N4:10};s.isValid=function(e){return e!=null&&e!==""&&!isNaN(e)&&e>=0&&e<=7},s.from=function(e){return s.isValid(e)?parseInt(e,10):void 0},s.getPenaltyN1=function(e){const t=e.size;let o=0,l=0,c=0,g=null,y=null;for(let v=0;v<t;v++){l=c=0,g=y=null;for(let w=0;w<t;w++){let h=e.get(v,w);h===g?l++:(l>=5&&(o+=r.N1+(l-5)),g=h,l=1),h=e.get(w,v),h===y?c++:(c>=5&&(o+=r.N1+(c-5)),y=h,c=1)}l>=5&&(o+=r.N1+(l-5)),c>=5&&(o+=r.N1+(c-5))}return o},s.getPenaltyN2=function(e){const t=e.size;let o=0;for(let l=0;l<t-1;l++)for(let c=0;c<t-1;c++){const g=e.get(l,c)+e.get(l,c+1)+e.get(l+1,c)+e.get(l+1,c+1);(g===4||g===0)&&o++}return o*r.N2},s.getPenaltyN3=function(e){const t=e.size;let o=0,l=0,c=0;for(let g=0;g<t;g++){l=c=0;for(let y=0;y<t;y++)l=l<<1&2047|e.get(g,y),y>=10&&(l===1488||l===93)&&o++,c=c<<1&2047|e.get(y,g),y>=10&&(c===1488||c===93)&&o++}return o*r.N3},s.getPenaltyN4=function(e){let t=0;const o=e.data.length;for(let c=0;c<o;c++)t+=e.data[c];return Math.abs(Math.ceil(t*100/o/5)-10)*r.N4};function a(i,e,t){switch(i){case s.Patterns.PATTERN000:return(e+t)%2===0;case s.Patterns.PATTERN001:return e%2===0;case s.Patterns.PATTERN010:return t%3===0;case s.Patterns.PATTERN011:return(e+t)%3===0;case s.Patterns.PATTERN100:return(Math.floor(e/2)+Math.floor(t/3))%2===0;case s.Patterns.PATTERN101:return e*t%2+e*t%3===0;case s.Patterns.PATTERN110:return(e*t%2+e*t%3)%2===0;case s.Patterns.PATTERN111:return(e*t%3+(e+t)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}s.applyMask=function(e,t){const o=t.size;for(let l=0;l<o;l++)for(let c=0;c<o;c++)t.isReserved(c,l)||t.xor(c,l,a(e,c,l))},s.getBestMask=function(e,t){const o=Object.keys(s.Patterns).length;let l=0,c=1/0;for(let g=0;g<o;g++){t(g),s.applyMask(g,e);const y=s.getPenaltyN1(e)+s.getPenaltyN2(e)+s.getPenaltyN3(e)+s.getPenaltyN4(e);s.applyMask(g,e),y<c&&(c=y,l=g)}return l}})(Ne)),Ne}var ue={},Ve;function ft(){if(Ve)return ue;Ve=1;const s=De(),r=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],a=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ue.getBlocksCount=function(e,t){switch(t){case s.L:return r[(e-1)*4+0];case s.M:return r[(e-1)*4+1];case s.Q:return r[(e-1)*4+2];case s.H:return r[(e-1)*4+3];default:return}},ue.getTotalCodewordsCount=function(e,t){switch(t){case s.L:return a[(e-1)*4+0];case s.M:return a[(e-1)*4+1];case s.Q:return a[(e-1)*4+2];case s.H:return a[(e-1)*4+3];default:return}},ue}var Ce={},le={},Qe;function Mt(){if(Qe)return le;Qe=1;const s=new Uint8Array(512),r=new Uint8Array(256);return(function(){let i=1;for(let e=0;e<255;e++)s[e]=i,r[i]=e,i<<=1,i&256&&(i^=285);for(let e=255;e<512;e++)s[e]=s[e-255]})(),le.log=function(i){if(i<1)throw new Error("log("+i+")");return r[i]},le.exp=function(i){return s[i]},le.mul=function(i,e){return i===0||e===0?0:s[r[i]+r[e]]},le}var Ge;function It(){return Ge||(Ge=1,(function(s){const r=Mt();s.mul=function(i,e){const t=new Uint8Array(i.length+e.length-1);for(let o=0;o<i.length;o++)for(let l=0;l<e.length;l++)t[o+l]^=r.mul(i[o],e[l]);return t},s.mod=function(i,e){let t=new Uint8Array(i);for(;t.length-e.length>=0;){const o=t[0];for(let c=0;c<e.length;c++)t[c]^=r.mul(e[c],o);let l=0;for(;l<t.length&&t[l]===0;)l++;t=t.slice(l)}return t},s.generateECPolynomial=function(i){let e=new Uint8Array([1]);for(let t=0;t<i;t++)e=s.mul(e,new Uint8Array([1,r.exp(t)]));return e}})(Ce)),Ce}var ve,Ye;function Dt(){if(Ye)return ve;Ye=1;const s=It();function r(a){this.genPoly=void 0,this.degree=a,this.degree&&this.initialize(this.degree)}return r.prototype.initialize=function(i){this.degree=i,this.genPoly=s.generateECPolynomial(this.degree)},r.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(i.length+this.degree);e.set(i);const t=s.mod(e,this.genPoly),o=this.degree-t.length;if(o>0){const l=new Uint8Array(this.degree);return l.set(t,o),l}return t},ve=r,ve}var Ee={},Se={},xe={},We;function gt(){return We||(We=1,xe.isValid=function(r){return!isNaN(r)&&r>=1&&r<=40}),xe}var W={},Ze;function mt(){if(Ze)return W;Ze=1;const s="[0-9]+",r="[A-Z $%*+\\-./:]+";let a="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";a=a.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+a+`)(?:.|[\r
]))+`;W.KANJI=new RegExp(a,"g"),W.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),W.BYTE=new RegExp(i,"g"),W.NUMERIC=new RegExp(s,"g"),W.ALPHANUMERIC=new RegExp(r,"g");const e=new RegExp("^"+a+"$"),t=new RegExp("^"+s+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return W.testKanji=function(c){return e.test(c)},W.testNumeric=function(c){return t.test(c)},W.testAlphanumeric=function(c){return o.test(c)},W}var Xe;function re(){return Xe||(Xe=1,(function(s){const r=gt(),a=mt();s.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},s.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},s.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},s.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},s.MIXED={bit:-1},s.getCharCountIndicator=function(t,o){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!r.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?t.ccBits[0]:o<27?t.ccBits[1]:t.ccBits[2]},s.getBestModeForData=function(t){return a.testNumeric(t)?s.NUMERIC:a.testAlphanumeric(t)?s.ALPHANUMERIC:a.testKanji(t)?s.KANJI:s.BYTE},s.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")},s.isValid=function(t){return t&&t.bit&&t.ccBits};function i(e){if(typeof e!="string")throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return s.NUMERIC;case"alphanumeric":return s.ALPHANUMERIC;case"kanji":return s.KANJI;case"byte":return s.BYTE;default:throw new Error("Unknown mode: "+e)}}s.from=function(t,o){if(s.isValid(t))return t;try{return i(t)}catch{return o}}})(Se)),Se}var $e;function Ut(){return $e||($e=1,(function(s){const r=se(),a=ft(),i=De(),e=re(),t=gt(),o=7973,l=r.getBCHDigit(o);function c(w,h,E){for(let R=1;R<=40;R++)if(h<=s.getCapacity(R,E,w))return R}function g(w,h){return e.getCharCountIndicator(w,h)+4}function y(w,h){let E=0;return w.forEach(function(R){const M=g(R.mode,h);E+=M+R.getBitsLength()}),E}function v(w,h){for(let E=1;E<=40;E++)if(y(w,E)<=s.getCapacity(E,h,e.MIXED))return E}s.from=function(h,E){return t.isValid(h)?parseInt(h,10):E},s.getCapacity=function(h,E,R){if(!t.isValid(h))throw new Error("Invalid QR Code version");typeof R>"u"&&(R=e.BYTE);const M=r.getSymbolTotalCodewords(h),P=a.getTotalCodewordsCount(h,E),k=(M-P)*8;if(R===e.MIXED)return k;const j=k-g(R,h);switch(R){case e.NUMERIC:return Math.floor(j/10*3);case e.ALPHANUMERIC:return Math.floor(j/11*2);case e.KANJI:return Math.floor(j/13);case e.BYTE:default:return Math.floor(j/8)}},s.getBestVersionForData=function(h,E){let R;const M=i.from(E,i.M);if(Array.isArray(h)){if(h.length>1)return v(h,M);if(h.length===0)return 1;R=h[0]}else R=h;return c(R.mode,R.getLength(),M)},s.getEncodedBits=function(h){if(!t.isValid(h)||h<7)throw new Error("Invalid QR Code version");let E=h<<12;for(;r.getBCHDigit(E)-l>=0;)E^=o<<r.getBCHDigit(E)-l;return h<<12|E}})(Ee)),Ee}var je={},et;function _t(){if(et)return je;et=1;const s=se(),r=1335,a=21522,i=s.getBCHDigit(r);return je.getEncodedBits=function(t,o){const l=t.bit<<3|o;let c=l<<10;for(;s.getBCHDigit(c)-i>=0;)c^=r<<s.getBCHDigit(c)-i;return(l<<10|c)^a},je}var Ae={},Pe,tt;function qt(){if(tt)return Pe;tt=1;const s=re();function r(a){this.mode=s.NUMERIC,this.data=a.toString()}return r.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(i){let e,t,o;for(e=0;e+3<=this.data.length;e+=3)t=this.data.substr(e,3),o=parseInt(t,10),i.put(o,10);const l=this.data.length-e;l>0&&(t=this.data.substr(e),o=parseInt(t,10),i.put(o,l*3+1))},Pe=r,Pe}var Te,nt;function Ot(){if(nt)return Te;nt=1;const s=re(),r=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function a(i){this.mode=s.ALPHANUMERIC,this.data=i}return a.getBitsLength=function(e){return 11*Math.floor(e/2)+6*(e%2)},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let o=r.indexOf(this.data[t])*45;o+=r.indexOf(this.data[t+1]),e.put(o,11)}this.data.length%2&&e.put(r.indexOf(this.data[t]),6)},Te=a,Te}var Re,it;function Ft(){if(it)return Re;it=1;const s=re();function r(a){this.mode=s.BYTE,typeof a=="string"?this.data=new TextEncoder().encode(a):this.data=new Uint8Array(a)}return r.getBitsLength=function(i){return i*8},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(a){for(let i=0,e=this.data.length;i<e;i++)a.put(this.data[i],8)},Re=r,Re}var Be,st;function Ht(){if(st)return Be;st=1;const s=re(),r=se();function a(i){this.mode=s.KANJI,this.data=i}return a.getBitsLength=function(e){return e*13},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(i){let e;for(e=0;e<this.data.length;e++){let t=r.toSJIS(this.data[e]);if(t>=33088&&t<=40956)t-=33088;else if(t>=57408&&t<=60351)t-=49472;else throw new Error("Invalid SJIS character: "+this.data[e]+`
Make sure your charset is UTF-8`);t=(t>>>8&255)*192+(t&255),i.put(t,13)}},Be=a,Be}var ke={exports:{}},rt;function zt(){return rt||(rt=1,(function(s){var r={single_source_shortest_paths:function(a,i,e){var t={},o={};o[i]=0;var l=r.PriorityQueue.make();l.push(i,0);for(var c,g,y,v,w,h,E,R,M;!l.empty();){c=l.pop(),g=c.value,v=c.cost,w=a[g]||{};for(y in w)w.hasOwnProperty(y)&&(h=w[y],E=v+h,R=o[y],M=typeof o[y]>"u",(M||R>E)&&(o[y]=E,l.push(y,E),t[y]=g))}if(typeof e<"u"&&typeof o[e]>"u"){var P=["Could not find a path from ",i," to ",e,"."].join("");throw new Error(P)}return t},extract_shortest_path_from_predecessor_list:function(a,i){for(var e=[],t=i;t;)e.push(t),a[t],t=a[t];return e.reverse(),e},find_path:function(a,i,e){var t=r.single_source_shortest_paths(a,i,e);return r.extract_shortest_path_from_predecessor_list(t,e)},PriorityQueue:{make:function(a){var i=r.PriorityQueue,e={},t;a=a||{};for(t in i)i.hasOwnProperty(t)&&(e[t]=i[t]);return e.queue=[],e.sorter=a.sorter||i.default_sorter,e},default_sorter:function(a,i){return a.cost-i.cost},push:function(a,i){var e={value:a,cost:i};this.queue.push(e),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};s.exports=r})(ke)),ke.exports}var ot;function Jt(){return ot||(ot=1,(function(s){const r=re(),a=qt(),i=Ot(),e=Ft(),t=Ht(),o=mt(),l=se(),c=zt();function g(P){return unescape(encodeURIComponent(P)).length}function y(P,k,j){const u=[];let L;for(;(L=P.exec(j))!==null;)u.push({data:L[0],index:L.index,mode:k,length:L[0].length});return u}function v(P){const k=y(o.NUMERIC,r.NUMERIC,P),j=y(o.ALPHANUMERIC,r.ALPHANUMERIC,P);let u,L;return l.isKanjiModeEnabled()?(u=y(o.BYTE,r.BYTE,P),L=y(o.KANJI,r.KANJI,P)):(u=y(o.BYTE_KANJI,r.BYTE,P),L=[]),k.concat(j,u,L).sort(function(d,m){return d.index-m.index}).map(function(d){return{data:d.data,mode:d.mode,length:d.length}})}function w(P,k){switch(k){case r.NUMERIC:return a.getBitsLength(P);case r.ALPHANUMERIC:return i.getBitsLength(P);case r.KANJI:return t.getBitsLength(P);case r.BYTE:return e.getBitsLength(P)}}function h(P){return P.reduce(function(k,j){const u=k.length-1>=0?k[k.length-1]:null;return u&&u.mode===j.mode?(k[k.length-1].data+=j.data,k):(k.push(j),k)},[])}function E(P){const k=[];for(let j=0;j<P.length;j++){const u=P[j];switch(u.mode){case r.NUMERIC:k.push([u,{data:u.data,mode:r.ALPHANUMERIC,length:u.length},{data:u.data,mode:r.BYTE,length:u.length}]);break;case r.ALPHANUMERIC:k.push([u,{data:u.data,mode:r.BYTE,length:u.length}]);break;case r.KANJI:k.push([u,{data:u.data,mode:r.BYTE,length:g(u.data)}]);break;case r.BYTE:k.push([{data:u.data,mode:r.BYTE,length:g(u.data)}])}}return k}function R(P,k){const j={},u={start:{}};let L=["start"];for(let f=0;f<P.length;f++){const d=P[f],m=[];for(let p=0;p<d.length;p++){const x=d[p],S=""+f+p;m.push(S),j[S]={node:x,lastCount:0},u[S]={};for(let T=0;T<L.length;T++){const A=L[T];j[A]&&j[A].node.mode===x.mode?(u[A][S]=w(j[A].lastCount+x.length,x.mode)-w(j[A].lastCount,x.mode),j[A].lastCount+=x.length):(j[A]&&(j[A].lastCount=x.length),u[A][S]=w(x.length,x.mode)+4+r.getCharCountIndicator(x.mode,k))}}L=m}for(let f=0;f<L.length;f++)u[L[f]].end=0;return{map:u,table:j}}function M(P,k){let j;const u=r.getBestModeForData(P);if(j=r.from(k,u),j!==r.BYTE&&j.bit<u.bit)throw new Error('"'+P+'" cannot be encoded with mode '+r.toString(j)+`.
 Suggested mode is: `+r.toString(u));switch(j===r.KANJI&&!l.isKanjiModeEnabled()&&(j=r.BYTE),j){case r.NUMERIC:return new a(P);case r.ALPHANUMERIC:return new i(P);case r.KANJI:return new t(P);case r.BYTE:return new e(P)}}s.fromArray=function(k){return k.reduce(function(j,u){return typeof u=="string"?j.push(M(u,null)):u.data&&j.push(M(u.data,u.mode)),j},[])},s.fromString=function(k,j){const u=v(k,l.isKanjiModeEnabled()),L=E(u),f=R(L,j),d=c.find_path(f.map,"start","end"),m=[];for(let p=1;p<d.length-1;p++)m.push(f.table[d[p]].node);return s.fromArray(h(m))},s.rawSplit=function(k){return s.fromArray(v(k,l.isKanjiModeEnabled()))}})(Ae)),Ae}var at;function Kt(){if(at)return ge;at=1;const s=se(),r=De(),a=Tt(),i=Rt(),e=Bt(),t=kt(),o=Lt(),l=ft(),c=Dt(),g=Ut(),y=_t(),v=re(),w=Jt();function h(f,d){const m=f.size,p=t.getPositions(d);for(let x=0;x<p.length;x++){const S=p[x][0],T=p[x][1];for(let A=-1;A<=7;A++)if(!(S+A<=-1||m<=S+A))for(let B=-1;B<=7;B++)T+B<=-1||m<=T+B||(A>=0&&A<=6&&(B===0||B===6)||B>=0&&B<=6&&(A===0||A===6)||A>=2&&A<=4&&B>=2&&B<=4?f.set(S+A,T+B,!0,!0):f.set(S+A,T+B,!1,!0))}}function E(f){const d=f.size;for(let m=8;m<d-8;m++){const p=m%2===0;f.set(m,6,p,!0),f.set(6,m,p,!0)}}function R(f,d){const m=e.getPositions(d);for(let p=0;p<m.length;p++){const x=m[p][0],S=m[p][1];for(let T=-2;T<=2;T++)for(let A=-2;A<=2;A++)T===-2||T===2||A===-2||A===2||T===0&&A===0?f.set(x+T,S+A,!0,!0):f.set(x+T,S+A,!1,!0)}}function M(f,d){const m=f.size,p=g.getEncodedBits(d);let x,S,T;for(let A=0;A<18;A++)x=Math.floor(A/3),S=A%3+m-8-3,T=(p>>A&1)===1,f.set(x,S,T,!0),f.set(S,x,T,!0)}function P(f,d,m){const p=f.size,x=y.getEncodedBits(d,m);let S,T;for(S=0;S<15;S++)T=(x>>S&1)===1,S<6?f.set(S,8,T,!0):S<8?f.set(S+1,8,T,!0):f.set(p-15+S,8,T,!0),S<8?f.set(8,p-S-1,T,!0):S<9?f.set(8,15-S-1+1,T,!0):f.set(8,15-S-1,T,!0);f.set(p-8,8,1,!0)}function k(f,d){const m=f.size;let p=-1,x=m-1,S=7,T=0;for(let A=m-1;A>0;A-=2)for(A===6&&A--;;){for(let B=0;B<2;B++)if(!f.isReserved(x,A-B)){let z=!1;T<d.length&&(z=(d[T]>>>S&1)===1),f.set(x,A-B,z),S--,S===-1&&(T++,S=7)}if(x+=p,x<0||m<=x){x-=p,p=-p;break}}}function j(f,d,m){const p=new a;m.forEach(function(B){p.put(B.mode.bit,4),p.put(B.getLength(),v.getCharCountIndicator(B.mode,f)),B.write(p)});const x=s.getSymbolTotalCodewords(f),S=l.getTotalCodewordsCount(f,d),T=(x-S)*8;for(p.getLengthInBits()+4<=T&&p.put(0,4);p.getLengthInBits()%8!==0;)p.putBit(0);const A=(T-p.getLengthInBits())/8;for(let B=0;B<A;B++)p.put(B%2?17:236,8);return u(p,f,d)}function u(f,d,m){const p=s.getSymbolTotalCodewords(d),x=l.getTotalCodewordsCount(d,m),S=p-x,T=l.getBlocksCount(d,m),A=p%T,B=T-A,z=Math.floor(p/T),K=Math.floor(S/T),te=K+1,J=z-K,ne=new c(J);let X=0;const Y=new Array(T),$=new Array(T);let V=0;const ae=new Uint8Array(f.buffer);for(let F=0;F<T;F++){const G=F<B?K:te;Y[F]=ae.slice(X,X+G),$[F]=ne.encode(Y[F]),X+=G,V=Math.max(V,G)}const Z=new Uint8Array(p);let ie=0,N,O;for(N=0;N<V;N++)for(O=0;O<T;O++)N<Y[O].length&&(Z[ie++]=Y[O][N]);for(N=0;N<J;N++)for(O=0;O<T;O++)Z[ie++]=$[O][N];return Z}function L(f,d,m,p){let x;if(Array.isArray(f))x=w.fromArray(f);else if(typeof f=="string"){let z=d;if(!z){const K=w.rawSplit(f);z=g.getBestVersionForData(K,m)}x=w.fromString(f,z||40)}else throw new Error("Invalid data");const S=g.getBestVersionForData(x,m);if(!S)throw new Error("The amount of data is too big to be stored in a QR Code");if(!d)d=S;else if(d<S)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+S+`.
`);const T=j(d,m,x),A=s.getSymbolSize(d),B=new i(A);return h(B,d),E(B),R(B,d),P(B,m,0),d>=7&&M(B,d),k(B,T),isNaN(p)&&(p=o.getBestMask(B,P.bind(null,B,m))),o.applyMask(p,B),P(B,m,p),{modules:B,version:d,errorCorrectionLevel:m,maskPattern:p,segments:x}}return ge.create=function(d,m){if(typeof d>"u"||d==="")throw new Error("No input text");let p=r.M,x,S;return typeof m<"u"&&(p=r.from(m.errorCorrectionLevel,r.M),x=g.from(m.version),S=o.from(m.maskPattern),m.toSJISFunc&&s.setToSJISFunction(m.toSJISFunc)),L(d,x,p,S)},ge}var Le={},Me={},lt;function pt(){return lt||(lt=1,(function(s){function r(a){if(typeof a=="number"&&(a=a.toString()),typeof a!="string")throw new Error("Color should be defined as hex string");let i=a.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+a);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(t){return[t,t]}))),i.length===6&&i.push("F","F");const e=parseInt(i.join(""),16);return{r:e>>24&255,g:e>>16&255,b:e>>8&255,a:e&255,hex:"#"+i.slice(0,6).join("")}}s.getOptions=function(i){i||(i={}),i.color||(i.color={});const e=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,t=i.width&&i.width>=21?i.width:void 0,o=i.scale||4;return{width:t,scale:t?4:o,margin:e,color:{dark:r(i.color.dark||"#000000ff"),light:r(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},s.getScale=function(i,e){return e.width&&e.width>=i+e.margin*2?e.width/(i+e.margin*2):e.scale},s.getImageWidth=function(i,e){const t=s.getScale(i,e);return Math.floor((i+e.margin*2)*t)},s.qrToImageData=function(i,e,t){const o=e.modules.size,l=e.modules.data,c=s.getScale(o,t),g=Math.floor((o+t.margin*2)*c),y=t.margin*c,v=[t.color.light,t.color.dark];for(let w=0;w<g;w++)for(let h=0;h<g;h++){let E=(w*g+h)*4,R=t.color.light;if(w>=y&&h>=y&&w<g-y&&h<g-y){const M=Math.floor((w-y)/c),P=Math.floor((h-y)/c);R=v[l[M*o+P]?1:0]}i[E++]=R.r,i[E++]=R.g,i[E++]=R.b,i[E]=R.a}}})(Me)),Me}var ct;function Vt(){return ct||(ct=1,(function(s){const r=pt();function a(e,t,o){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=o,t.width=o,t.style.height=o+"px",t.style.width=o+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}s.render=function(t,o,l){let c=l,g=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(g=i()),c=r.getOptions(c);const y=r.getImageWidth(t.modules.size,c),v=g.getContext("2d"),w=v.createImageData(y,y);return r.qrToImageData(w.data,t,c),a(v,g,y),v.putImageData(w,0,0),g},s.renderToDataURL=function(t,o,l){let c=l;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const g=s.render(t,o,c),y=c.type||"image/png",v=c.rendererOpts||{};return g.toDataURL(y,v.quality)}})(Le)),Le}var Ie={},ut;function Qt(){if(ut)return Ie;ut=1;const s=pt();function r(e,t){const o=e.a/255,l=t+'="'+e.hex+'"';return o<1?l+" "+t+'-opacity="'+o.toFixed(2).slice(1)+'"':l}function a(e,t,o){let l=e+t;return typeof o<"u"&&(l+=" "+o),l}function i(e,t,o){let l="",c=0,g=!1,y=0;for(let v=0;v<e.length;v++){const w=Math.floor(v%t),h=Math.floor(v/t);!w&&!g&&(g=!0),e[v]?(y++,v>0&&w>0&&e[v-1]||(l+=g?a("M",w+o,.5+h+o):a("m",c,0),c=0,g=!1),w+1<t&&e[v+1]||(l+=a("h",y),y=0)):c++}return l}return Ie.render=function(t,o,l){const c=s.getOptions(o),g=t.modules.size,y=t.modules.data,v=g+c.margin*2,w=c.color.light.a?"<path "+r(c.color.light,"fill")+' d="M0 0h'+v+"v"+v+'H0z"/>':"",h="<path "+r(c.color.dark,"stroke")+' d="'+i(y,g,c.margin)+'"/>',E='viewBox="0 0 '+v+" "+v+'"',M='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+E+' shape-rendering="crispEdges">'+w+h+`</svg>
`;return typeof l=="function"&&l(null,M),M},Ie}var dt;function Gt(){if(dt)return oe;dt=1;const s=Pt(),r=Kt(),a=Vt(),i=Qt();function e(t,o,l,c,g){const y=[].slice.call(arguments,1),v=y.length,w=typeof y[v-1]=="function";if(!w&&!s())throw new Error("Callback required as last argument");if(w){if(v<2)throw new Error("Too few arguments provided");v===2?(g=l,l=o,o=c=void 0):v===3&&(o.getContext&&typeof g>"u"?(g=c,c=void 0):(g=c,c=l,l=o,o=void 0))}else{if(v<1)throw new Error("Too few arguments provided");return v===1?(l=o,o=c=void 0):v===2&&!o.getContext&&(c=l,l=o,o=void 0),new Promise(function(h,E){try{const R=r.create(l,c);h(t(R,o,c))}catch(R){E(R)}})}try{const h=r.create(l,c);g(null,t(h,o,c))}catch(h){g(h)}}return oe.create=r.create,oe.toCanvas=e.bind(null,a.render),oe.toDataURL=e.bind(null,a.renderToDataURL),oe.toString=e.bind(null,function(t,o,l){return i.render(t,l)}),oe}var Yt=Gt();const Wt=Ct(Yt);function Zt({sessionId:s,hassUrl:r,hassToken:a,onLogout:i}){const[e,t]=C.useState([]),[o,l]=C.useState(new Set),[c,g]=C.useState("LobbyHA"),[y,v]=C.useState(!1),[w,h]=C.useState(""),[E,R]=C.useState(!0),[M,P]=C.useState(!1),[k,j]=C.useState(!1),[u,L]=C.useState(!1),[f,d]=C.useState(!1),[m,p]=C.useState(!1),[x,S]=C.useState(!1),[T,A]=C.useState(!1),[B,z]=C.useState(""),[K,te]=C.useState(""),[J,ne]=C.useState(null),[X,Y]=C.useState(null),$=C.useRef(null),V=C.useCallback(async(b=!1)=>{b||R(!0);try{const[I,q,U]=await Promise.all([D("/api/ui/modules",{sessionId:s}),D("/api/ui/hidden",{sessionId:s}),D("/api/ui/guest-entities",{sessionId:s})]);t(I.modules),l(new Set(q.hidden)),g(U.title||"LobbyHA")}catch{}finally{b||R(!1)}},[s]);C.useEffect(()=>{V()},[V]),C.useEffect(()=>{if(!x)return;const b=I=>{$.current&&!$.current.contains(I.target)&&S(!1)};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[x]);const ae=()=>{h(c),v(!0)},Z=async()=>{const b=w.trim()||"LobbyHA";g(b),v(!1),await D("/api/ui/guest-entities",{method:"POST",sessionId:s,body:JSON.stringify({title:b})})},ie=async b=>{const I=new Set(o);I.add(b),l(I),await D("/api/ui/hidden",{method:"POST",sessionId:s,body:JSON.stringify({hidden:Array.from(I)})})},N=async b=>{const I=new Set(o);I.delete(b),l(I),await D("/api/ui/hidden",{method:"POST",sessionId:s,body:JSON.stringify({hidden:Array.from(I)})})},O=async(b,I)=>{const q=e.find(U=>U.entities.includes(b));if(q){const U=q.entities.filter(_=>_!==b);t(_=>_.map(H=>H.id===q.id?{...H,entities:U}:H)),await D(`/api/ui/modules/${q.id}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:U})})}if(I!==null){const U=e.find(_=>_.id===I);if(U){const _=[...U.entities.filter(H=>H!==b),b];t(H=>H.map(Q=>Q.id===U.id?{...Q,entities:_}:Q)),await D(`/api/ui/modules/${U.id}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:_})})}}V(!0)},F=async(b,I,q)=>{const U=e.find(de=>de.id===b);if(!U)return;const _=[...U.entities],H=_.indexOf(I);if(H<0)return;const Q=q==="up"?H-1:H+1;Q<0||Q>=_.length||([_[H],_[Q]]=[_[Q],_[H]],t(de=>de.map(he=>he.id===b?{...he,entities:_}:he)),await D(`/api/ui/modules/${b}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:_})}))},[G,ce]=C.useState(null),yt=async(b,I)=>{if(!G||G.moduleId!==b){ce(null);return}const q=e.find(H=>H.id===b);if(!q)return;const U=[...q.entities],_=U.indexOf(G.entityId);_<0||(U.splice(_,1),U.splice(I,0,G.entityId),t(H=>H.map(Q=>Q.id===b?{...Q,entities:U}:Q)),ce(null),await D(`/api/ui/modules/${b}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:U})}))},wt=async()=>{const b=new URL("./",window.location.href).toString();try{const I=await Wt.toDataURL(b,{width:256,margin:2});Y(I),p(!0)}catch(I){console.error("Failed to generate QR code:",I)}},bt=async()=>{ne(null);try{await D("/api/admin/change-password",{method:"POST",sessionId:s,body:JSON.stringify({currentPassword:B,newPassword:K})}),ne("Password changed!"),z(""),te("")}catch(b){ne(b instanceof Error?b.message:"Failed")}},Nt=async(b,I)=>{const q=e.find(_=>_.id===b);if(!q)return;const U=q.entities.filter(_=>_!==I);await D(`/api/ui/modules/${b}/entities`,{method:"POST",sessionId:s,body:JSON.stringify({entities:U})}),V()};return E?n.jsx("div",{className:"container",children:n.jsx("p",{className:"note",children:"Loading dashboard..."})}):n.jsxs("div",{className:"admin-layout",children:[n.jsxs("header",{className:"admin-header",children:[n.jsxs("div",{className:"header-left",children:[y?n.jsxs("span",{className:"title-edit",children:[n.jsx("input",{className:"title-input",value:w,onChange:b=>h(b.target.value),onKeyDown:b=>{b.key==="Enter"&&Z(),b.key==="Escape"&&v(!1)},autoFocus:!0}),n.jsx("button",{type:"button",className:"action-button",onClick:Z,children:"âœ“"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>v(!1),children:"âœ•"})]}):n.jsx("h1",{className:"dashboard-title",onClick:ae,title:"Click to edit",children:c}),n.jsx("span",{className:"admin-badge",children:"Admin"})]}),n.jsxs("div",{className:"header-right",children:[n.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!0),children:"ðŸ” Discover"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>j(!0),children:"ðŸ“¦ Areas"}),n.jsx("button",{type:"button",className:"action-button",onClick:wt,children:"ðŸ“± QR Code"}),n.jsxs("div",{className:"settings-menu-wrap",ref:$,children:[n.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!x),children:"âš™ï¸"}),x&&n.jsxs("div",{className:"settings-dropdown",children:[n.jsxs("button",{onClick:()=>{S(!1),d(!0)},children:["Hidden Entities (",o.size,")"]}),n.jsx("button",{onClick:()=>{S(!1),A(!0)},children:"Change Password"}),n.jsx("button",{onClick:()=>{S(!1),L(!0)},children:"Server Settings"}),n.jsx("button",{onClick:()=>{S(!1),i()},children:"Logout"})]})]})]})]}),n.jsx("main",{className:"admin-main",children:e.length===0?n.jsxs("div",{className:"empty-state",children:[n.jsx("p",{children:"No areas yet. Create areas to organize your entities."}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>j(!0),children:"Create First Area"})]}):e.map(b=>{const I=b.entities.filter(q=>!o.has(q));return n.jsxs("section",{className:"module-section",children:[n.jsxs("div",{className:"module-header",children:[n.jsxs("h2",{children:[b.icon," ",b.name]}),n.jsxs("span",{className:"entity-count",children:[b.entities.length," entities"]})]}),n.jsxs("div",{className:"entity-grid",children:[I.map((q,U)=>n.jsxs("div",{className:`entity-card-wrap admin-card${(G==null?void 0:G.entityId)===q?" dragging":""}`,draggable:!0,onDragStart:()=>ce({moduleId:b.id,entityId:q}),onDragOver:_=>_.preventDefault(),onDrop:()=>yt(b.id,U),onDragEnd:()=>ce(null),children:[n.jsx(Et,{entityId:q,showActions:!0,showAttributes:!0,onHide:()=>ie(q)}),n.jsxs("div",{className:"entity-admin-actions",children:[n.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>F(b.id,q,"up"),disabled:U===0,title:"Move up",children:"â†‘"}),n.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>F(b.id,q,"down"),disabled:U===I.length-1,title:"Move down",children:"â†“"}),n.jsx("button",{type:"button",className:"remove-from-module-btn",onClick:()=>Nt(b.id,q),title:"Remove from area",children:"âœ•"})]})]},q)),b.entities.length===0&&n.jsx("p",{className:"note",style:{gridColumn:"1 / -1"},children:"No entities in this area. Use Discover to add some."})]})]},b.id)})}),M&&n.jsx(jt,{sessionId:s,modules:e,onAssignEntity:O,onClose:()=>P(!1)}),k&&n.jsx(At,{sessionId:s,modules:e,onModulesChange:t,onClose:()=>{j(!1),V()}}),u&&n.jsx(ht,{sessionId:s,onClose:()=>L(!1)}),f&&n.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:n.jsxs("div",{className:"modal",onClick:b=>b.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsxs("h3",{children:["Hidden Entities (",o.size,")"]}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>d(!1),children:"Close"})]}),n.jsxs("ul",{className:"hidden-list",children:[Array.from(o).map(b=>n.jsxs("li",{children:[n.jsx("span",{className:"hidden-id",children:b}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>N(b),children:"Unhide"})]},b)),o.size===0&&n.jsx("p",{className:"note",children:"No hidden entities."})]})]})}),m&&n.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:n.jsxs("div",{className:"modal qr-modal",onClick:b=>b.stopPropagation(),children:[n.jsx("h3",{children:"Guest Access QR Code"}),X&&n.jsx("img",{src:X,alt:"QR Code for guest access"}),n.jsx("p",{className:"note",children:"Scan this code to open the guest dashboard."}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>p(!1),children:"Close"})]})}),T&&n.jsx("div",{className:"modal-overlay",onClick:()=>A(!1),children:n.jsxs("div",{className:"modal",onClick:b=>b.stopPropagation(),children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h3",{children:"Change Password"}),n.jsx("button",{type:"button",className:"action-button",onClick:()=>A(!1),children:"Close"})]}),n.jsxs("div",{className:"settings-form",children:[n.jsxs("div",{className:"form-field",children:[n.jsx("label",{children:"Current Password"}),n.jsx("input",{type:"password",value:B,onChange:b=>z(b.target.value)})]}),n.jsxs("div",{className:"form-field",children:[n.jsx("label",{children:"New Password"}),n.jsx("input",{type:"password",value:K,onChange:b=>te(b.target.value)})]}),J&&n.jsx("p",{className:"note",children:J}),n.jsx("button",{type:"button",className:"action-button",onClick:bt,children:"Change Password"})]})]})})]})}function Xt({onLogin:s,error:r}){const[a,i]=C.useState(""),[e,t]=C.useState(!1),o=async l=>{l.preventDefault(),t(!0),await s(a),t(!1)};return n.jsxs("div",{className:"container",children:[n.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Admin Login"}),n.jsxs("form",{className:"login-form",onSubmit:o,children:[n.jsx("input",{className:"login-input",type:"password",placeholder:"Admin password",value:a,onChange:l=>i(l.target.value),autoFocus:!0}),n.jsx("button",{type:"submit",className:"action-button",disabled:e,children:e?"Logging in...":"Login"})]}),r&&n.jsx("p",{className:"note error",children:r})]})}function $t(){const[s,r]=C.useState(()=>sessionStorage.getItem("admin_session")),[a,i]=C.useState(""),[e,t]=C.useState(""),[o,l]=C.useState(null),[c,g]=C.useState(!0);C.useEffect(()=>{(async()=>{const h=sessionStorage.getItem("admin_session");if(!h){g(!1);return}try{const E=await D("/api/admin/session",{sessionId:h});E.valid?(r(h),i(E.hassUrl),t(E.hassToken)):(sessionStorage.removeItem("admin_session"),r(null))}catch{sessionStorage.removeItem("admin_session"),r(null)}finally{g(!1)}})()},[]);const y=async w=>{l(null);try{const h=await D("/api/admin/login",{method:"POST",body:JSON.stringify({password:w})});h.success?(sessionStorage.setItem("admin_session",h.sessionId),r(h.sessionId),i(h.hassUrl),t(h.hassToken)):l("Invalid password")}catch(h){l(h instanceof Error?h.message:"Login failed")}},v=async()=>{if(s)try{await D("/api/admin/logout",{method:"POST",sessionId:s})}catch{}sessionStorage.removeItem("admin_session"),r(null),i(""),t("")};return c?n.jsx("div",{className:"container",children:n.jsx("p",{className:"note",children:"Loading..."})}):s?a?n.jsxs(St,{hassUrl:a,hassToken:e,loading:n.jsx("div",{className:"container",children:n.jsx("p",{className:"note",children:"Connecting to Home Assistant..."})}),options:{renderError:()=>n.jsxs("div",{className:"container",children:[n.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"LobbyHA Admin"}),n.jsxs("p",{className:"note error",style:{marginBottom:"1.5rem"},children:["Unable to connect to Home Assistant.",n.jsx("br",{}),"Update the settings below and save to reconnect."]}),n.jsx(ht,{sessionId:s,inline:!0,onSaved:()=>{setTimeout(()=>window.location.reload(),1500)}}),n.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginTop:"1rem"},children:[n.jsx("button",{type:"button",className:"action-button",onClick:()=>window.location.reload(),children:"Retry Connection"}),n.jsx("button",{type:"button",className:"action-button secondary",onClick:v,children:"Logout"})]})]})},children:[n.jsx(xt,{}),n.jsx(Zt,{sessionId:s,hassUrl:a,hassToken:e,onLogout:v})]}):n.jsx("div",{className:"container",children:n.jsxs("p",{className:"note",children:["Server not configured. ",n.jsx("a",{href:"/setup",children:"Run setup"})]})}):n.jsx(Xt,{onLogin:y,error:o})}vt.createRoot(document.getElementById("root")).render(n.jsx(C.StrictMode,{children:n.jsx($t,{})}));
