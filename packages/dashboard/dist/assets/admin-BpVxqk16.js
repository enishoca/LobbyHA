import{r as h,a as I,j as e,g as Ot,c as Ft}from"./index-dtVNt39M.js";import{d as Ve,r as He,i as ye,l as Ht,I as Ge,E as qt,h as zt,e as Jt}from"./EntityCard-BX5I8Eek.js";function Kt({sessionId:n,modules:o,onAssignEntity:r,onClose:i}){const[t,s]=h.useState([]),[a,l]=h.useState([]),[c,m]=h.useState([]),[b,v]=h.useState(!0),[g,f]=h.useState(""),[u,C]=h.useState(null),[_,E]=h.useState(!1),L=h.useMemo(()=>{const d=new Map;return o.forEach(B=>B.entities.forEach(y=>d.set(y,B.id))),d},[o]),A=h.useCallback(async(d=!1)=>{d?E(!0):v(!0);try{const p=await I(d?"/api/discovery/refresh":"/api/discovery/entities",d?{method:"POST",sessionId:n}:{sessionId:n});l(p.entities),s(p.entities),m(p.domains.map(w=>({domain:w.domain,label:w.label,count:w.entities.length})))}catch{}finally{v(!1),E(!1)}},[n]);return h.useEffect(()=>{A()},[A]),h.useEffect(()=>{let d=a;if(u&&(d=d.filter(B=>B.domain===u)),g){const B=g.toLowerCase();d=d.filter(y=>{var p;return y.entity_id.toLowerCase().includes(B)||y.name.toLowerCase().includes(B)||(((p=y.area)==null?void 0:p.toLowerCase().includes(B))??!1)})}s(d)},[a,g,u]),e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal",style:{maxWidth:"700px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Discover Entities (",a.length," total)"]}),e.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),e.jsxs("div",{className:"discovery-search",children:[e.jsx("input",{type:"text",placeholder:"Search entities...",value:g,onChange:d=>f(d.target.value),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>A(!0),disabled:_,children:_?"Refreshing...":"üîÑ Refresh"})]}),e.jsxs("div",{className:"domain-filter",children:[e.jsxs("button",{type:"button",className:`domain-chip ${u===null?"active":""}`,onClick:()=>C(null),children:["All (",a.length,")"]}),c.length===0&&!b&&e.jsx("span",{style:{fontSize:"0.8rem",color:"var(--text-muted)",alignSelf:"center"},children:"No entity types found"}),c.map(d=>e.jsxs("button",{type:"button",className:`domain-chip ${u===d.domain?"active":""}`,onClick:()=>C(u===d.domain?null:d.domain),children:[Ve(d.domain)," ",d.label," (",d.count,")"]},d.domain))]}),b?e.jsx("p",{className:"note",children:"Loading entities..."}):e.jsxs("ul",{className:"discovery-entity-list",children:[t.map(d=>{const B=L.get(d.entity_id),y=B!==void 0;return e.jsxs("li",{className:`discovery-entity-item ${y?"on-dashboard":""}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"discovery-entity-name",children:[Ve(d.domain)," ",d.name]}),e.jsx("div",{className:"discovery-entity-id",children:d.entity_id})]}),e.jsx("span",{className:"discovery-entity-state",children:d.state}),e.jsxs("select",{className:"discovery-area-select",value:B??"",onChange:p=>{const w=p.target.value;r(d.entity_id,w===""?null:Number(w))},children:[e.jsx("option",{value:"",children:"‚Äî None ‚Äî"}),o.map(p=>e.jsxs("option",{value:p.id,children:[p.icon," ",p.name]},p.id))]})]},d.entity_id)}),t.length===0&&e.jsx("p",{className:"note",children:"No entities found matching your criteria."})]})]})})}const We=[{label:"Home",emojis:["üè†","üè°","üè¢","üèó","üèò","üè∞","üõè","üõã","üö™","ü™ü","üèï","‚õ∫","üß±"]},{label:"Rooms",emojis:["üõÅ","üöø","üöΩ","ü™•","üç≥","üçΩ","üßë‚Äçüç≥","üì∫","üéÆ","üíª","üñ•","üìö","üéµ","üé∏","üéπ"]},{label:"Lighting",emojis:["üí°","üî¶","üïØ","üåü","‚ú®","‚≠ê","üåô","‚òÄÔ∏è","üîÜ","üîÖ","ü™î"]},{label:"Climate",emojis:["üå°","‚ùÑÔ∏è","üî•","üí®","üåÄ","‚òÅÔ∏è","üå§","üåß","üåä","üíß","üßä"]},{label:"Security",emojis:["üîí","üîì","üîë","üõ°","üìπ","üì∑","üö®","üîî","üö´","‚ö†Ô∏è","üëÅ"]},{label:"Outdoor",emojis:["üå≥","üå≤","üåø","üå∫","üåª","üå¥","üèä","üÖøÔ∏è","üöó","üèã","üßπ","üóë"]},{label:"Appliances",emojis:["üß∫","üëï","ü´ß","üßä","üçï","‚òï","üßÉ","ü•§","üßΩ","ü™£","üîå","üîã","‚ö°"]},{label:"General",emojis:["üì¶","üéØ","üé®","üß©","üõ†","‚öôÔ∏è","üìä","üìà","üóÇ","üìã","‚úÖ","‚ùå","‚ûï","üîÑ"]}];function Qe({value:n,onChange:o}){const[r,i]=h.useState(!1),[t,s]=h.useState(""),a=h.useRef(null),l=h.useRef(null),[c,m]=h.useState({top:0,left:0});h.useEffect(()=>{if(r&&a.current){const g=a.current.getBoundingClientRect();m({top:g.bottom+6,left:Math.max(8,g.left-100)})}},[r]),h.useEffect(()=>{if(!r)return;const g=f=>{l.current&&!l.current.contains(f.target)&&a.current&&!a.current.contains(f.target)&&i(!1)};return document.addEventListener("mousedown",g),()=>document.removeEventListener("mousedown",g)},[r]);const b=We.flatMap(g=>g.emojis),v=t.trim()?b.filter(()=>!0):null;return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:a,type:"button",className:"emoji-picker-trigger",onClick:()=>i(!r),title:"Pick icon",children:n||"üè†"}),r&&He.createPortal(e.jsx("div",{ref:l,className:"emoji-picker-panel",style:{top:c.top,left:c.left},children:e.jsx("div",{className:"emoji-picker-grid",children:(v??We.flatMap(g=>g.emojis)).map((g,f)=>e.jsx("button",{type:"button",className:`emoji-picker-item${g===n?" selected":""}`,onClick:()=>{o(g),i(!1)},children:g},`${g}-${f}`))})}),document.body)]})}function Vt({sessionId:n,modules:o,onModulesChange:r,onClose:i}){const[t,s]=h.useState(""),[a,l]=h.useState("üè†"),[c,m]=h.useState(null),[b,v]=h.useState(""),[g,f]=h.useState(""),u=h.useCallback(async()=>{const d=await I("/api/ui/modules",{sessionId:n});r(d.modules)},[n,r]),C=async()=>{t.trim()&&(await I("/api/ui/modules",{method:"POST",sessionId:n,body:JSON.stringify({name:t.trim(),icon:a})}),s(""),l("üè†"),u())},_=async d=>{await I(`/api/ui/modules/${d}`,{method:"PUT",sessionId:n,body:JSON.stringify({name:b,icon:g})}),m(null),u()},E=async d=>{confirm("Delete this area and remove all entity assignments?")&&(await I(`/api/ui/modules/${d}`,{method:"DELETE",sessionId:n}),u())},L=async d=>{await I(`/api/ui/modules/${d.id}`,{method:"PUT",sessionId:n,body:JSON.stringify({visible:!d.visible})}),u()},A=async(d,B)=>{const y=o.findIndex(N=>N.id===d);if(y<0)return;const p=[...o.map(N=>N.id)],w=B==="up"?y-1:y+1;w<0||w>=p.length||([p[y],p[w]]=[p[w],p[y]],await I("/api/ui/modules/reorder",{method:"POST",sessionId:n,body:JSON.stringify({moduleIds:p})}),u())};return e.jsx("div",{className:"modal-overlay",onClick:i,children:e.jsxs("div",{className:"modal",style:{maxWidth:"550px"},onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Manage Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:i,children:"Close"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",alignItems:"center"},children:[e.jsx(Qe,{value:a,onChange:l}),e.jsx("input",{style:{flex:1},value:t,onChange:d=>s(d.target.value),placeholder:"Area name...",onKeyDown:d=>d.key==="Enter"&&C()}),e.jsx("button",{type:"button",className:"action-button",onClick:C,children:"Add"})]}),e.jsxs("ul",{className:"hidden-list",children:[o.map((d,B)=>e.jsx("li",{children:c===d.id?e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flex:1,alignItems:"center"},children:[e.jsx(Qe,{value:g,onChange:f}),e.jsx("input",{style:{flex:1},value:b,onChange:y=>v(y.target.value),onKeyDown:y=>y.key==="Enter"&&_(d.id),autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>_(d.id),children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>m(null),children:"‚úï"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"hidden-name",children:[d.icon," ",d.name]}),e.jsxs("div",{className:"hidden-id",children:[d.entities.length," entities ¬∑ ",d.visible?"visible":"hidden"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>A(d.id,"up"),disabled:B===0,children:"‚Üë"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>A(d.id,"down"),disabled:B===o.length-1,children:"‚Üì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>L(d),children:d.visible?"üëÅ":"üëÅ‚Äçüó®"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>{m(d.id),v(d.name),f(d.icon)},children:"‚úèÔ∏è"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>E(d.id),children:"üóë"})]})]})},d.id)),o.length===0&&e.jsx("p",{className:"note",children:"No areas yet. Create one above to organize your entities."})]})]})})}function Et({sessionId:n,onClose:o,inline:r,onSaved:i}){const[t,s]=h.useState(""),[a,l]=h.useState("‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"),[c,m]=h.useState(""),[b,v]=h.useState("INFO"),[g,f]=h.useState(""),[u,C]=h.useState(!1),[_,E]=h.useState(!1),[L,A]=h.useState(!1),[d,B]=h.useState([]),[y,p]=h.useState(null),[w,N]=h.useState(!1),[k,S]=h.useState([]),[R,P]=h.useState(""),[T,q]=h.useState(!1),[M,X]=h.useState(!1),[Y,ne]=h.useState(!1);L||I("/api/admin/config",{sessionId:n}).then(x=>{x.success&&(s(x.config.HA_URL||""),l(x.config.HA_TOKEN||""),m(x.config.PORT||"3000"),v(x.config.LOG_LEVEL||"INFO"),f(x.config.ALLOWED_ENTITIES||""),B(x.missing||[])),A(!0)}).catch(()=>A(!0)),M||I("/api/guest/settings",{sessionId:n}).then(x=>{N(x.pinEnabled),S(x.pins),X(!0)}).catch(()=>X(!0));const W=x=>d.includes(x),te=async()=>{E(!0),p(null);try{const K=await I("/api/setup/test-connection",{method:"POST",body:JSON.stringify({haUrl:t,haToken:(a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?"":a)||void 0})});K.success?p({type:"success",message:"Connection successful!"}):p({type:"error",message:K.error||"Connection failed"})}catch(x){p({type:"error",message:x instanceof Error?x.message:"Test failed"})}finally{E(!1)}},se=async()=>{if(!t.trim()){p({type:"error",message:"Home Assistant URL is required"});return}if(!a.trim()||a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&W("HA_TOKEN")){p({type:"error",message:"Access token is required. Please enter your HA long-lived token."});return}C(!0),p(null);try{await I("/api/admin/config",{method:"POST",sessionId:n,body:JSON.stringify({haUrl:t,haToken:a==="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"?void 0:a,port:c,logLevel:b,allowedEntities:g})}),B(x=>x.filter(J=>J==="HA_URL"&&!t.trim()||J==="HA_TOKEN"&&!a.trim())),p({type:"success",message:"Settings saved! Reload to apply."}),i==null||i()}catch(x){p({type:"error",message:x instanceof Error?x.message:"Failed to save"})}finally{C(!1)}},Z=async(x,J)=>{ne(!0);try{const K=await I("/api/guest/settings",{method:"POST",sessionId:n,body:JSON.stringify({pinEnabled:x,pins:J})});N(K.pinEnabled),S(K.pins)}catch{}finally{ne(!1)}},ce=()=>{const x=!w;N(x),Z(x,k)},$=()=>{const x=R.trim();if(!x||k.some(K=>K.pin===x))return;const J=[...k,{pin:x,permanent:T}];S(J),P(""),q(!1),Z(w,J)},oe=x=>{const J=k.filter(K=>K.pin!==x);S(J),Z(w,J)},Q=x=>{const J=k.map(K=>K.pin===x?{...K,permanent:!K.permanent}:K);S(J),Z(w,J)},V=d.length>0,G=e.jsxs("div",{className:r?"":"modal settings-modal",onClick:x=>x.stopPropagation(),children:[!r&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Settings"}),e.jsx("button",{type:"button",className:"action-button",onClick:o,children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üîí Guest PIN Access"}),e.jsxs("label",{className:"pin-toggle-switch",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:ce,disabled:Y}),e.jsx("span",{className:"pin-toggle-label",children:"Require PIN for guest dashboard"}),e.jsx("span",{className:"pin-toggle-hint",children:w?"Enabled":"Disabled"})]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{style:{fontSize:"0.85rem",color:"#8a9bc0",display:"block",marginBottom:"0.5rem"},children:["Allowed PINs (",k.length,")"]}),k.length>0&&e.jsx("ul",{className:"pin-list",children:k.map(x=>e.jsxs("li",{children:[e.jsx("span",{children:x.pin}),e.jsx("button",{type:"button",className:`pin-badge ${x.permanent?"permanent":"expiring"}`,onClick:()=>Q(x.pin),title:x.permanent?"Click to make expiring (7 days)":"Click to make permanent",disabled:Y,children:x.permanent?"permanent":"7-day"}),e.jsx("button",{type:"button",onClick:()=>oe(x.pin),title:"Remove PIN",disabled:Y,children:"‚úï"})]},x.pin))}),e.jsxs("div",{className:"pin-add-row",children:[e.jsx("input",{value:R,onChange:x=>P(x.target.value),onKeyDown:x=>{x.key==="Enter"&&$()},placeholder:"Enter new PIN",disabled:Y}),e.jsxs("label",{className:"pin-permanent-toggle",title:"Permanent PINs never expire",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:x=>q(x.target.checked),disabled:Y}),e.jsx("span",{children:"Permanent"})]}),e.jsx("button",{type:"button",onClick:$,disabled:Y||!R.trim(),children:"Add"})]}),w&&k.length===0&&e.jsx("p",{className:"note error",style:{marginTop:"0.5rem",fontSize:"0.85rem"},children:"‚ö† PIN is enabled but no PINs are set. Guests won't be able to access the dashboard."})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"üåê Server Connection"}),V&&e.jsx("p",{className:"note error",style:{marginBottom:"0.75rem"},children:"Required settings are missing. Please fill in the highlighted fields."}),e.jsxs("div",{className:`form-field${W("HA_URL")?" field-missing":""}`,children:[e.jsxs("label",{children:["Home Assistant URL",W("HA_URL")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:t,onChange:x=>s(x.target.value),placeholder:"http://homeassistant.local:8123"}),W("HA_URL")&&e.jsx("span",{className:"field-hint",children:"Enter your Home Assistant URL (e.g. http://192.168.1.x:8123)"})]}),e.jsxs("div",{className:`form-field${W("HA_TOKEN")?" field-missing":""}`,children:[e.jsxs("label",{children:["Long-Lived Access Token",W("HA_TOKEN")&&e.jsx("span",{className:"required-badge",children:"required"})]}),e.jsx("input",{value:a,onChange:x=>l(x.target.value),type:"password",placeholder:W("HA_TOKEN")?"Paste your HA token here":""}),W("HA_TOKEN")&&e.jsx("span",{className:"field-hint",children:"Create a token in HA ‚Üí Profile ‚Üí Long-Lived Access Tokens ‚Üí Create Token"})]}),y&&e.jsx("p",{className:`note ${y.type}`,children:y.message}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"action-button secondary",onClick:te,disabled:_||!t,children:_?"Testing...":"Test Connection"}),e.jsx("button",{type:"button",className:"action-button",onClick:se,disabled:u,children:u?"Saving...":V?"Save & Configure":"Save Settings"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"‚ö° Advanced"}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Server Port"}),e.jsx("input",{value:c,onChange:x=>m(x.target.value),placeholder:"3000"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Log Level"}),e.jsxs("select",{value:b,onChange:x=>v(x.target.value),children:[e.jsx("option",{value:"DEBUG",children:"DEBUG"}),e.jsx("option",{value:"INFO",children:"INFO"}),e.jsx("option",{value:"WARNING",children:"WARNING"}),e.jsx("option",{value:"ERROR",children:"ERROR"})]})]}),e.jsxs("div",{className:"form-field",children:[e.jsxs("label",{children:["Allowed Entities ",e.jsx("span",{style:{fontWeight:400,opacity:.7},children:"(optional, comma-separated)"})]}),e.jsx("input",{value:g,onChange:x=>f(x.target.value),placeholder:"light.living_room, switch.bedroom (leave empty for all)"}),e.jsx("span",{className:"field-hint",children:"Limit which entities are exposed. Leave empty to allow all."})]})]})]})]});return r?G:e.jsx("div",{className:"modal-overlay",onClick:o,children:G})}function Ye(n,o){const r=n.replace("mdi:",""),i=encodeURIComponent(o);return`https://api.iconify.design/mdi/${r}.svg?color=${i}&height=24`}const kt=[{label:"Lighting",color:"#ffd54f",icons:["mdi:lightbulb","mdi:lightbulb-outline","mdi:lightbulb-group","mdi:lightbulb-on","mdi:lamp","mdi:floor-lamp","mdi:desk-lamp","mdi:ceiling-light","mdi:led-strip","mdi:led-strip-variant","mdi:track-light","mdi:wall-sconce","mdi:wall-sconce-round","mdi:vanity-light","mdi:chandelier","mdi:outdoor-lamp","mdi:lava-lamp","mdi:string-lights","mdi:light-switch","mdi:brightness-5"]},{label:"Climate",color:"#4fc3f7",icons:["mdi:thermometer","mdi:thermometer-half","mdi:thermometer-high","mdi:thermometer-low","mdi:air-conditioner","mdi:hvac","mdi:fan","mdi:fan-off","mdi:snowflake","mdi:fire","mdi:water-percent","mdi:weather-windy","mdi:heat-wave","mdi:coolant-temperature","mdi:radiator","mdi:air-humidifier","mdi:air-purifier","mdi:air-filter","mdi:thermostat","mdi:thermostat-box"]},{label:"Security",color:"#ef5350",icons:["mdi:lock","mdi:lock-open","mdi:lock-smart","mdi:shield-home","mdi:shield-lock","mdi:alarm-light","mdi:bell-ring","mdi:bell","mdi:cctv","mdi:video-surveillance","mdi:camera","mdi:camera-iris","mdi:motion-sensor","mdi:door-sensor","mdi:window-sensor","mdi:smoke-detector","mdi:fire-alert","mdi:siren","mdi:shield-check","mdi:security"]},{label:"Doors & Windows",color:"#ab47bc",icons:["mdi:door","mdi:door-open","mdi:door-closed","mdi:door-closed-lock","mdi:window-closed","mdi:window-open","mdi:window-shutter","mdi:window-shutter-open","mdi:blinds","mdi:blinds-open","mdi:curtains","mdi:curtains-closed","mdi:garage","mdi:garage-open","mdi:gate","mdi:gate-open","mdi:roller-shade","mdi:roller-shade-closed","mdi:awning","mdi:awning-outline"]},{label:"Rooms",color:"#66bb6a",icons:["mdi:sofa","mdi:bed","mdi:bed-double","mdi:bunk-bed","mdi:bathtub","mdi:shower","mdi:toilet","mdi:sink","mdi:television","mdi:desk","mdi:table-furniture","mdi:wardrobe","mdi:bookshelf","mdi:chair-rolling","mdi:stairs","mdi:elevator","mdi:room-service","mdi:baby-carriage","mdi:toy-brick","mdi:cradle"]},{label:"Kitchen",color:"#ff7043",icons:["mdi:fridge","mdi:fridge-outline","mdi:stove","mdi:microwave","mdi:dishwasher","mdi:coffee-maker","mdi:toaster-oven","mdi:blender","mdi:food-fork-drink","mdi:pot-steam","mdi:silverware-fork-knife","mdi:glass-wine","mdi:beer","mdi:water-pump","mdi:faucet","mdi:countertop","mdi:kettle","mdi:grill","mdi:ice-cream","mdi:food-apple"]},{label:"Media",color:"#7e57c2",icons:["mdi:speaker","mdi:speaker-wireless","mdi:cast","mdi:cast-audio","mdi:play-circle","mdi:pause-circle","mdi:skip-next","mdi:skip-previous","mdi:volume-high","mdi:volume-medium","mdi:volume-low","mdi:volume-off","mdi:headphones","mdi:microphone","mdi:music","mdi:music-note","mdi:radio","mdi:gamepad-variant","mdi:monitor","mdi:projector"]},{label:"Power & Energy",color:"#ffa726",icons:["mdi:power-plug","mdi:power-plug-off","mdi:power-socket","mdi:flash","mdi:flash-off","mdi:battery","mdi:battery-charging","mdi:battery-50","mdi:battery-alert","mdi:solar-power","mdi:solar-panel","mdi:wind-turbine","mdi:ev-station","mdi:meter-electric","mdi:transmission-tower","mdi:power-cycle","mdi:lightning-bolt","mdi:electric-switch","mdi:surge-protector","mdi:battery-heart"]},{label:"Sensors",color:"#26c6da",icons:["mdi:eye","mdi:motion-sensor","mdi:run","mdi:walk","mdi:water-alert","mdi:leak","mdi:gauge","mdi:speedometer","mdi:scale-bathroom","mdi:pulse","mdi:heart-pulse","mdi:signal","mdi:signal-cellular-3","mdi:wifi","mdi:bluetooth","mdi:nfc","mdi:chip","mdi:counter","mdi:timer-sand","mdi:clock-outline"]},{label:"Weather",color:"#42a5f5",icons:["mdi:weather-sunny","mdi:weather-night","mdi:weather-cloudy","mdi:weather-partly-cloudy","mdi:weather-rainy","mdi:weather-pouring","mdi:weather-snowy","mdi:weather-snowy-heavy","mdi:weather-lightning","mdi:weather-fog","mdi:weather-windy-variant","mdi:weather-hail","mdi:umbrella","mdi:sunglasses","mdi:moon-waning-crescent","mdi:sun-compass","mdi:thermometer-lines","mdi:waves","mdi:weather-tornado","mdi:weather-hurricane"]},{label:"Outdoor & Garden",color:"#8bc34a",icons:["mdi:tree","mdi:flower","mdi:flower-tulip","mdi:leaf","mdi:sprout","mdi:grass","mdi:mushroom","mdi:cactus","mdi:water","mdi:watering-can","mdi:sprinkler","mdi:sprinkler-variant","mdi:lawn-mower","mdi:shovel","mdi:rake","mdi:grill-outline","mdi:pool","mdi:hot-tub","mdi:fence","mdi:patio-heater"]},{label:"Appliances",color:"#78909c",icons:["mdi:washing-machine","mdi:tumble-dryer","mdi:iron","mdi:vacuum","mdi:vacuum-outline","mdi:robot-vacuum","mdi:water-boiler","mdi:water-heater","mdi:hair-dryer","mdi:printer-3d","mdi:printer","mdi:router-wireless","mdi:access-point","mdi:nas","mdi:server","mdi:cellphone","mdi:laptop","mdi:tablet","mdi:watch","mdi:keyboard"]},{label:"Transport",color:"#5c6bc0",icons:["mdi:car","mdi:car-electric","mdi:car-connected","mdi:car-door","mdi:garage-variant","mdi:bicycle","mdi:motorbike","mdi:scooter","mdi:bus","mdi:train","mdi:airplane","mdi:boat","mdi:parking","mdi:gas-station","mdi:ev-plug-type2","mdi:map-marker","mdi:compass","mdi:navigation","mdi:road","mdi:traffic-light"]},{label:"People & Home",color:"#ec407a",icons:["mdi:home","mdi:home-outline","mdi:home-variant","mdi:home-assistant","mdi:account","mdi:account-group","mdi:account-child","mdi:dog","mdi:cat","mdi:paw","mdi:baby-face-outline","mdi:human-male-female","mdi:human-greeting","mdi:hand-wave","mdi:phone","mdi:email","mdi:calendar","mdi:bell-alert","mdi:heart","mdi:star"]},{label:"Automation & System",color:"#78909c",icons:["mdi:cog","mdi:cog-outline","mdi:wrench","mdi:tools","mdi:auto-fix","mdi:robot","mdi:script-text","mdi:code-tags","mdi:webhook","mdi:api","mdi:cloud","mdi:database","mdi:update","mdi:reload","mdi:sync","mdi:timer","mdi:toggle-switch","mdi:numeric","mdi:form-select","mdi:palette","mdi:format-paint"]}],Ze=kt.flatMap(n=>n.icons.map(o=>({icon:o,color:n.color,category:n.label})));function Gt({value:n,onChange:o}){const[r,i]=h.useState(!1),[t,s]=h.useState(""),[a,l]=h.useState(null),c=h.useRef(null),m=h.useRef(null),[b,v]=h.useState({top:0,left:0});h.useEffect(()=>{if(r&&c.current){const u=c.current.getBoundingClientRect(),C=360,_=420;let E=u.bottom+6,L=u.left;L+C>window.innerWidth-8&&(L=window.innerWidth-C-8),E+_>window.innerHeight-8&&(E=u.top-_-6),v({top:Math.max(8,E),left:Math.max(8,L)})}},[r]),h.useEffect(()=>{if(!r)return;const u=C=>{m.current&&!m.current.contains(C.target)&&c.current&&!c.current.contains(C.target)&&i(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[r]),h.useEffect(()=>{if(!r)return;const u=C=>{C.key==="Escape"&&i(!1)};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[r]);const g=h.useMemo(()=>{const u=t.trim().toLowerCase();return!u&&!a?Ze:Ze.filter(C=>a&&C.category!==a?!1:u?C.icon.replace("mdi:","").replace(/-/g," ").includes(u)||C.category.toLowerCase().includes(u):!0)},[t,a]),f=n||"mdi:lightbulb";return e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:c,type:"button",className:"icon-picker-trigger",onClick:()=>i(!r),title:"Pick icon",children:e.jsx("img",{src:Ye(f,"#7da2ff"),width:22,height:22,alt:"",style:{display:"block"}})}),r&&He.createPortal(e.jsxs("div",{ref:m,className:"icon-picker-panel",style:{top:b.top,left:b.left},children:[e.jsx("div",{className:"icon-picker-search",children:e.jsx("input",{type:"text",placeholder:"Search icons...",value:t,onChange:u=>s(u.target.value),autoFocus:!0})}),e.jsxs("div",{className:"icon-picker-categories",children:[e.jsx("button",{type:"button",className:`icon-cat-tab${a?"":" active"}`,onClick:()=>l(null),style:{"--cat-color":"#aaa"},children:"All"}),kt.map(u=>e.jsx("button",{type:"button",className:`icon-cat-tab${a===u.label?" active":""}`,onClick:()=>l(a===u.label?null:u.label),style:{"--cat-color":u.color},title:u.label,children:u.label},u.label))]}),e.jsxs("div",{className:"icon-picker-grid",children:[g.map((u,C)=>e.jsx("button",{type:"button",className:`icon-picker-item${u.icon===n?" selected":""}`,onClick:()=>{o(u.icon),i(!1)},title:u.icon.replace("mdi:","").replace(/-/g," "),children:e.jsx("img",{src:Ye(u.icon,u.color),width:24,height:24,alt:u.icon.replace("mdi:",""),loading:"lazy",style:{display:"block"}})},`${u.icon}-${C}`)),g.length===0&&e.jsxs("p",{className:"icon-picker-empty",children:['No icons match "',t,'"']})]})]}),document.body)]})}function Wt({entityId:n,friendlyName:o,sessionId:r,anchorRect:i,onClose:t,onSave:s,onHide:a}){const[l,c]=h.useState(""),[m,b]=h.useState(""),[v,g]=h.useState(!0),[f,u]=h.useState(!1),[C,_]=h.useState(!1),[E,L]=h.useState(!0),[A,d]=h.useState(!0),[B,y]=h.useState(!0),[p,w]=h.useState(!1),[,N]=h.useState(0);h.useEffect(()=>{const M=["mdi:cog","mdi:eye-off"];m&&!ye(m)&&M.push(m),Ht(M,()=>N(X=>X+1))},[m]),h.useEffect(()=>{(async()=>{try{const M=await I(`/api/ui/entity-props/${encodeURIComponent(n)}`,{sessionId:r});c(M.props.custom_name||""),b(M.props.custom_icon||""),g(M.props.show_last_updated!==!1),u(M.props.hide_state===!0),_(M.props.hide_updated===!0),L(M.props.hide_attributes===!0),d(M.props.hide_logbook===!0)}catch{}finally{y(!1)}})()},[n,r]);const k=h.useCallback(async()=>{w(!0);try{await I(`/api/ui/entity-props/${encodeURIComponent(n)}`,{method:"POST",sessionId:r,body:JSON.stringify({custom_name:l.trim()||null,custom_icon:m||null,show_last_updated:v,hide_state:f,hide_updated:C,hide_attributes:E,hide_logbook:A})}),s(),t()}catch(M){console.error("Save entity props failed:",M)}finally{w(!1)}},[n,r,l,m,v,f,C,E,A,s,t]),S=h.useCallback(async()=>{try{await I(`/api/ui/entity-props/${encodeURIComponent(n)}`,{method:"DELETE",sessionId:r}),c(""),b(""),g(!0),u(!1),_(!1),L(!0),d(!0),s(),t()}catch(M){console.error("Reset entity props failed:",M)}},[n,r,s,t]),R=340,P=440;let T=i.bottom+8,q=i.left-R/2+i.width/2;return q+R>window.innerWidth-8&&(q=window.innerWidth-R-8),q<8&&(q=8),T+P>window.innerHeight-8&&(T=i.top-P-8),He.createPortal(e.jsx("div",{className:"entity-prop-overlay",onClick:t,children:e.jsx("div",{className:"entity-prop-editor",style:{top:T,left:q,width:R},onClick:M=>M.stopPropagation(),children:B?e.jsx("p",{className:"note",style:{textAlign:"center",padding:"1rem"},children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"entity-prop-header",children:[ye("mdi:cog")?e.jsx(Ge,{icon:"mdi:cog",width:16,height:16}):e.jsx("span",{children:"‚öô"}),e.jsx("span",{className:"entity-prop-title",children:o}),e.jsx("button",{type:"button",className:"entity-prop-close",onClick:t,children:"√ó"})]}),e.jsxs("div",{className:"entity-prop-body",children:[e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Icon"}),e.jsxs("div",{className:"entity-prop-icon-row",children:[e.jsx(Gt,{value:m,onChange:b}),m&&e.jsx("span",{className:"entity-prop-icon-name",children:m.replace("mdi:","")}),m&&e.jsx("button",{type:"button",className:"entity-prop-clear-btn",onClick:()=>b(""),title:"Clear icon override",children:"√ó"})]})]}),e.jsxs("div",{className:"entity-prop-field",children:[e.jsx("label",{children:"Display Name"}),e.jsx("input",{type:"text",value:l,onChange:M=>c(M.target.value),placeholder:o,className:"entity-prop-input"})]}),e.jsx("div",{className:"entity-prop-section-label",children:"Card Display"}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`slu-${n}`,children:"Show last updated"}),e.jsx("input",{id:`slu-${n}`,type:"checkbox",checked:v,onChange:M=>g(M.target.checked)})]}),e.jsx("div",{className:"entity-prop-section-label",children:"Detail Dialog"}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hs-${n}`,children:"Hide state"}),e.jsx("input",{id:`hs-${n}`,type:"checkbox",checked:f,onChange:M=>u(M.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hu-${n}`,children:"Hide last updated"}),e.jsx("input",{id:`hu-${n}`,type:"checkbox",checked:C,onChange:M=>_(M.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`ha-${n}`,children:"Hide attributes"}),e.jsx("input",{id:`ha-${n}`,type:"checkbox",checked:E,onChange:M=>L(M.target.checked)})]}),e.jsxs("div",{className:"entity-prop-toggle-row",children:[e.jsx("label",{htmlFor:`hl-${n}`,children:"Hide logbook"}),e.jsx("input",{id:`hl-${n}`,type:"checkbox",checked:A,onChange:M=>d(M.target.checked)})]})]}),e.jsxs("div",{className:"entity-prop-actions",children:[e.jsxs("button",{type:"button",className:"entity-prop-hide-btn",onClick:()=>{a(),t()},title:"Hide this entity",children:[ye("mdi:eye-off")?e.jsx(Ge,{icon:"mdi:eye-off",width:14,height:14}):e.jsx("span",{children:"üëÅ"})," Hide"]}),e.jsx("div",{style:{flex:1}}),e.jsx("button",{type:"button",className:"entity-prop-reset-btn",onClick:S,children:"Reset"}),e.jsx("button",{type:"button",className:"entity-prop-save-btn",onClick:k,disabled:p,children:p?"...":"Save"})]})]})})}),document.body)}var he={},be,Xe;function Qt(){return Xe||(Xe=1,be=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),be}var we={},ie={},$e;function ae(){if($e)return ie;$e=1;let n;const o=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return ie.getSymbolSize=function(i){if(!i)throw new Error('"version" cannot be null or undefined');if(i<1||i>40)throw new Error('"version" should be in range from 1 to 40');return i*4+17},ie.getSymbolTotalCodewords=function(i){return o[i]},ie.getBCHDigit=function(r){let i=0;for(;r!==0;)i++,r>>>=1;return i},ie.setToSJISFunction=function(i){if(typeof i!="function")throw new Error('"toSJISFunc" is not a valid function.');n=i},ie.isKanjiModeEnabled=function(){return typeof n<"u"},ie.toSJIS=function(i){return n(i)},ie}var Ne={},et;function qe(){return et||(et=1,(function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function o(r){if(typeof r!="string")throw new Error("Param is not a string");switch(r.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+r)}}n.isValid=function(i){return i&&typeof i.bit<"u"&&i.bit>=0&&i.bit<4},n.from=function(i,t){if(n.isValid(i))return i;try{return o(i)}catch{return t}}})(Ne)),Ne}var ve,tt;function Yt(){if(tt)return ve;tt=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(o){const r=Math.floor(o/8);return(this.buffer[r]>>>7-o%8&1)===1},put:function(o,r){for(let i=0;i<r;i++)this.putBit((o>>>r-i-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(o){const r=Math.floor(this.length/8);this.buffer.length<=r&&this.buffer.push(0),o&&(this.buffer[r]|=128>>>this.length%8),this.length++}},ve=n,ve}var Ce,nt;function Zt(){if(nt)return Ce;nt=1;function n(o){if(!o||o<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=o,this.data=new Uint8Array(o*o),this.reservedBit=new Uint8Array(o*o)}return n.prototype.set=function(o,r,i,t){const s=o*this.size+r;this.data[s]=i,t&&(this.reservedBit[s]=!0)},n.prototype.get=function(o,r){return this.data[o*this.size+r]},n.prototype.xor=function(o,r,i){this.data[o*this.size+r]^=i},n.prototype.isReserved=function(o,r){return this.reservedBit[o*this.size+r]},Ce=n,Ce}var xe={},it;function Xt(){return it||(it=1,(function(n){const o=ae().getSymbolSize;n.getRowColCoords=function(i){if(i===1)return[];const t=Math.floor(i/7)+2,s=o(i),a=s===145?26:Math.ceil((s-13)/(2*t-2))*2,l=[s-7];for(let c=1;c<t-1;c++)l[c]=l[c-1]-a;return l.push(6),l.reverse()},n.getPositions=function(i){const t=[],s=n.getRowColCoords(i),a=s.length;for(let l=0;l<a;l++)for(let c=0;c<a;c++)l===0&&c===0||l===0&&c===a-1||l===a-1&&c===0||t.push([s[l],s[c]]);return t}})(xe)),xe}var je={},st;function $t(){if(st)return je;st=1;const n=ae().getSymbolSize,o=7;return je.getPositions=function(i){const t=n(i);return[[0,0],[t-o,0],[0,t-o]]},je}var Se={},ot;function en(){return ot||(ot=1,(function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const o={N1:3,N2:3,N3:40,N4:10};n.isValid=function(t){return t!=null&&t!==""&&!isNaN(t)&&t>=0&&t<=7},n.from=function(t){return n.isValid(t)?parseInt(t,10):void 0},n.getPenaltyN1=function(t){const s=t.size;let a=0,l=0,c=0,m=null,b=null;for(let v=0;v<s;v++){l=c=0,m=b=null;for(let g=0;g<s;g++){let f=t.get(v,g);f===m?l++:(l>=5&&(a+=o.N1+(l-5)),m=f,l=1),f=t.get(g,v),f===b?c++:(c>=5&&(a+=o.N1+(c-5)),b=f,c=1)}l>=5&&(a+=o.N1+(l-5)),c>=5&&(a+=o.N1+(c-5))}return a},n.getPenaltyN2=function(t){const s=t.size;let a=0;for(let l=0;l<s-1;l++)for(let c=0;c<s-1;c++){const m=t.get(l,c)+t.get(l,c+1)+t.get(l+1,c)+t.get(l+1,c+1);(m===4||m===0)&&a++}return a*o.N2},n.getPenaltyN3=function(t){const s=t.size;let a=0,l=0,c=0;for(let m=0;m<s;m++){l=c=0;for(let b=0;b<s;b++)l=l<<1&2047|t.get(m,b),b>=10&&(l===1488||l===93)&&a++,c=c<<1&2047|t.get(b,m),b>=10&&(c===1488||c===93)&&a++}return a*o.N3},n.getPenaltyN4=function(t){let s=0;const a=t.data.length;for(let c=0;c<a;c++)s+=t.data[c];return Math.abs(Math.ceil(s*100/a/5)-10)*o.N4};function r(i,t,s){switch(i){case n.Patterns.PATTERN000:return(t+s)%2===0;case n.Patterns.PATTERN001:return t%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(t+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(t/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return t*s%2+t*s%3===0;case n.Patterns.PATTERN110:return(t*s%2+t*s%3)%2===0;case n.Patterns.PATTERN111:return(t*s%3+(t+s)%2)%2===0;default:throw new Error("bad maskPattern:"+i)}}n.applyMask=function(t,s){const a=s.size;for(let l=0;l<a;l++)for(let c=0;c<a;c++)s.isReserved(c,l)||s.xor(c,l,r(t,c,l))},n.getBestMask=function(t,s){const a=Object.keys(n.Patterns).length;let l=0,c=1/0;for(let m=0;m<a;m++){s(m),n.applyMask(m,t);const b=n.getPenaltyN1(t)+n.getPenaltyN2(t)+n.getPenaltyN3(t)+n.getPenaltyN4(t);n.applyMask(m,t),b<c&&(c=b,l=m)}return l}})(Se)),Se}var ge={},rt;function At(){if(rt)return ge;rt=1;const n=qe(),o=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],r=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return ge.getBlocksCount=function(t,s){switch(s){case n.L:return o[(t-1)*4+0];case n.M:return o[(t-1)*4+1];case n.Q:return o[(t-1)*4+2];case n.H:return o[(t-1)*4+3];default:return}},ge.getTotalCodewordsCount=function(t,s){switch(s){case n.L:return r[(t-1)*4+0];case n.M:return r[(t-1)*4+1];case n.Q:return r[(t-1)*4+2];case n.H:return r[(t-1)*4+3];default:return}},ge}var Ee={},me={},at;function tn(){if(at)return me;at=1;const n=new Uint8Array(512),o=new Uint8Array(256);return(function(){let i=1;for(let t=0;t<255;t++)n[t]=i,o[i]=t,i<<=1,i&256&&(i^=285);for(let t=255;t<512;t++)n[t]=n[t-255]})(),me.log=function(i){if(i<1)throw new Error("log("+i+")");return o[i]},me.exp=function(i){return n[i]},me.mul=function(i,t){return i===0||t===0?0:n[o[i]+o[t]]},me}var lt;function nn(){return lt||(lt=1,(function(n){const o=tn();n.mul=function(i,t){const s=new Uint8Array(i.length+t.length-1);for(let a=0;a<i.length;a++)for(let l=0;l<t.length;l++)s[a+l]^=o.mul(i[a],t[l]);return s},n.mod=function(i,t){let s=new Uint8Array(i);for(;s.length-t.length>=0;){const a=s[0];for(let c=0;c<t.length;c++)s[c]^=o.mul(t[c],a);let l=0;for(;l<s.length&&s[l]===0;)l++;s=s.slice(l)}return s},n.generateECPolynomial=function(i){let t=new Uint8Array([1]);for(let s=0;s<i;s++)t=n.mul(t,new Uint8Array([1,o.exp(s)]));return t}})(Ee)),Ee}var ke,ct;function sn(){if(ct)return ke;ct=1;const n=nn();function o(r){this.genPoly=void 0,this.degree=r,this.degree&&this.initialize(this.degree)}return o.prototype.initialize=function(i){this.degree=i,this.genPoly=n.generateECPolynomial(this.degree)},o.prototype.encode=function(i){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(i.length+this.degree);t.set(i);const s=n.mod(t,this.genPoly),a=this.degree-s.length;if(a>0){const l=new Uint8Array(this.degree);return l.set(s,a),l}return s},ke=o,ke}var Ae={},Pe={},Re={},dt;function Pt(){return dt||(dt=1,Re.isValid=function(o){return!isNaN(o)&&o>=1&&o<=40}),Re}var ee={},ut;function Rt(){if(ut)return ee;ut=1;const n="[0-9]+",o="[A-Z $%*+\\-./:]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+`)(?:.|[\r
]))+`;ee.KANJI=new RegExp(r,"g"),ee.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ee.BYTE=new RegExp(i,"g"),ee.NUMERIC=new RegExp(n,"g"),ee.ALPHANUMERIC=new RegExp(o,"g");const t=new RegExp("^"+r+"$"),s=new RegExp("^"+n+"$"),a=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ee.testKanji=function(c){return t.test(c)},ee.testNumeric=function(c){return s.test(c)},ee.testAlphanumeric=function(c){return a.test(c)},ee}var ht;function le(){return ht||(ht=1,(function(n){const o=Pt(),r=Rt();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,a){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!o.isValid(a))throw new Error("Invalid version: "+a);return a>=1&&a<10?s.ccBits[0]:a<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return r.testNumeric(s)?n.NUMERIC:r.testAlphanumeric(s)?n.ALPHANUMERIC:r.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function i(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+t)}}n.from=function(s,a){if(n.isValid(s))return s;try{return i(s)}catch{return a}}})(Pe)),Pe}var mt;function on(){return mt||(mt=1,(function(n){const o=ae(),r=At(),i=qe(),t=le(),s=Pt(),a=7973,l=o.getBCHDigit(a);function c(g,f,u){for(let C=1;C<=40;C++)if(f<=n.getCapacity(C,u,g))return C}function m(g,f){return t.getCharCountIndicator(g,f)+4}function b(g,f){let u=0;return g.forEach(function(C){const _=m(C.mode,f);u+=_+C.getBitsLength()}),u}function v(g,f){for(let u=1;u<=40;u++)if(b(g,u)<=n.getCapacity(u,f,t.MIXED))return u}n.from=function(f,u){return s.isValid(f)?parseInt(f,10):u},n.getCapacity=function(f,u,C){if(!s.isValid(f))throw new Error("Invalid QR Code version");typeof C>"u"&&(C=t.BYTE);const _=o.getSymbolTotalCodewords(f),E=r.getTotalCodewordsCount(f,u),L=(_-E)*8;if(C===t.MIXED)return L;const A=L-m(C,f);switch(C){case t.NUMERIC:return Math.floor(A/10*3);case t.ALPHANUMERIC:return Math.floor(A/11*2);case t.KANJI:return Math.floor(A/13);case t.BYTE:default:return Math.floor(A/8)}},n.getBestVersionForData=function(f,u){let C;const _=i.from(u,i.M);if(Array.isArray(f)){if(f.length>1)return v(f,_);if(f.length===0)return 1;C=f[0]}else C=f;return c(C.mode,C.getLength(),_)},n.getEncodedBits=function(f){if(!s.isValid(f)||f<7)throw new Error("Invalid QR Code version");let u=f<<12;for(;o.getBCHDigit(u)-l>=0;)u^=a<<o.getBCHDigit(u)-l;return f<<12|u}})(Ae)),Ae}var Te={},ft;function rn(){if(ft)return Te;ft=1;const n=ae(),o=1335,r=21522,i=n.getBCHDigit(o);return Te.getEncodedBits=function(s,a){const l=s.bit<<3|a;let c=l<<10;for(;n.getBCHDigit(c)-i>=0;)c^=o<<n.getBCHDigit(c)-i;return(l<<10|c)^r},Te}var Le={},Be,gt;function an(){if(gt)return Be;gt=1;const n=le();function o(r){this.mode=n.NUMERIC,this.data=r.toString()}return o.getBitsLength=function(i){return 10*Math.floor(i/3)+(i%3?i%3*3+1:0)},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(i){let t,s,a;for(t=0;t+3<=this.data.length;t+=3)s=this.data.substr(t,3),a=parseInt(s,10),i.put(a,10);const l=this.data.length-t;l>0&&(s=this.data.substr(t),a=parseInt(s,10),i.put(a,l*3+1))},Be=o,Be}var Me,pt;function ln(){if(pt)return Me;pt=1;const n=le(),o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function r(i){this.mode=n.ALPHANUMERIC,this.data=i}return r.getBitsLength=function(t){return 11*Math.floor(t/2)+6*(t%2)},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(t){let s;for(s=0;s+2<=this.data.length;s+=2){let a=o.indexOf(this.data[s])*45;a+=o.indexOf(this.data[s+1]),t.put(a,11)}this.data.length%2&&t.put(o.indexOf(this.data[s]),6)},Me=r,Me}var _e,yt;function cn(){if(yt)return _e;yt=1;const n=le();function o(r){this.mode=n.BYTE,typeof r=="string"?this.data=new TextEncoder().encode(r):this.data=new Uint8Array(r)}return o.getBitsLength=function(i){return i*8},o.prototype.getLength=function(){return this.data.length},o.prototype.getBitsLength=function(){return o.getBitsLength(this.data.length)},o.prototype.write=function(r){for(let i=0,t=this.data.length;i<t;i++)r.put(this.data[i],8)},_e=o,_e}var De,bt;function dn(){if(bt)return De;bt=1;const n=le(),o=ae();function r(i){this.mode=n.KANJI,this.data=i}return r.getBitsLength=function(t){return t*13},r.prototype.getLength=function(){return this.data.length},r.prototype.getBitsLength=function(){return r.getBitsLength(this.data.length)},r.prototype.write=function(i){let t;for(t=0;t<this.data.length;t++){let s=o.toSJIS(this.data[t]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[t]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),i.put(s,13)}},De=r,De}var Ie={exports:{}},wt;function un(){return wt||(wt=1,(function(n){var o={single_source_shortest_paths:function(r,i,t){var s={},a={};a[i]=0;var l=o.PriorityQueue.make();l.push(i,0);for(var c,m,b,v,g,f,u,C,_;!l.empty();){c=l.pop(),m=c.value,v=c.cost,g=r[m]||{};for(b in g)g.hasOwnProperty(b)&&(f=g[b],u=v+f,C=a[b],_=typeof a[b]>"u",(_||C>u)&&(a[b]=u,l.push(b,u),s[b]=m))}if(typeof t<"u"&&typeof a[t]>"u"){var E=["Could not find a path from ",i," to ",t,"."].join("");throw new Error(E)}return s},extract_shortest_path_from_predecessor_list:function(r,i){for(var t=[],s=i;s;)t.push(s),r[s],s=r[s];return t.reverse(),t},find_path:function(r,i,t){var s=o.single_source_shortest_paths(r,i,t);return o.extract_shortest_path_from_predecessor_list(s,t)},PriorityQueue:{make:function(r){var i=o.PriorityQueue,t={},s;r=r||{};for(s in i)i.hasOwnProperty(s)&&(t[s]=i[s]);return t.queue=[],t.sorter=r.sorter||i.default_sorter,t},default_sorter:function(r,i){return r.cost-i.cost},push:function(r,i){var t={value:r,cost:i};this.queue.push(t),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=o})(Ie)),Ie.exports}var Nt;function hn(){return Nt||(Nt=1,(function(n){const o=le(),r=an(),i=ln(),t=cn(),s=dn(),a=Rt(),l=ae(),c=un();function m(E){return unescape(encodeURIComponent(E)).length}function b(E,L,A){const d=[];let B;for(;(B=E.exec(A))!==null;)d.push({data:B[0],index:B.index,mode:L,length:B[0].length});return d}function v(E){const L=b(a.NUMERIC,o.NUMERIC,E),A=b(a.ALPHANUMERIC,o.ALPHANUMERIC,E);let d,B;return l.isKanjiModeEnabled()?(d=b(a.BYTE,o.BYTE,E),B=b(a.KANJI,o.KANJI,E)):(d=b(a.BYTE_KANJI,o.BYTE,E),B=[]),L.concat(A,d,B).sort(function(p,w){return p.index-w.index}).map(function(p){return{data:p.data,mode:p.mode,length:p.length}})}function g(E,L){switch(L){case o.NUMERIC:return r.getBitsLength(E);case o.ALPHANUMERIC:return i.getBitsLength(E);case o.KANJI:return s.getBitsLength(E);case o.BYTE:return t.getBitsLength(E)}}function f(E){return E.reduce(function(L,A){const d=L.length-1>=0?L[L.length-1]:null;return d&&d.mode===A.mode?(L[L.length-1].data+=A.data,L):(L.push(A),L)},[])}function u(E){const L=[];for(let A=0;A<E.length;A++){const d=E[A];switch(d.mode){case o.NUMERIC:L.push([d,{data:d.data,mode:o.ALPHANUMERIC,length:d.length},{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.ALPHANUMERIC:L.push([d,{data:d.data,mode:o.BYTE,length:d.length}]);break;case o.KANJI:L.push([d,{data:d.data,mode:o.BYTE,length:m(d.data)}]);break;case o.BYTE:L.push([{data:d.data,mode:o.BYTE,length:m(d.data)}])}}return L}function C(E,L){const A={},d={start:{}};let B=["start"];for(let y=0;y<E.length;y++){const p=E[y],w=[];for(let N=0;N<p.length;N++){const k=p[N],S=""+y+N;w.push(S),A[S]={node:k,lastCount:0},d[S]={};for(let R=0;R<B.length;R++){const P=B[R];A[P]&&A[P].node.mode===k.mode?(d[P][S]=g(A[P].lastCount+k.length,k.mode)-g(A[P].lastCount,k.mode),A[P].lastCount+=k.length):(A[P]&&(A[P].lastCount=k.length),d[P][S]=g(k.length,k.mode)+4+o.getCharCountIndicator(k.mode,L))}}B=w}for(let y=0;y<B.length;y++)d[B[y]].end=0;return{map:d,table:A}}function _(E,L){let A;const d=o.getBestModeForData(E);if(A=o.from(L,d),A!==o.BYTE&&A.bit<d.bit)throw new Error('"'+E+'" cannot be encoded with mode '+o.toString(A)+`.
 Suggested mode is: `+o.toString(d));switch(A===o.KANJI&&!l.isKanjiModeEnabled()&&(A=o.BYTE),A){case o.NUMERIC:return new r(E);case o.ALPHANUMERIC:return new i(E);case o.KANJI:return new s(E);case o.BYTE:return new t(E)}}n.fromArray=function(L){return L.reduce(function(A,d){return typeof d=="string"?A.push(_(d,null)):d.data&&A.push(_(d.data,d.mode)),A},[])},n.fromString=function(L,A){const d=v(L,l.isKanjiModeEnabled()),B=u(d),y=C(B,A),p=c.find_path(y.map,"start","end"),w=[];for(let N=1;N<p.length-1;N++)w.push(y.table[p[N]].node);return n.fromArray(f(w))},n.rawSplit=function(L){return n.fromArray(v(L,l.isKanjiModeEnabled()))}})(Le)),Le}var vt;function mn(){if(vt)return we;vt=1;const n=ae(),o=qe(),r=Yt(),i=Zt(),t=Xt(),s=$t(),a=en(),l=At(),c=sn(),m=on(),b=rn(),v=le(),g=hn();function f(y,p){const w=y.size,N=s.getPositions(p);for(let k=0;k<N.length;k++){const S=N[k][0],R=N[k][1];for(let P=-1;P<=7;P++)if(!(S+P<=-1||w<=S+P))for(let T=-1;T<=7;T++)R+T<=-1||w<=R+T||(P>=0&&P<=6&&(T===0||T===6)||T>=0&&T<=6&&(P===0||P===6)||P>=2&&P<=4&&T>=2&&T<=4?y.set(S+P,R+T,!0,!0):y.set(S+P,R+T,!1,!0))}}function u(y){const p=y.size;for(let w=8;w<p-8;w++){const N=w%2===0;y.set(w,6,N,!0),y.set(6,w,N,!0)}}function C(y,p){const w=t.getPositions(p);for(let N=0;N<w.length;N++){const k=w[N][0],S=w[N][1];for(let R=-2;R<=2;R++)for(let P=-2;P<=2;P++)R===-2||R===2||P===-2||P===2||R===0&&P===0?y.set(k+R,S+P,!0,!0):y.set(k+R,S+P,!1,!0)}}function _(y,p){const w=y.size,N=m.getEncodedBits(p);let k,S,R;for(let P=0;P<18;P++)k=Math.floor(P/3),S=P%3+w-8-3,R=(N>>P&1)===1,y.set(k,S,R,!0),y.set(S,k,R,!0)}function E(y,p,w){const N=y.size,k=b.getEncodedBits(p,w);let S,R;for(S=0;S<15;S++)R=(k>>S&1)===1,S<6?y.set(S,8,R,!0):S<8?y.set(S+1,8,R,!0):y.set(N-15+S,8,R,!0),S<8?y.set(8,N-S-1,R,!0):S<9?y.set(8,15-S-1+1,R,!0):y.set(8,15-S-1,R,!0);y.set(N-8,8,1,!0)}function L(y,p){const w=y.size;let N=-1,k=w-1,S=7,R=0;for(let P=w-1;P>0;P-=2)for(P===6&&P--;;){for(let T=0;T<2;T++)if(!y.isReserved(k,P-T)){let q=!1;R<p.length&&(q=(p[R]>>>S&1)===1),y.set(k,P-T,q),S--,S===-1&&(R++,S=7)}if(k+=N,k<0||w<=k){k-=N,N=-N;break}}}function A(y,p,w){const N=new r;w.forEach(function(T){N.put(T.mode.bit,4),N.put(T.getLength(),v.getCharCountIndicator(T.mode,y)),T.write(N)});const k=n.getSymbolTotalCodewords(y),S=l.getTotalCodewordsCount(y,p),R=(k-S)*8;for(N.getLengthInBits()+4<=R&&N.put(0,4);N.getLengthInBits()%8!==0;)N.putBit(0);const P=(R-N.getLengthInBits())/8;for(let T=0;T<P;T++)N.put(T%2?17:236,8);return d(N,y,p)}function d(y,p,w){const N=n.getSymbolTotalCodewords(p),k=l.getTotalCodewordsCount(p,w),S=N-k,R=l.getBlocksCount(p,w),P=N%R,T=R-P,q=Math.floor(N/R),M=Math.floor(S/R),X=M+1,Y=q-M,ne=new c(Y);let W=0;const te=new Array(R),se=new Array(R);let Z=0;const ce=new Uint8Array(y.buffer);for(let G=0;G<R;G++){const x=G<T?M:X;te[G]=ce.slice(W,W+x),se[G]=ne.encode(te[G]),W+=x,Z=Math.max(Z,x)}const $=new Uint8Array(N);let oe=0,Q,V;for(Q=0;Q<Z;Q++)for(V=0;V<R;V++)Q<te[V].length&&($[oe++]=te[V][Q]);for(Q=0;Q<Y;Q++)for(V=0;V<R;V++)$[oe++]=se[V][Q];return $}function B(y,p,w,N){let k;if(Array.isArray(y))k=g.fromArray(y);else if(typeof y=="string"){let q=p;if(!q){const M=g.rawSplit(y);q=m.getBestVersionForData(M,w)}k=g.fromString(y,q||40)}else throw new Error("Invalid data");const S=m.getBestVersionForData(k,w);if(!S)throw new Error("The amount of data is too big to be stored in a QR Code");if(!p)p=S;else if(p<S)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+S+`.
`);const R=A(p,w,k),P=n.getSymbolSize(p),T=new i(P);return f(T,p),u(T),C(T,p),E(T,w,0),p>=7&&_(T,p),L(T,R),isNaN(N)&&(N=a.getBestMask(T,E.bind(null,T,w))),a.applyMask(N,T),E(T,w,N),{modules:T,version:p,errorCorrectionLevel:w,maskPattern:N,segments:k}}return we.create=function(p,w){if(typeof p>"u"||p==="")throw new Error("No input text");let N=o.M,k,S;return typeof w<"u"&&(N=o.from(w.errorCorrectionLevel,o.M),k=m.from(w.version),S=a.from(w.maskPattern),w.toSJISFunc&&n.setToSJISFunction(w.toSJISFunc)),B(p,k,N,S)},we}var Ue={},Oe={},Ct;function Tt(){return Ct||(Ct=1,(function(n){function o(r){if(typeof r=="number"&&(r=r.toString()),typeof r!="string")throw new Error("Color should be defined as hex string");let i=r.slice().replace("#","").split("");if(i.length<3||i.length===5||i.length>8)throw new Error("Invalid hex color: "+r);(i.length===3||i.length===4)&&(i=Array.prototype.concat.apply([],i.map(function(s){return[s,s]}))),i.length===6&&i.push("F","F");const t=parseInt(i.join(""),16);return{r:t>>24&255,g:t>>16&255,b:t>>8&255,a:t&255,hex:"#"+i.slice(0,6).join("")}}n.getOptions=function(i){i||(i={}),i.color||(i.color={});const t=typeof i.margin>"u"||i.margin===null||i.margin<0?4:i.margin,s=i.width&&i.width>=21?i.width:void 0,a=i.scale||4;return{width:s,scale:s?4:a,margin:t,color:{dark:o(i.color.dark||"#000000ff"),light:o(i.color.light||"#ffffffff")},type:i.type,rendererOpts:i.rendererOpts||{}}},n.getScale=function(i,t){return t.width&&t.width>=i+t.margin*2?t.width/(i+t.margin*2):t.scale},n.getImageWidth=function(i,t){const s=n.getScale(i,t);return Math.floor((i+t.margin*2)*s)},n.qrToImageData=function(i,t,s){const a=t.modules.size,l=t.modules.data,c=n.getScale(a,s),m=Math.floor((a+s.margin*2)*c),b=s.margin*c,v=[s.color.light,s.color.dark];for(let g=0;g<m;g++)for(let f=0;f<m;f++){let u=(g*m+f)*4,C=s.color.light;if(g>=b&&f>=b&&g<m-b&&f<m-b){const _=Math.floor((g-b)/c),E=Math.floor((f-b)/c);C=v[l[_*a+E]?1:0]}i[u++]=C.r,i[u++]=C.g,i[u++]=C.b,i[u]=C.a}}})(Oe)),Oe}var xt;function fn(){return xt||(xt=1,(function(n){const o=Tt();function r(t,s,a){t.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=a,s.width=a,s.style.height=a+"px",s.style.width=a+"px"}function i(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,a,l){let c=l,m=a;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),a||(m=i()),c=o.getOptions(c);const b=o.getImageWidth(s.modules.size,c),v=m.getContext("2d"),g=v.createImageData(b,b);return o.qrToImageData(g.data,s,c),r(v,m,b),v.putImageData(g,0,0),m},n.renderToDataURL=function(s,a,l){let c=l;typeof c>"u"&&(!a||!a.getContext)&&(c=a,a=void 0),c||(c={});const m=n.render(s,a,c),b=c.type||"image/png",v=c.rendererOpts||{};return m.toDataURL(b,v.quality)}})(Ue)),Ue}var Fe={},jt;function gn(){if(jt)return Fe;jt=1;const n=Tt();function o(t,s){const a=t.a/255,l=s+'="'+t.hex+'"';return a<1?l+" "+s+'-opacity="'+a.toFixed(2).slice(1)+'"':l}function r(t,s,a){let l=t+s;return typeof a<"u"&&(l+=" "+a),l}function i(t,s,a){let l="",c=0,m=!1,b=0;for(let v=0;v<t.length;v++){const g=Math.floor(v%s),f=Math.floor(v/s);!g&&!m&&(m=!0),t[v]?(b++,v>0&&g>0&&t[v-1]||(l+=m?r("M",g+a,.5+f+a):r("m",c,0),c=0,m=!1),g+1<s&&t[v+1]||(l+=r("h",b),b=0)):c++}return l}return Fe.render=function(s,a,l){const c=n.getOptions(a),m=s.modules.size,b=s.modules.data,v=m+c.margin*2,g=c.color.light.a?"<path "+o(c.color.light,"fill")+' d="M0 0h'+v+"v"+v+'H0z"/>':"",f="<path "+o(c.color.dark,"stroke")+' d="'+i(b,m,c.margin)+'"/>',u='viewBox="0 0 '+v+" "+v+'"',_='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+u+' shape-rendering="crispEdges">'+g+f+`</svg>
`;return typeof l=="function"&&l(null,_),_},Fe}var St;function pn(){if(St)return he;St=1;const n=Qt(),o=mn(),r=fn(),i=gn();function t(s,a,l,c,m){const b=[].slice.call(arguments,1),v=b.length,g=typeof b[v-1]=="function";if(!g&&!n())throw new Error("Callback required as last argument");if(g){if(v<2)throw new Error("Too few arguments provided");v===2?(m=l,l=a,a=c=void 0):v===3&&(a.getContext&&typeof m>"u"?(m=c,c=void 0):(m=c,c=l,l=a,a=void 0))}else{if(v<1)throw new Error("Too few arguments provided");return v===1?(l=a,a=c=void 0):v===2&&!a.getContext&&(c=l,l=a,a=void 0),new Promise(function(f,u){try{const C=o.create(l,c);f(s(C,a,c))}catch(C){u(C)}})}try{const f=o.create(l,c);m(null,s(f,a,c))}catch(f){m(f)}}return he.create=o.create,he.toCanvas=t.bind(null,r.render),he.toDataURL=t.bind(null,r.renderToDataURL),he.toString=t.bind(null,function(s,a,l){return i.render(s,l)}),he}var yn=pn();const bn=Ot(yn);function wn({sessionId:n,hassUrl:o,hassToken:r,onLogout:i}){const[t,s]=h.useState([]),[a,l]=h.useState(new Set),[c,m]=h.useState("LobbyHA"),[b,v]=h.useState(!1),[g,f]=h.useState(""),[u,C]=h.useState(!0),[_,E]=h.useState(!1),[L,A]=h.useState(!1),[d,B]=h.useState(!1),[y,p]=h.useState(!1),[w,N]=h.useState(!1),[k,S]=h.useState(!1),[R,P]=h.useState(!1),[T,q]=h.useState({}),[M,X]=h.useState(null),[Y,ne]=h.useState(null),[W,te]=h.useState(""),[se,Z]=h.useState(""),[ce,$]=h.useState(null),[oe,Q]=h.useState(null),V=h.useRef(null),G=h.useCallback(async(j=!1)=>{j||C(!0);try{const[O,D,F,U]=await Promise.all([I("/api/ui/modules",{sessionId:n}),I("/api/ui/hidden",{sessionId:n}),I("/api/ui/guest-entities",{sessionId:n}),I("/api/ui/entity-props",{sessionId:n})]);s(O.modules),l(new Set(D.hidden)),m(F.title||"LobbyHA");const H={};for(const z of U.props)H[z.entity_id]=z;q(H)}catch{}finally{j||C(!1)}},[n]);h.useEffect(()=>{G()},[G]),h.useEffect(()=>{if(!k)return;const j=O=>{V.current&&!V.current.contains(O.target)&&S(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[k]);const x=()=>{f(c),v(!0)},J=async()=>{const j=g.trim()||"LobbyHA";m(j),v(!1),await I("/api/ui/guest-entities",{method:"POST",sessionId:n,body:JSON.stringify({title:j})})},K=async j=>{const O=new Set(a);O.add(j),l(O),await I("/api/ui/hidden",{method:"POST",sessionId:n,body:JSON.stringify({hidden:Array.from(O)})})},Lt=async j=>{const O=new Set(a);O.delete(j),l(O),await I("/api/ui/hidden",{method:"POST",sessionId:n,body:JSON.stringify({hidden:Array.from(O)})})},Bt=async(j,O)=>{const D=t.find(F=>F.entities.includes(j));if(D){const F=D.entities.filter(U=>U!==j);s(U=>U.map(H=>H.id===D.id?{...H,entities:F}:H)),await I(`/api/ui/modules/${D.id}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})})}if(O!==null){const F=t.find(U=>U.id===O);if(F){const U=[...F.entities.filter(H=>H!==j),j];s(H=>H.map(z=>z.id===F.id?{...z,entities:U}:z)),await I(`/api/ui/modules/${F.id}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:U})})}}G(!0)},ze=async(j,O,D)=>{const F=t.find(de=>de.id===j);if(!F)return;const U=[...F.entities],H=U.indexOf(O);if(H<0)return;const z=D==="up"?H-1:H+1;z<0||z>=U.length||([U[H],U[z]]=[U[z],U[H]],s(de=>de.map(ue=>ue.id===j?{...ue,entities:U}:ue)),await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:U})}))},[re,fe]=h.useState(null),Mt=async(j,O)=>{if(!re||re.moduleId!==j){fe(null);return}const D=t.find(H=>H.id===j);if(!D)return;const F=[...D.entities],U=F.indexOf(re.entityId);U<0||(F.splice(U,1),F.splice(O,0,re.entityId),s(H=>H.map(z=>z.id===j?{...z,entities:F}:z)),fe(null),await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})}))},_t=async()=>{const j=new URL("./",window.location.href).toString();try{const O=await bn.toDataURL(j,{width:256,margin:2});Q(O),N(!0)}catch(O){console.error("Failed to generate QR code:",O)}},Dt=async()=>{$(null);try{await I("/api/admin/change-password",{method:"POST",sessionId:n,body:JSON.stringify({currentPassword:W,newPassword:se})}),$("Password changed!"),te(""),Z("")}catch(j){$(j instanceof Error?j.message:"Failed")}},It=async(j,O)=>{const D=t.find(U=>U.id===j);if(!D)return;const F=D.entities.filter(U=>U!==O);await I(`/api/ui/modules/${j}/entities`,{method:"POST",sessionId:n,body:JSON.stringify({entities:F})}),G()};return u?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading dashboard..."})}):e.jsxs("div",{className:"admin-layout",children:[e.jsxs("header",{className:"admin-header",children:[e.jsxs("div",{className:"header-left",children:[b?e.jsxs("span",{className:"title-edit",children:[e.jsx("input",{className:"title-input",value:g,onChange:j=>f(j.target.value),onKeyDown:j=>{j.key==="Enter"&&J(),j.key==="Escape"&&v(!1)},autoFocus:!0}),e.jsx("button",{type:"button",className:"action-button",onClick:J,children:"‚úì"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>v(!1),children:"‚úï"})]}):e.jsx("h1",{className:"dashboard-title",onClick:x,title:"Click to edit",children:c}),e.jsx("span",{className:"admin-badge",children:"Admin"})]}),e.jsxs("div",{className:"header-right",children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>E(!0),children:"üîç Discover"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>A(!0),children:"üì¶ Areas"}),e.jsx("button",{type:"button",className:"action-button",onClick:_t,children:"üì± QR Code"}),e.jsxs("div",{className:"settings-menu-wrap",ref:V,children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>S(!k),children:"‚öôÔ∏è"}),k&&e.jsxs("div",{className:"settings-dropdown",children:[e.jsxs("button",{onClick:()=>{S(!1),p(!0)},children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{onClick:()=>{S(!1),P(!0)},children:"Change Password"}),e.jsx("button",{onClick:()=>{S(!1),B(!0)},children:"Server Settings"}),e.jsx("button",{onClick:()=>{S(!1),i()},children:"Logout"})]})]})]})]}),e.jsx("main",{className:"admin-main",children:t.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No areas yet. Create areas to organize your entities."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>A(!0),children:"Create First Area"})]}):t.map(j=>{const O=j.entities.filter(D=>!a.has(D));return e.jsxs("section",{className:"module-section",children:[e.jsxs("div",{className:"module-header",children:[e.jsxs("h2",{children:[j.icon," ",j.name]}),e.jsxs("span",{className:"entity-count",children:[j.entities.length," entities"]})]}),e.jsxs("div",{className:"entity-grid",children:[O.map((D,F)=>{var U,H,z,de,ue,Je,Ke;return e.jsxs("div",{className:`entity-card-wrap admin-card${(re==null?void 0:re.entityId)===D?" dragging":""}`,draggable:!0,onDragStart:()=>fe({moduleId:j.id,entityId:D}),onDragOver:pe=>pe.preventDefault(),onDrop:()=>Mt(j.id,F),onDragEnd:()=>fe(null),children:[e.jsx(qt,{entityId:D,showActions:!0,showAttributes:!0,onHide:()=>K(D),onGearClick:(pe,Ut)=>{X(pe),ne(Ut)},customName:(U=T[D])==null?void 0:U.custom_name,customIcon:(H=T[D])==null?void 0:H.custom_icon,showLastUpdated:(z=T[D])==null?void 0:z.show_last_updated,hideState:(de=T[D])==null?void 0:de.hide_state,hideUpdated:(ue=T[D])==null?void 0:ue.hide_updated,hideAttributes:(Je=T[D])==null?void 0:Je.hide_attributes,hideLogbook:(Ke=T[D])==null?void 0:Ke.hide_logbook}),e.jsxs("div",{className:"entity-admin-actions",children:[e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>ze(j.id,D,"up"),disabled:F===0,title:"Move up",children:"‚Üë"}),e.jsx("button",{type:"button",className:"reorder-btn",onClick:()=>ze(j.id,D,"down"),disabled:F===O.length-1,title:"Move down",children:"‚Üì"}),e.jsx("button",{type:"button",className:"remove-from-module-btn",onClick:()=>It(j.id,D),title:"Remove from area",children:"‚úï"})]})]},D)}),j.entities.length===0&&e.jsx("p",{className:"note",style:{gridColumn:"1 / -1"},children:"No entities in this area. Use Discover to add some."})]})]},j.id)})}),M&&Y&&e.jsx(Wt,{entityId:M,friendlyName:M.split(".").slice(1).join(".").replace(/_/g," "),sessionId:n,anchorRect:Y,onClose:()=>{X(null),ne(null)},onSave:()=>G(!0),onHide:()=>{K(M),X(null),ne(null)}}),_&&e.jsx(Kt,{sessionId:n,modules:t,onAssignEntity:Bt,onClose:()=>E(!1)}),L&&e.jsx(Vt,{sessionId:n,modules:t,onModulesChange:s,onClose:()=>{A(!1),G()}}),d&&e.jsx(Et,{sessionId:n,onClose:()=>B(!1)}),y&&e.jsx("div",{className:"modal-overlay",onClick:()=>p(!1),children:e.jsxs("div",{className:"modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Hidden Entities (",a.size,")"]}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>p(!1),children:"Close"})]}),e.jsxs("ul",{className:"hidden-list",children:[Array.from(a).map(j=>e.jsxs("li",{children:[e.jsx("span",{className:"hidden-id",children:j}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>Lt(j),children:"Unhide"})]},j)),a.size===0&&e.jsx("p",{className:"note",children:"No hidden entities."})]})]})}),w&&e.jsx("div",{className:"modal-overlay",onClick:()=>N(!1),children:e.jsxs("div",{className:"modal qr-modal",onClick:j=>j.stopPropagation(),children:[e.jsx("h3",{children:"Guest Access QR Code"}),oe&&e.jsx("img",{src:oe,alt:"QR Code for guest access"}),e.jsx("p",{className:"note",children:"Scan this code to open the guest dashboard."}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>N(!1),children:"Close"})]})}),R&&e.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:e.jsxs("div",{className:"modal",onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Change Password"}),e.jsx("button",{type:"button",className:"action-button",onClick:()=>P(!1),children:"Close"})]}),e.jsxs("div",{className:"settings-form",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"Current Password"}),e.jsx("input",{type:"password",value:W,onChange:j=>te(j.target.value)})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{children:"New Password"}),e.jsx("input",{type:"password",value:se,onChange:j=>Z(j.target.value)})]}),ce&&e.jsx("p",{className:"note",children:ce}),e.jsx("button",{type:"button",className:"action-button",onClick:Dt,children:"Change Password"})]})]})})]})}function Nn({onLogin:n,error:o}){const[r,i]=h.useState(""),[t,s]=h.useState(!1),a=async l=>{l.preventDefault(),s(!0),await n(r),s(!1)};return e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Admin Login"}),e.jsxs("form",{className:"login-form",onSubmit:a,children:[e.jsx("input",{className:"login-input",type:"password",placeholder:"Admin password",value:r,onChange:l=>i(l.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"action-button",disabled:t,children:t?"Logging in...":"Login"})]}),o&&e.jsx("p",{className:"note error",children:o})]})}function vn(){const[n,o]=h.useState(()=>sessionStorage.getItem("admin_session")),[r,i]=h.useState(""),[t,s]=h.useState(""),[a,l]=h.useState(null),[c,m]=h.useState(!0);h.useEffect(()=>{(async()=>{const f=sessionStorage.getItem("admin_session");if(!f){m(!1);return}try{const u=await I("/api/admin/session",{sessionId:f});u.valid?(o(f),i(u.hassUrl),s(u.hassToken)):(sessionStorage.removeItem("admin_session"),o(null))}catch{sessionStorage.removeItem("admin_session"),o(null)}finally{m(!1)}})()},[]);const b=async g=>{l(null);try{const f=await I("/api/admin/login",{method:"POST",body:JSON.stringify({password:g})});f.success?(sessionStorage.setItem("admin_session",f.sessionId),o(f.sessionId),i(f.hassUrl),s(f.hassToken)):l("Invalid password")}catch(f){l(f instanceof Error?f.message:"Login failed")}},v=async()=>{if(n)try{await I("/api/admin/logout",{method:"POST",sessionId:n})}catch{}sessionStorage.removeItem("admin_session"),o(null),i(""),s("")};return c?e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Loading..."})}):n?r?e.jsxs(zt,{hassUrl:r,hassToken:t,loading:e.jsx("div",{className:"container",children:e.jsx("p",{className:"note",children:"Connecting to Home Assistant..."})}),options:{renderError:()=>e.jsxs("div",{className:"container",children:[e.jsx("h1",{style:{fontSize:"1.85rem",fontWeight:800,background:"var(--accent-gradient)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"LobbyHA Admin"}),e.jsxs("p",{className:"note error",style:{marginBottom:"1.5rem"},children:["Unable to connect to Home Assistant.",e.jsx("br",{}),"Update the settings below and save to reconnect."]}),e.jsx(Et,{sessionId:n,inline:!0,onSaved:()=>{setTimeout(()=>window.location.reload(),1500)}}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",marginTop:"1rem"},children:[e.jsx("button",{type:"button",className:"action-button",onClick:()=>window.location.reload(),children:"Retry Connection"}),e.jsx("button",{type:"button",className:"action-button secondary",onClick:v,children:"Logout"})]})]})},children:[e.jsx(Jt,{}),e.jsx(wn,{sessionId:n,hassUrl:r,hassToken:t,onLogout:v})]}):e.jsx("div",{className:"container",children:e.jsxs("p",{className:"note",children:["Server not configured. ",e.jsx("a",{href:"/setup",children:"Run setup"})]})}):e.jsx(Nn,{onLogin:b,error:a})}Ft.createRoot(document.getElementById("root")).render(e.jsx(h.StrictMode,{children:e.jsx(vn,{})}));
